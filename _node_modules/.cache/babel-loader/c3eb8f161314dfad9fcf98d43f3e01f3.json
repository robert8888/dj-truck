{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _objectSpread from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectWithoutProperties\";import React,{useState,useEffect,useContext}from\"react\";import createAuth0Client from\"@auth0/auth0-spa-js\";import store from\"./../store\";import{setUserProfile,removeUser}from\"./../actions\";var DEFAULT_REDIRECT_CALLBACK=function DEFAULT_REDIRECT_CALLBACK(){return window.history.replaceState({},document.title,window.location.pathname);};export var Auth0Context=React.createContext();export var useAuth0=function useAuth0(){return useContext(Auth0Context);};var clientExternalResolver;export var auth0ClientExternal=new Promise(function(res,rej){clientExternalResolver=res;});export var Auth0Provider=function Auth0Provider(_ref){var children=_ref.children,_ref$onRedirectCallba=_ref.onRedirectCallback,onRedirectCallback=_ref$onRedirectCallba===void 0?DEFAULT_REDIRECT_CALLBACK:_ref$onRedirectCallba,initOptions=_objectWithoutProperties(_ref,[\"children\",\"onRedirectCallback\"]);var _useState=useState(),_useState2=_slicedToArray(_useState,2),isAuthenticated=_useState2[0],setIsAuthenticated=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),user=_useState4[0],setUser=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),auth0Client=_useState6[0],setAuth0=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),popupOpen=_useState10[0],setPopupOpen=_useState10[1];var dispatch=store.dispatch;useEffect(function(){var initAuth0=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var auth0FromHook,_ref3,appState,isAuthenticated,_user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return createAuth0Client(initOptions);case 2:auth0FromHook=_context.sent;setAuth0(auth0FromHook);clientExternalResolver(auth0FromHook);if(!(window.location.search.includes(\"code=\")&&window.location.search.includes(\"state=\"))){_context.next=11;break;}_context.next=8;return auth0FromHook.handleRedirectCallback();case 8:_ref3=_context.sent;appState=_ref3.appState;onRedirectCallback(appState);case 11:_context.next=13;return auth0FromHook.isAuthenticated();case 13:isAuthenticated=_context.sent;setIsAuthenticated(isAuthenticated);if(!isAuthenticated){_context.next=22;break;}_context.next=18;return auth0FromHook.getUser();case 18:_user=_context.sent;setUser(_user);console.log(\"user auth0 \",_user);dispatch(setUserProfile(_objectSpread({logged:true},_user)));case 22:setLoading(false);case 23:case\"end\":return _context.stop();}}},_callee);}));return function initAuth0(){return _ref2.apply(this,arguments);};}();initAuth0();// eslint-disable-next-line\n},[]);var loginWithPopup=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var params,user,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:params=_args2.length>0&&_args2[0]!==undefined?_args2[0]:{};setPopupOpen(true);_context2.prev=2;_context2.next=5;return auth0Client.loginWithPopup(params);case 5:_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](2);console.error(_context2.t0);case 10:_context2.prev=10;setPopupOpen(false);return _context2.finish(10);case 13:_context2.next=15;return auth0Client.getUser();case 15:user=_context2.sent;setUser(user);setIsAuthenticated(true);dispatch(setUserProfile(_objectSpread({logged:true},user)));case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[2,7,10,13]]);}));return function loginWithPopup(){return _ref4.apply(this,arguments);};}();var handleRedirectCallback=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setLoading(true);_context3.next=3;return auth0Client.handleRedirectCallback();case 3:_context3.next=5;return auth0Client.getUser();case 5:user=_context3.sent;setLoading(false);setIsAuthenticated(true);setUser(user);dispatch(setUserProfile(_objectSpread({logged:true},user)));case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function handleRedirectCallback(){return _ref5.apply(this,arguments);};}();var _logout=function logout(){auth0Client.logout.apply(auth0Client,arguments);dispatch(removeUser());};return React.createElement(Auth0Context.Provider,{value:{isAuthenticated:isAuthenticated,user:user,loading:loading,popupOpen:popupOpen,loginWithPopup:loginWithPopup,handleRedirectCallback:handleRedirectCallback,getIdTokenClaims:function getIdTokenClaims(){return auth0Client.getIdTokenClaims.apply(auth0Client,arguments);},loginWithRedirect:function loginWithRedirect(){return auth0Client.loginWithRedirect.apply(auth0Client,arguments);},getTokenSilently:function getTokenSilently(){return auth0Client.getTokenSilently.apply(auth0Client,arguments);},getTokenWithPopup:function getTokenWithPopup(){return auth0Client.getTokenWithPopup.apply(auth0Client,arguments);},logout:function logout(){return _logout.apply(void 0,arguments);}}},children);};","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/auth0/react-auth0-spa.js"],"names":["React","useState","useEffect","useContext","createAuth0Client","store","setUserProfile","removeUser","DEFAULT_REDIRECT_CALLBACK","window","history","replaceState","document","title","location","pathname","Auth0Context","createContext","useAuth0","clientExternalResolver","auth0ClientExternal","Promise","res","rej","Auth0Provider","children","onRedirectCallback","initOptions","isAuthenticated","setIsAuthenticated","user","setUser","auth0Client","setAuth0","loading","setLoading","popupOpen","setPopupOpen","dispatch","initAuth0","auth0FromHook","search","includes","handleRedirectCallback","appState","getUser","console","log","logged","loginWithPopup","params","error","logout","getIdTokenClaims","loginWithRedirect","getTokenSilently","getTokenWithPopup"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport createAuth0Client from \"@auth0/auth0-spa-js\";\r\nimport store from \"./../store\";\r\nimport {setUserProfile, removeUser} from \"./../actions\"\r\n\r\nconst DEFAULT_REDIRECT_CALLBACK = () =>\r\n  window.history.replaceState({}, document.title, window.location.pathname);\r\n\r\nexport const Auth0Context = React.createContext();\r\nexport const useAuth0 = () => useContext(Auth0Context);\r\n\r\nlet clientExternalResolver;\r\nexport let auth0ClientExternal = new Promise((res, rej)=>{\r\n  clientExternalResolver = res;\r\n})\r\n\r\nexport const Auth0Provider= ({\r\n  children,\r\n  onRedirectCallback = DEFAULT_REDIRECT_CALLBACK,\r\n  ...initOptions\r\n}) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState();\r\n  const [user, setUser] = useState();\r\n  const [auth0Client, setAuth0] = useState();\r\n  const [loading, setLoading] = useState(true);\r\n  const [popupOpen, setPopupOpen] = useState(false);\r\n  const dispatch = store.dispatch;\r\n\r\n  useEffect(() => {\r\n    const initAuth0 = async () => {\r\n      const auth0FromHook = await createAuth0Client(initOptions);\r\n      setAuth0(auth0FromHook);\r\n      clientExternalResolver(auth0FromHook);\r\n      if (window.location.search.includes(\"code=\") &&\r\n          window.location.search.includes(\"state=\")) {\r\n        const { appState } = await auth0FromHook.handleRedirectCallback();\r\n        onRedirectCallback(appState);\r\n      }\r\n\r\n      const isAuthenticated = await auth0FromHook.isAuthenticated();\r\n\r\n      setIsAuthenticated(isAuthenticated);\r\n\r\n      if (isAuthenticated) {\r\n        const user = await auth0FromHook.getUser();\r\n        setUser(user);\r\n        console.log(\"user auth0 \", user);\r\n\r\n        dispatch(setUserProfile({\r\n          logged: true,\r\n          ...user,\r\n        }))\r\n      }\r\n\r\n      setLoading(false);\r\n    };\r\n    initAuth0();\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  const loginWithPopup = async (params = {}) => {\r\n    setPopupOpen(true);\r\n    try {\r\n      await auth0Client.loginWithPopup(params);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      setPopupOpen(false);\r\n    }\r\n    const user = await auth0Client.getUser();\r\n    setUser(user);\r\n    setIsAuthenticated(true);\r\n\r\n    dispatch(setUserProfile({\r\n      logged: true,\r\n      ...user,\r\n    }))\r\n  };\r\n\r\n  const handleRedirectCallback = async () => {\r\n    setLoading(true);\r\n    await auth0Client.handleRedirectCallback();\r\n    const user = await auth0Client.getUser();\r\n    setLoading(false);\r\n    setIsAuthenticated(true);\r\n    setUser(user);\r\n\r\n    dispatch(setUserProfile({\r\n      logged: true,\r\n      ...user,\r\n    }))\r\n  };\r\n\r\n  const logout = (...p)=>{\r\n    auth0Client.logout(...p);\r\n    dispatch(removeUser())\r\n  }\r\n  return (\r\n    <Auth0Context.Provider\r\n      value={{\r\n        isAuthenticated,\r\n        user,\r\n        loading,\r\n        popupOpen,\r\n        loginWithPopup,\r\n        handleRedirectCallback,\r\n        getIdTokenClaims: (...p) => auth0Client.getIdTokenClaims(...p),\r\n        loginWithRedirect: (...p) => auth0Client.loginWithRedirect(...p),\r\n        getTokenSilently: (...p) => auth0Client.getTokenSilently(...p),\r\n        getTokenWithPopup: (...p) => auth0Client.getTokenWithPopup(...p),\r\n        logout: (...p) => logout(...p)\r\n      }}\r\n    >\r\n      {children}\r\n    </Auth0Context.Provider>\r\n  );\r\n};\r\n\r\n"]},"metadata":{},"sourceType":"module"}