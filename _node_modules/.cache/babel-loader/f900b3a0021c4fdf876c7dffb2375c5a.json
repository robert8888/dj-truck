{"ast":null,"code":"import { call, put, takeEvery } from 'redux-saga/effects';\nimport { ACTIONS, pushLog, setBpmAndOffset } from \"../actions\";\nimport { getApi } from \"./../apis/apiProvider\";\nimport { calcAccurateBpmAndOffset } from './../utils/bpm/analyzer';\nimport { Log } from \"./../utils/logger/logger\";\nexport default function* watcher() {\n  yield takeEvery(ACTIONS.PL_INIT_CALC_BPM, calcBpmAsync);\n  yield takeEvery(ACTIONS.PL_PUSH_TRACK, calcBpmAsync);\n}\n\nfunction* calcBpmAsync(action) {\n  const path = ['saga', 'calcBpm', 'calculatin bpm'];\n\n  try {\n    const {\n      sourceId: id,\n      source,\n      duration\n    } = action.track;\n\n    if (duration > 60 * 20) // 20 min;\n      {\n        const priv = \"Can't calculating bpm track duration is to big: \" + duration;\n        const logArgs = [path, priv];\n\n        if (action.type === ACTIONS.PL_INIT_CALC_BPM) {\n          const pub = \"Sorry. Bpm calculation is possible only for track which duration is up to 20 minutes\";\n          logArgs.push(pub);\n        }\n\n        yield put(pushLog(Log.Error(...logArgs)));\n        return;\n      }\n\n    const api = getApi(source);\n    const url = api.getUrl(id);\n    yield put(setBpmAndOffset(action.track.id, action.playlist, \"calculating\", null));\n    let {\n      offset,\n      bpm\n    } = yield call(calcAccurateBpmAndOffset, url);\n    yield put(setBpmAndOffset(action.track.id, action.playlist, bpm, offset));\n    yield put(pushLog(new Log(`Track id: ${id} bpm and offset successful updated`, path)));\n  } catch (error) {\n    yield put(pushLog(Log.Error(path, \"Can't calculating bpm. \" + error.message, \"Sorry. During calculating bpm occured problem\", error)));\n  }\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/sagas/calcBpmSaga.js"],"names":["call","put","takeEvery","ACTIONS","pushLog","setBpmAndOffset","getApi","calcAccurateBpmAndOffset","Log","watcher","PL_INIT_CALC_BPM","calcBpmAsync","PL_PUSH_TRACK","action","path","sourceId","id","source","duration","track","priv","logArgs","type","pub","push","Error","api","url","getUrl","playlist","offset","bpm","error","message"],"mappings":"AAAA,SAASA,IAAT,EAAeC,GAAf,EAAoBC,SAApB,QAAqC,oBAArC;AACA,SAASC,OAAT,EAAkBC,OAAlB,EAA2BC,eAA3B,QAAkD,YAAlD;AACA,SAASC,MAAT,QAAuB,uBAAvB;AACA,SAASC,wBAAT,QAAyC,yBAAzC;AACA,SAASC,GAAT,QAAoB,0BAApB;AAEA,eAAe,UAAUC,OAAV,GAAoB;AAC/B,QAAMP,SAAS,CAACC,OAAO,CAACO,gBAAT,EAA2BC,YAA3B,CAAf;AACA,QAAMT,SAAS,CAACC,OAAO,CAACS,aAAT,EAAwBD,YAAxB,CAAf;AACH;;AAED,UAAUA,YAAV,CAAuBE,MAAvB,EAA+B;AAC3B,QAAMC,IAAI,GAAG,CAAC,MAAD,EAAS,SAAT,EAAoB,gBAApB,CAAb;;AACA,MAAG;AACC,UAAM;AAACC,MAAAA,QAAQ,EAAEC,EAAX;AAAeC,MAAAA,MAAf;AAAuBC,MAAAA;AAAvB,QAAmCL,MAAM,CAACM,KAAhD;;AACA,QAAGD,QAAQ,GAAG,KAAK,EAAnB,EAAuB;AACvB;AACI,cAAME,IAAI,GAAG,qDAAqDF,QAAlE;AACA,cAAMG,OAAO,GAAG,CAACP,IAAD,EAAOM,IAAP,CAAhB;;AACA,YAAGP,MAAM,CAACS,IAAP,KAAgBnB,OAAO,CAACO,gBAA3B,EAA6C;AACzC,gBAAMa,GAAG,GAAG,sFAAZ;AACAF,UAAAA,OAAO,CAACG,IAAR,CAAaD,GAAb;AACH;;AACD,cAAMtB,GAAG,CAACG,OAAO,CAACI,GAAG,CAACiB,KAAJ,CAAU,GAAGJ,OAAb,CAAD,CAAR,CAAT;AACA;AACH;;AACD,UAAMK,GAAG,GAAGpB,MAAM,CAACW,MAAD,CAAlB;AACA,UAAMU,GAAG,GAAGD,GAAG,CAACE,MAAJ,CAAWZ,EAAX,CAAZ;AAEA,UAAMf,GAAG,CAACI,eAAe,CAACQ,MAAM,CAACM,KAAP,CAAaH,EAAd,EAAkBH,MAAM,CAACgB,QAAzB,EAAmC,aAAnC,EAAkD,IAAlD,CAAhB,CAAT;AACA,QAAI;AAAEC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAkB,MAAM/B,IAAI,CAACO,wBAAD,EAA2BoB,GAA3B,CAAhC;AACA,UAAM1B,GAAG,CAACI,eAAe,CAACQ,MAAM,CAACM,KAAP,CAAaH,EAAd,EAAkBH,MAAM,CAACgB,QAAzB,EAAmCE,GAAnC,EAAwCD,MAAxC,CAAhB,CAAT;AAEA,UAAM7B,GAAG,CAACG,OAAO,CAAC,IAAII,GAAJ,CAAS,aAAYQ,EAAG,oCAAxB,EAA6DF,IAA7D,CAAD,CAAR,CAAT;AACH,GArBD,CAqBE,OAAOkB,KAAP,EAAa;AACX,UAAM/B,GAAG,CAACG,OAAO,CAACI,GAAG,CAACiB,KAAJ,CACdX,IADc,EAEd,4BAA4BkB,KAAK,CAACC,OAFpB,EAGd,+CAHc,EAIdD,KAJc,CAAD,CAAR,CAAT;AAMH;AAEJ","sourcesContent":["import { call, put, takeEvery } from 'redux-saga/effects';\r\nimport { ACTIONS, pushLog, setBpmAndOffset } from \"../actions\";\r\nimport { getApi } from \"./../apis/apiProvider\";\r\nimport { calcAccurateBpmAndOffset } from './../utils/bpm/analyzer';\r\nimport { Log } from \"./../utils/logger/logger\";\r\n\r\nexport default function* watcher() {\r\n    yield takeEvery(ACTIONS.PL_INIT_CALC_BPM, calcBpmAsync);\r\n    yield takeEvery(ACTIONS.PL_PUSH_TRACK, calcBpmAsync);\r\n}\r\n\r\nfunction* calcBpmAsync(action) {\r\n    const path = ['saga', 'calcBpm', 'calculatin bpm']\r\n    try{\r\n        const {sourceId: id, source, duration} = action.track;\r\n        if(duration > 60 * 20) // 20 min;\r\n        {\r\n            const priv = \"Can't calculating bpm track duration is to big: \" + duration;\r\n            const logArgs = [path, priv];\r\n            if(action.type === ACTIONS.PL_INIT_CALC_BPM) {\r\n                const pub = \"Sorry. Bpm calculation is possible only for track which duration is up to 20 minutes\";\r\n                logArgs.push(pub)\r\n            }\r\n            yield put(pushLog(Log.Error(...logArgs)))\r\n            return;\r\n        }\r\n        const api = getApi(source);\r\n        const url = api.getUrl(id);\r\n\r\n        yield put(setBpmAndOffset(action.track.id, action.playlist, \"calculating\", null))\r\n        let { offset, bpm } = yield call(calcAccurateBpmAndOffset, url);\r\n        yield put(setBpmAndOffset(action.track.id, action.playlist, bpm, offset))\r\n        \r\n        yield put(pushLog(new Log(`Track id: ${id} bpm and offset successful updated`, path)))\r\n    } catch (error){\r\n        yield put(pushLog(Log.Error(\r\n            path,\r\n            \"Can't calculating bpm. \" + error.message,\r\n            \"Sorry. During calculating bpm occured problem\",\r\n            error\r\n        )))\r\n    }  \r\n\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}