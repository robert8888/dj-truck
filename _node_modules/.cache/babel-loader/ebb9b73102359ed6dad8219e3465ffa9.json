{"ast":null,"code":"import { call, put, takeEvery } from 'redux-saga/effects';\nimport { ACTIONS, pushLog, setBpmAndOffset } from \"../actions\";\nimport { getApi } from \"./../apis/apiProvider\";\nimport { calcAccurateBpmAndOffset } from './../utils/bpm/analyzer';\nimport { Log } from \"./../utils/logger/logger\";\nexport default function* watcher() {\n  yield takeEvery(ACTIONS.PL_INIT_CALC_BPM, calcBpmAsync);\n  yield takeEvery(ACTIONS.PUSH_TRACK, calcBpmAsync);\n}\n\nfunction* calcBpmAsync(action) {\n  const path = ['saga', 'calcBpm', 'calculatin bpm'];\n\n  try {\n    const source = action.track.source;\n    const id = action.track.sourceId;\n    const api = getApi(source);\n    const url = api.getUrl(id); // console.log(action)\n\n    yield put(setBpmAndOffset(action.track.id, action.playlist, \"calculating\", null));\n    let {\n      offset,\n      bpm\n    } = yield call(calcAccurateBpmAndOffset, url);\n    yield put(setBpmAndOffset(action.track.id, action.playlist, bpm, offset));\n    yield put(pushLog(new Log(`Track id: ${id} bpm and offset successful updated`, path)));\n  } catch (error) {\n    yield put(pushLog(Log.Error(path, \"Can't calculating bpm. \" + error.message, \"Sorry. During calculating bpm occure problem\", error)));\n  }\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/sagas/calcBpmSaga.js"],"names":["call","put","takeEvery","ACTIONS","pushLog","setBpmAndOffset","getApi","calcAccurateBpmAndOffset","Log","watcher","PL_INIT_CALC_BPM","calcBpmAsync","PUSH_TRACK","action","path","source","track","id","sourceId","api","url","getUrl","playlist","offset","bpm","error","Error","message"],"mappings":"AAAA,SAASA,IAAT,EAAeC,GAAf,EAAoBC,SAApB,QAAqC,oBAArC;AACA,SAASC,OAAT,EAAkBC,OAAlB,EAA2BC,eAA3B,QAAkD,YAAlD;AACA,SAASC,MAAT,QAAuB,uBAAvB;AACA,SAASC,wBAAT,QAAyC,yBAAzC;AACA,SAASC,GAAT,QAAoB,0BAApB;AAEA,eAAe,UAAUC,OAAV,GAAoB;AAC/B,QAAMP,SAAS,CAACC,OAAO,CAACO,gBAAT,EAA2BC,YAA3B,CAAf;AACA,QAAMT,SAAS,CAACC,OAAO,CAACS,UAAT,EAAqBD,YAArB,CAAf;AACH;;AAED,UAAUA,YAAV,CAAuBE,MAAvB,EAA+B;AAC3B,QAAMC,IAAI,GAAG,CAAC,MAAD,EAAS,SAAT,EAAoB,gBAApB,CAAb;;AACA,MAAG;AACC,UAAMC,MAAM,GAAGF,MAAM,CAACG,KAAP,CAAaD,MAA5B;AACA,UAAME,EAAE,GAAGJ,MAAM,CAACG,KAAP,CAAaE,QAAxB;AAEA,UAAMC,GAAG,GAAGb,MAAM,CAACS,MAAD,CAAlB;AACA,UAAMK,GAAG,GAAGD,GAAG,CAACE,MAAJ,CAAWJ,EAAX,CAAZ,CALD,CAOC;;AACA,UAAMhB,GAAG,CAACI,eAAe,CAACQ,MAAM,CAACG,KAAP,CAAaC,EAAd,EAAkBJ,MAAM,CAACS,QAAzB,EAAmC,aAAnC,EAAkD,IAAlD,CAAhB,CAAT;AACA,QAAI;AAAEC,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAkB,MAAMxB,IAAI,CAACO,wBAAD,EAA2Ba,GAA3B,CAAhC;AACA,UAAMnB,GAAG,CAACI,eAAe,CAACQ,MAAM,CAACG,KAAP,CAAaC,EAAd,EAAkBJ,MAAM,CAACS,QAAzB,EAAmCE,GAAnC,EAAwCD,MAAxC,CAAhB,CAAT;AAEA,UAAMtB,GAAG,CAACG,OAAO,CAAC,IAAII,GAAJ,CAAS,aAAYS,EAAG,oCAAxB,EAA6DH,IAA7D,CAAD,CAAR,CAAT;AACH,GAbD,CAaE,OAAOW,KAAP,EAAa;AACX,UAAMxB,GAAG,CAACG,OAAO,CAACI,GAAG,CAACkB,KAAJ,CACdZ,IADc,EAEd,4BAA4BW,KAAK,CAACE,OAFpB,EAGd,8CAHc,EAIdF,KAJc,CAAD,CAAR,CAAT;AAMH;AAEJ","sourcesContent":["import { call, put, takeEvery } from 'redux-saga/effects';\r\nimport { ACTIONS, pushLog, setBpmAndOffset } from \"../actions\";\r\nimport { getApi } from \"./../apis/apiProvider\";\r\nimport { calcAccurateBpmAndOffset } from './../utils/bpm/analyzer';\r\nimport { Log } from \"./../utils/logger/logger\";\r\n\r\nexport default function* watcher() {\r\n    yield takeEvery(ACTIONS.PL_INIT_CALC_BPM, calcBpmAsync);\r\n    yield takeEvery(ACTIONS.PUSH_TRACK, calcBpmAsync);\r\n}\r\n\r\nfunction* calcBpmAsync(action) {\r\n    const path = ['saga', 'calcBpm', 'calculatin bpm']\r\n    try{\r\n        const source = action.track.source;\r\n        const id = action.track.sourceId;\r\n\r\n        const api = getApi(source);\r\n        const url = api.getUrl(id);\r\n\r\n        // console.log(action)\r\n        yield put(setBpmAndOffset(action.track.id, action.playlist, \"calculating\", null))\r\n        let { offset, bpm } = yield call(calcAccurateBpmAndOffset, url);\r\n        yield put(setBpmAndOffset(action.track.id, action.playlist, bpm, offset))\r\n        \r\n        yield put(pushLog(new Log(`Track id: ${id} bpm and offset successful updated`, path)))\r\n    } catch (error){\r\n        yield put(pushLog(Log.Error(\r\n            path,\r\n            \"Can't calculating bpm. \" + error.message,\r\n            \"Sorry. During calculating bpm occure problem\",\r\n            error\r\n        )))\r\n    }  \r\n\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}