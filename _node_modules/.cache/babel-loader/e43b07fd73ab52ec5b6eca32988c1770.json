{"ast":null,"code":"import store from \"./../../../../../../store\";\nimport config from \"./../../../../components/Console/Deck/Player/configuration\";\nimport WaveSurfer from \"wavesurfer\";\nimport ChannelEvnetHandler from \"./../channelEvnetHandler/channelEvnetHandler\";\nimport { getBeatLength } from \"./../../../../../../utils/bpm/converter\";\nexport default class ChannelBuilder {\n  constructor() {\n    this.eventHandler = new ChannelEvnetHandler();\n    this.dispatch = store.dispatch;\n  }\n\n  create(channelName, masterContainer, slaveContainer, mainAudioContext) {\n    let channel = {\n      channelName,\n      masterContainer,\n      slaveContainer\n    }; //--configs\n\n    channel.masterConfig = config.master(masterContainer, channelName);\n    channel.slaveConfig = config.slave(slaveContainer, channelName); //--master waveSurfer obj\n\n    channel.masterConfig.audioContext = mainAudioContext;\n    channel.master = WaveSurfer.create(channel.masterConfig);\n    this.monkyMock(channel.master);\n\n    channel.master.__proto__.loadWithEvent = function (...args) {\n      this.fireEvent(\"load\");\n      this.load(...args);\n    };\n\n    channel.slave = WaveSurfer.create(channel.slaveConfig);\n    this.eventHandler.CreateEventHandling(channel);\n    return channel;\n  } //!!! turn off !\n\n\n  createBars(channel, {\n    bpm,\n    offset\n  }) {\n    return;\n    let wrapper = channel.master.drawer.wrapper;\n    let styleApply = WaveSurfer.Drawer.style;\n    let minPxPerSec = channel.master.params.minPxPerSec;\n    let bitLength = getBeatLength(bpm);\n    let barPostions = [];\n\n    for (let i = offset; i < channel.master.getDuration(); i += bitLength) {\n      barPostions.push(i);\n    }\n\n    let barStyle = position => ({\n      position: \"absolute\",\n      left: position + \"px\",\n      top: \"0px\",\n      width: \"1px\",\n      maxWidth: \"1px\",\n      height: \"100%\",\n      background: \"rgba(255,255,255, 0.5)\"\n    });\n\n    channel.barsElements = [];\n    barPostions.forEach(position => {\n      let bar = document.createElement(\"div\");\n      let style = barStyle(minPxPerSec * position);\n      styleApply(bar, style);\n      wrapper.appendChild(bar);\n      channel.barsElements.push(bar);\n    });\n  }\n\n  monkyMock(waveSurf) {\n    waveSurf.drawer.handleEvent = function (e, noPrevent) {\n      console.log(\"click\");\n      !noPrevent && e.preventDefault();\n      var clientX = e.targetTouches ? e.targetTouches[0].clientX : e.clientX;\n      var bbox = this.wrapper.getBoundingClientRect();\n      var nominalWidth = this.width;\n      var parentWidth = this.getWidth();\n      var progress;\n\n      if (!this.params.fillParent && nominalWidth < parentWidth) {\n        progress = (clientX - bbox.left) * this.params.pixelRatio / nominalWidth || 0;\n\n        if (progress > 1) {\n          progress = 1;\n        }\n      } else {\n        progress = (clientX - bbox.left + this.wrapper._scrollLeft) / this.wrapper.scrollWidth || 0;\n      }\n\n      return progress;\n    };\n\n    waveSurf.drawer.progress = function (progress) {\n      var minPxDelta = 1 / this.params.pixelRatio;\n      var pos = Math.round(progress * this.width) * minPxDelta;\n\n      if (pos < this.lastPos || pos - this.lastPos >= minPxDelta) {\n        this.lastPos = pos;\n\n        if (this.params.scrollParent && this.params.autoCenter) {\n          var newPos = ~~(this.wrapper.scrollWidth * progress);\n          this.recenterOnPosition(pos);\n        }\n\n        this.updateProgress(pos);\n      }\n    };\n\n    waveSurf.drawer.recenterOnPosition = function (position, immediate) {\n      console.log(position);\n      var scrollLeft = this.wrapper._scrollLeft;\n      var half = ~~(this.wrapper.clientWidth / 2);\n      var target = position - half;\n      var offset = target - scrollLeft; //var maxScroll = this.wrapper.scrollWidth - this.wrapper.clientWidth;\n      //    if (maxScroll == 0) {\n      // no need to continue if scrollbar is not there\n      //   return;\n      //  }\n      // if the cursor is currently visible...\n\n      if (!immediate && -half <= offset && offset < half) {\n        // we'll limit the \"re-center\" rate.\n        var rate = 5;\n        offset = Math.max(-rate, Math.min(rate, offset));\n        target = scrollLeft + offset;\n      } // limit target to valid range (0 to maxScroll)\n      //  target = Math.max(0, Math.min(maxScroll, target));\n      // no use attempting to scroll if we're not moving\n\n\n      if (target != scrollLeft) {\n        //     this.wrapper.scrollLeft = target;\n        this.wrapper._scrollLeft = target;\n        console.log(this.wrapper.firstElementChild.style.width);\n        [...this.wrapper.children].forEach(element => {\n          element.style.transform = \"translateX(-\" + target + \"px)\";\n        });\n      }\n    };\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/pages/app/core/console/channels/channelBuilder/channelBuilder.js"],"names":["store","config","WaveSurfer","ChannelEvnetHandler","getBeatLength","ChannelBuilder","constructor","eventHandler","dispatch","create","channelName","masterContainer","slaveContainer","mainAudioContext","channel","masterConfig","master","slaveConfig","slave","audioContext","monkyMock","__proto__","loadWithEvent","args","fireEvent","load","CreateEventHandling","createBars","bpm","offset","wrapper","drawer","styleApply","Drawer","style","minPxPerSec","params","bitLength","barPostions","i","getDuration","push","barStyle","position","left","top","width","maxWidth","height","background","barsElements","forEach","bar","document","createElement","appendChild","waveSurf","handleEvent","e","noPrevent","console","log","preventDefault","clientX","targetTouches","bbox","getBoundingClientRect","nominalWidth","parentWidth","getWidth","progress","fillParent","pixelRatio","_scrollLeft","scrollWidth","minPxDelta","pos","Math","round","lastPos","scrollParent","autoCenter","newPos","recenterOnPosition","updateProgress","immediate","scrollLeft","half","clientWidth","target","rate","max","min","firstElementChild","children","element","transform"],"mappings":"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","sourcesContent":["import store from \"./../../../../../../store\";\r\nimport config from \"./../../../../components/Console/Deck/Player/configuration\"\r\n\r\nimport WaveSurfer from \"wavesurfer\";\r\nimport ChannelEvnetHandler from \"./../channelEvnetHandler/channelEvnetHandler\"\r\nimport { getBeatLength } from \"./../../../../../../utils/bpm/converter\";\r\n\r\n\r\n\r\nexport default class ChannelBuilder {\r\n  constructor() {\r\n    this.eventHandler = new ChannelEvnetHandler();\r\n    this.dispatch = store.dispatch;\r\n  }\r\n\r\n  create(channelName, masterContainer, slaveContainer, mainAudioContext) {\r\n    let channel = { channelName, masterContainer, slaveContainer };\r\n\r\n    //--configs\r\n    channel.masterConfig = config.master(masterContainer, channelName);\r\n    channel.slaveConfig = config.slave(slaveContainer, channelName);\r\n\r\n    //--master waveSurfer obj\r\n    channel.masterConfig.audioContext = mainAudioContext;\r\n    channel.master = WaveSurfer.create(channel.masterConfig);\r\n    this.monkyMock(channel.master)\r\n\r\n    channel.master.__proto__.loadWithEvent = function (...args) {\r\n      this.fireEvent(\"load\");\r\n      this.load(...args);\r\n    };\r\n\r\n    channel.slave = WaveSurfer.create(channel.slaveConfig);\r\n\r\n    this.eventHandler.CreateEventHandling(channel)\r\n\r\n    return channel;\r\n  }\r\n\r\n  //!!! turn off !\r\n  createBars(channel, { bpm, offset }) {\r\n    return\r\n    let wrapper = channel.master.drawer.wrapper;\r\n    let styleApply = WaveSurfer.Drawer.style;\r\n    let minPxPerSec = channel.master.params.minPxPerSec;\r\n    let bitLength = getBeatLength(bpm);\r\n\r\n    let barPostions = [];\r\n\r\n    for (let i = offset; i < channel.master.getDuration(); i += bitLength) {\r\n      barPostions.push(i);\r\n    }\r\n\r\n    let barStyle = position => ({\r\n      position: \"absolute\",\r\n      left: position + \"px\",\r\n      top: \"0px\",\r\n      width: \"1px\",\r\n      maxWidth: \"1px\",\r\n      height: \"100%\",\r\n      background: \"rgba(255,255,255, 0.5)\"\r\n    });\r\n\r\n    channel.barsElements = [];\r\n    barPostions.forEach(position => {\r\n      let bar = document.createElement(\"div\");\r\n      let style = barStyle(minPxPerSec * position);\r\n      styleApply(bar, style);\r\n      wrapper.appendChild(bar);\r\n      channel.barsElements.push(bar);\r\n    });\r\n  }\r\n\r\n  monkyMock(waveSurf) {\r\n\r\n    waveSurf.drawer.handleEvent = function (e, noPrevent) {\r\n      console.log(\"click\")\r\n        !noPrevent && e.preventDefault();\r\n\r\n        var clientX = e.targetTouches ? e.targetTouches[0].clientX : e.clientX;\r\n        var bbox = this.wrapper.getBoundingClientRect();\r\n\r\n        var nominalWidth = this.width;\r\n        var parentWidth = this.getWidth();\r\n\r\n        var progress;\r\n\r\n        if (!this.params.fillParent && nominalWidth < parentWidth) {\r\n            progress = ((clientX - bbox.left) * this.params.pixelRatio / nominalWidth) || 0;\r\n\r\n            if (progress > 1) {\r\n                progress = 1;\r\n            }\r\n        } else {\r\n            progress = ((clientX - bbox.left + this.wrapper._scrollLeft) / this.wrapper.scrollWidth) || 0;\r\n        }\r\n\r\n        return progress;\r\n    };\r\n\r\n    waveSurf.drawer.progress = function (progress) {\r\n      var minPxDelta = 1 / this.params.pixelRatio;\r\n      var pos = Math.round(progress * this.width) * minPxDelta;\r\n\r\n      if (pos < this.lastPos || pos - this.lastPos >= minPxDelta) {\r\n          this.lastPos = pos;\r\n\r\n          if (this.params.scrollParent && this.params.autoCenter) {\r\n              var newPos = ~~(this.wrapper.scrollWidth * progress);\r\n              this.recenterOnPosition(pos);\r\n          }\r\n\r\n          this.updateProgress(pos);\r\n      }\r\n    };\r\n\r\n    waveSurf.drawer.recenterOnPosition = function (position, immediate) {\r\n      console.log(position)\r\n      var scrollLeft = this.wrapper._scrollLeft;\r\n      var half = ~~(this.wrapper.clientWidth / 2);\r\n      var target = position - half;\r\n      var offset = target - scrollLeft;\r\n      //var maxScroll = this.wrapper.scrollWidth - this.wrapper.clientWidth;\r\n\r\n  //    if (maxScroll == 0) {\r\n        // no need to continue if scrollbar is not there\r\n     //   return;\r\n    //  }\r\n\r\n      // if the cursor is currently visible...\r\n      if (!immediate && -half <= offset && offset < half) {\r\n        // we'll limit the \"re-center\" rate.\r\n        var rate = 5;\r\n        offset = Math.max(-rate, Math.min(rate, offset));\r\n        target = scrollLeft + offset;\r\n      }\r\n\r\n      // limit target to valid range (0 to maxScroll)\r\n    //  target = Math.max(0, Math.min(maxScroll, target));\r\n      // no use attempting to scroll if we're not moving\r\n      if (target != scrollLeft) {\r\n   //     this.wrapper.scrollLeft = target;\r\n        this.wrapper._scrollLeft = target;\r\n        console.log(this.wrapper.firstElementChild.style.width);\r\n        [...this.wrapper.children].forEach(element => {\r\n          element.style.transform = \"translateX(-\" + target + \"px)\"\r\n        })\r\n\r\n      }\r\n\r\n    }\r\n  }\r\n\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}