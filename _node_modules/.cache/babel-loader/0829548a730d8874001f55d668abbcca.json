{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\src\\\\pages\\\\userRecords\\\\UserRecords.js\";\nimport React, { useEffect, useContext, useState, useRef, useCallback, useMemo } from \"react\";\nimport { useAuth0 } from \"./../../auth0/react-auth0-spa\";\nimport { connect } from \"react-redux\";\nimport { reqRecOfUser } from \"./../../actions\";\nimport RecordsList from \"./../common/components/RecordList/RecordList\";\nimport RecordSearch from \"./../common/components/RecordSearch/RecordSearch\";\nimport { useRecordPlayer } from \"./../common/Hooks/useRecordPlayer\";\nimport PlayerControls from \"./../common/components/PlayerControls/PlayerControls\";\nimport LayoutContext from \"./../common/Layout/LayoutContext\";\nimport Pagin from \"./../common/components/Pagin/Pagin\";\nimport { DropdownButton, Dropdown } from \"react-bootstrap\";\nimport { useParams, useHistory, useLocation } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport \"./user-records.scss\";\n\nconst UserRecords = ({\n  requestList,\n  userId,\n  isCurrentUser,\n  searchQuery,\n  recordsList,\n  countAll\n}) => {\n  const [controls, player] = useRecordPlayer(); //-------------------------\n\n  const {\n    loading,\n    isAuthenticated\n  } = useAuth0();\n  const [pageTitle, setPageTitle] = useState(\"Records\");\n  const [displaySearch, setSearchDisplaing] = useState(false);\n  const history = useHistory();\n  const {\n    user,\n    generes\n  } = useParams();\n  const queryStr = useLocation().search;\n  let {\n    pageSize,\n    page,\n    preloaded,\n    searchOpt,\n    _generes\n  } = useMemo(() => {\n    const values = queryString.parse(queryStr);\n    return {\n      pageSize: +values.pageSize,\n      page: +values.page,\n      preloaded: values.preloaded,\n      current: values.current,\n      searchOpt: values.searchOpt,\n      _generes: values.generes\n    };\n  }, [queryStr]);\n  const [_pageSize, setPageSize] = useState(20);\n  const [_page, setPage] = useState(0);\n  useEffect(() => {\n    console.log(\"call\");\n\n    if (preloaded && recordsList.length > 0 || loading) {\n      return;\n    }\n\n    if (isAuthenticated && !userId) {\n      return;\n    }\n\n    console.log(\"get in\");\n    let pg = page || 0;\n    let pgSize = pageSize || _pageSize;\n    let searchConsole = true;\n    const where = {};\n\n    if (searchQuery) {\n      where.query = searchQuery;\n\n      if (searchOpt) {\n        let opt = searchOpt.split(',');\n        where.queryOpt = opt;\n      }\n\n      setPageTitle(\"Search: \" + searchQuery);\n\n      if (_generes) {\n        //from search params\n        where.genereNames = _generes.split(\",\");\n      }\n    }\n\n    if (generes) {\n      where.genereNames = generes.split(\",\");\n    } else {\n      if (user) {\n        where.nickname = user;\n        setPageTitle(user + \" user records\");\n        searchConsole = false;\n      } else if (userId && isCurrentUser) {\n        where.userId = userId;\n        setPageTitle(\"Your records\");\n        searchConsole = false;\n      }\n    }\n\n    setSearchDisplaing(searchConsole);\n    requestList(pgSize, pg, where);\n    setPageSize(pgSize);\n    setPage(pg);\n  }, [userId, requestList, _pageSize, page, pageSize, preloaded, setPageTitle, searchQuery, generes, loading]);\n  const layoutContext = useContext(LayoutContext);\n  useEffect(() => {\n    layoutContext.setFooter(false);\n  }, [layoutContext]);\n  const getNextPageUrl = useCallback((page, pageSize) => {\n    let url = window.location.pathname;\n    url += '?pageSize=' + pageSize;\n    url += '&page=' + page;\n    let search = window.location.search;\n    search = search.replace(/pageSize=\\d+/, '');\n    search = search.replace(/&page=\\d+/, '');\n    search = search.replace('?', '&');\n    url += search;\n    return url;\n  }, []);\n  const changePageSize = useCallback(pageSize => {\n    history.push(getNextPageUrl(_page, pageSize));\n  }, [history, _page, getNextPageUrl]);\n  const goToPage = useCallback(page => {\n    history.push(getNextPageUrl(page, _pageSize));\n  }, [history, _pageSize, getNextPageUrl]);\n  const onSearch = useCallback((queryStr, searchOpt) => {\n    let search = \"\";\n\n    for (let optName in searchOpt) {\n      if (!searchOpt[optName]) {\n        search += 'no-' + optName + ',';\n      }\n    }\n\n    if (search.length > 1) {\n      search = \"?searchOpt=\" + search;\n      search = search.substr(0, search.length - 1);\n    }\n\n    if (generes || _generes) {\n      // from route param \n      search += search.length ? \"&\" : \"?\";\n      search += \"&generes=\";\n      search += generes || \"\";\n      search += _generes || \"\";\n    }\n\n    history.push('/records/search/' + queryStr + search);\n  }, [history]);\n  return React.createElement(\"div\", {\n    className: \"user-records\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153\n    },\n    __self: this\n  }, displaySearch && React.createElement(RecordSearch, {\n    onSearch: onSearch,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"user-records-top-bar\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, React.createElement(\"h2\", {\n    className: \"title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, pageTitle), React.createElement(DropdownButton, {\n    alignRight: true,\n    className: \"btn-pagger\",\n    title: _pageSize + \" on page \",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 10),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, \" 10 \"), React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 20),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }, \" 20 \"), React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 30),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }, \" 30 \"), React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 50),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, \" 50 \"), React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 75),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, \" 75 \"), React.createElement(Dropdown.Item, {\n    onClick: changePageSize.bind(null, 100),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  }, \" 100 \"))), React.createElement(RecordsList, {\n    list: recordsList,\n    controls: controls,\n    player: player,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170\n    },\n    __self: this\n  }), React.createElement(Pagin, {\n    current: _page,\n    call: goToPage,\n    all: Math.floor(countAll / _pageSize),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }), React.createElement(PlayerControls, {\n    list: recordsList,\n    controls: controls,\n    player: player,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178\n    },\n    __self: this\n  }));\n};\n\nconst mapStateToProps = state => ({\n  recordsList: state.records.list,\n  countAll: state.records.countAll,\n  userId: state.user.dbId,\n  userNickname: state.user.nickname\n});\n\nconst mapDispatchToProps = dispatch => ({\n  requestList: (pageSize, page, where) => dispatch(reqRecOfUser(pageSize, page, where))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecords);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/userRecords/UserRecords.js"],"names":["React","useEffect","useContext","useState","useRef","useCallback","useMemo","useAuth0","connect","reqRecOfUser","RecordsList","RecordSearch","useRecordPlayer","PlayerControls","LayoutContext","Pagin","DropdownButton","Dropdown","useParams","useHistory","useLocation","queryString","UserRecords","requestList","userId","isCurrentUser","searchQuery","recordsList","countAll","controls","player","loading","isAuthenticated","pageTitle","setPageTitle","displaySearch","setSearchDisplaing","history","user","generes","queryStr","search","pageSize","page","preloaded","searchOpt","_generes","values","parse","current","_pageSize","setPageSize","_page","setPage","console","log","length","pg","pgSize","searchConsole","where","query","opt","split","queryOpt","genereNames","nickname","layoutContext","setFooter","getNextPageUrl","url","window","location","pathname","replace","changePageSize","push","goToPage","onSearch","optName","substr","bind","Math","floor","mapStateToProps","state","records","list","dbId","userNickname","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useState, useRef, useCallback, useMemo } from \"react\";\r\nimport { useAuth0 } from \"./../../auth0/react-auth0-spa\";\r\nimport { connect } from \"react-redux\";\r\nimport { reqRecOfUser } from \"./../../actions\"\r\nimport RecordsList from \"./../common/components/RecordList/RecordList\";\r\nimport RecordSearch from \"./../common/components/RecordSearch/RecordSearch\";\r\nimport { useRecordPlayer } from \"./../common/Hooks/useRecordPlayer\";\r\nimport PlayerControls from \"./../common/components/PlayerControls/PlayerControls\";\r\nimport LayoutContext from \"./../common/Layout/LayoutContext\";\r\nimport Pagin from \"./../common/components/Pagin/Pagin\";\r\nimport { DropdownButton, Dropdown } from \"react-bootstrap\";\r\nimport { useParams, useHistory, useLocation } from \"react-router-dom\";\r\nimport queryString from \"query-string\";\r\nimport \"./user-records.scss\"\r\n\r\nconst UserRecords = ({\r\n    requestList,\r\n    userId,\r\n    isCurrentUser,\r\n    searchQuery,\r\n    recordsList,\r\n    countAll }) => {\r\n    const [controls, player] = useRecordPlayer();\r\n    //-------------------------\r\n    const { loading, isAuthenticated } = useAuth0();\r\n    const [pageTitle, setPageTitle] = useState(\"Records\");\r\n    const [displaySearch, setSearchDisplaing] = useState(false);\r\n    const history = useHistory();\r\n    const { user, generes } = useParams();\r\n\r\n\r\n    const queryStr = useLocation().search;\r\n    let { pageSize, page, preloaded, searchOpt, _generes } = useMemo(() => {\r\n        const values = queryString.parse(queryStr)\r\n        return {\r\n            pageSize: +values.pageSize,\r\n            page: +values.page,\r\n            preloaded: values.preloaded,\r\n            current: values.current,\r\n            searchOpt: values.searchOpt,\r\n            _generes: values.generes,\r\n        }\r\n    }, [queryStr])\r\n\r\n    const [_pageSize, setPageSize] = useState(20);\r\n    const [_page, setPage] = useState(0);\r\n\r\n\r\n    useEffect(() => {\r\n        console.log(\"call\")\r\n        if (preloaded && recordsList.length > 0 || loading) { return }\r\n\r\n        if (isAuthenticated && !userId) { return }\r\n        console.log(\"get in\")\r\n        let pg = page || 0;\r\n        let pgSize = pageSize || _pageSize;\r\n\r\n        let searchConsole = true;\r\n\r\n        const where = {};\r\n        if (searchQuery) {\r\n            where.query = searchQuery;\r\n            if (searchOpt) {\r\n                let opt = searchOpt.split(',');\r\n                where.queryOpt = opt;\r\n            }\r\n            setPageTitle(\"Search: \" + searchQuery)\r\n            if (_generes) {//from search params\r\n                where.genereNames = _generes.split(\",\")\r\n            }\r\n        }\r\n\r\n\r\n        if (generes) {\r\n            where.genereNames = generes.split(\",\");\r\n        } else {\r\n            if (user) {\r\n                where.nickname = user;\r\n                setPageTitle(user + \" user records\")\r\n                searchConsole = false;\r\n            } else if (userId && isCurrentUser) {\r\n                where.userId = userId;\r\n                setPageTitle(\"Your records\")\r\n                searchConsole = false;\r\n            }\r\n        }\r\n        setSearchDisplaing(searchConsole);\r\n\r\n        requestList(pgSize, pg, where);\r\n        setPageSize(pgSize);\r\n        setPage(pg)\r\n\r\n    }, [userId,\r\n        requestList,\r\n        _pageSize,\r\n        page,\r\n        pageSize,\r\n        preloaded,\r\n        setPageTitle,\r\n        searchQuery,\r\n        generes,\r\n        loading,\r\n    ])\r\n\r\n    const layoutContext = useContext(LayoutContext);\r\n\r\n    useEffect(() => {\r\n        layoutContext.setFooter(false);\r\n    }, [layoutContext])\r\n\r\n    const getNextPageUrl = useCallback((page, pageSize) => {\r\n        let url = window.location.pathname;\r\n        url += '?pageSize=' + pageSize;\r\n        url += '&page=' + page;\r\n        let search = window.location.search;\r\n        search = search.replace(/pageSize=\\d+/, '');\r\n        search = search.replace(/&page=\\d+/, '');\r\n        search = search.replace('?', '&');\r\n        url += search;\r\n        return url;\r\n    }, [])\r\n\r\n    const changePageSize = useCallback((pageSize) => {\r\n        history.push(getNextPageUrl(_page, pageSize));\r\n    }, [history, _page, getNextPageUrl])\r\n\r\n    const goToPage = useCallback((page) => {\r\n        history.push(getNextPageUrl(page, _pageSize))\r\n    }, [history, _pageSize, getNextPageUrl])\r\n\r\n    const onSearch = useCallback((queryStr, searchOpt) => {\r\n        let search = \"\";\r\n        for (let optName in searchOpt) {\r\n            if (!searchOpt[optName]) {\r\n                search += 'no-' + optName + ',';\r\n            }\r\n        }\r\n        if (search.length > 1) {\r\n            search = \"?searchOpt=\" + search\r\n            search = search.substr(0, search.length - 1)\r\n        }\r\n        if (generes || _generes) { // from route param \r\n            search += (search.length) ? \"&\" : \"?\";\r\n            search += \"&generes=\";\r\n            search += generes || \"\";\r\n            search += _generes || \"\";\r\n        }\r\n\r\n        history.push('/records/search/' + queryStr + search)\r\n    }, [history])\r\n\r\n    return (\r\n        <div className=\"user-records\">\r\n            {displaySearch && <RecordSearch onSearch={onSearch} />}\r\n            <div className=\"user-records-top-bar\">\r\n                <h2 className=\"title\">{pageTitle}</h2>\r\n                <DropdownButton\r\n                    alignRight\r\n                    className=\"btn-pagger\"\r\n                    title={_pageSize + \" on page \"}>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 10)}> 10 </Dropdown.Item>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 20)}> 20 </Dropdown.Item>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 30)}> 30 </Dropdown.Item>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 50)}> 50 </Dropdown.Item>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 75)}> 75 </Dropdown.Item>\r\n                    <Dropdown.Item onClick={changePageSize.bind(null, 100)}> 100 </Dropdown.Item>\r\n                </DropdownButton>\r\n            </div>\r\n\r\n            <RecordsList\r\n                list={recordsList}\r\n                controls={controls}\r\n                player={player} />\r\n            <Pagin\r\n                current={_page}\r\n                call={goToPage}\r\n                all={Math.floor(countAll / _pageSize)} />\r\n            <PlayerControls\r\n                list={recordsList}\r\n                controls={controls}\r\n                player={player} />\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    recordsList: state.records.list,\r\n    countAll: state.records.countAll,\r\n    userId: state.user.dbId,\r\n    userNickname: state.user.nickname,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    requestList: (pageSize, page, where) => dispatch(reqRecOfUser(pageSize, page, where))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecords)\r\n"]},"metadata":{},"sourceType":"module"}