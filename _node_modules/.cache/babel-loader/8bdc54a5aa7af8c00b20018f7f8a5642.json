{"ast":null,"code":"import store from \"./../../../store/\";\nimport ChannelBuilder from \"./channelBuilder/channelBuilder\";\nimport Synchronizer from \"./sync/synchronizer\";\nimport getApi from \"./../../../apis/apiProvider\";\nimport { setCuePoint, setChannelReady, setTimeLeft } from \"./../../../actions\";\nexport default class Channels {\n  constructor() {\n    this.channelBuilder = new ChannelBuilder();\n    this.synchronizer = new Synchronizer(this);\n    this.dispatch = store.dispatch;\n    this.channels = {\n      A: null,\n      B: null\n    };\n    this.stdDivceDiff = {};\n  }\n\n  getChannelNames() {\n    return Object.keys(this.channels);\n  }\n\n  setChannel(channelName, player) {\n    this.channels[channelName] = player;\n  }\n\n  createChannel(channelName, ...args) {\n    this.channels[channelName] = this.channelBuilder.create(channelName, ...args);\n    console.log(this.channels[channelName]);\n  }\n\n  createBars(channelName, values) {\n    this.channelBuilder.createBars(this.getFullCannel(channelName), values);\n  }\n\n  getChannel(channelName) {\n    return this.channels[channelName].master;\n  }\n\n  getFullCannel(channelName) {\n    return this.channels[channelName];\n  }\n\n  getChannelInterface(channelName) {\n    return {\n      getSyncBarPosition: () => this.synchronizer.getSyncBarPostion.call(this.synchronizer, channelName)\n    };\n  } //--------------------------------------------\n\n\n  loadTrack(channelName, track) {\n    let api = getApi(track.source);\n    let url = api && api.getUrl(track.id) || null;\n    this.dispatch(setChannelReady(false, channelName));\n    let player = this.channels[channelName];\n\n    if (player.loadWithEvent) {\n      player.loadWithEvent(url);\n    } else {\n      player.load(url);\n    }\n  }\n\n  updatePosition(channelName) {\n    this.updateTimeLeft(channelName);\n  }\n\n  updateTimeLeft(channelName) {\n    let channel = this.channels[channelName];\n    this.dispatch(setTimeLeft(channelName, parseInt(channel.getDuration() - channel.getCurrentTime())));\n  }\n\n  togglePlay(channelName, currentValue) {\n    if (currentValue) {\n      this.channels[channelName].pause();\n    } else {\n      this.channels[channelName].play();\n    }\n  }\n\n  toggleCue(channelName, currentValue) {\n    const player = this.channels[channelName];\n    const isPaused = store.getState().console.channel[channelName].playBackState.paused;\n\n    if (!currentValue && isPaused) {\n      // back to cue point and pause\n      let cuePoint = store.getState().console.channel[channelName].playBackState.cuePoint; //in seconds\n      //seek to\n\n      player.pause();\n      player.backend.seekTo(cuePoint);\n      player.drawer.progress(cuePoint / player.getDuration());\n      player.drawer.recenter(cuePoint / player.getDuration());\n    } else if (!currentValue) {\n      //Cancel cue and play\n      if (!player.isPlaying()) {\n        player.play();\n      }\n    } else {\n      const cuePoint = this.channels[channelName].getCurrentTime();\n      this.channels[channelName].play();\n      this.dispatch(setCuePoint(channelName, cuePoint)); // in float seconds\n    }\n  }\n\n  adjustPitch(channelName, currentValue) {\n    this.channels[channelName].setPlaybackRate(1 + currentValue / 100);\n  }\n\n  sync(channelName) {\n    this.synchronizer.sync(channelName);\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/core/console/channels/channels.js"],"names":["store","ChannelBuilder","Synchronizer","getApi","setCuePoint","setChannelReady","setTimeLeft","Channels","constructor","channelBuilder","synchronizer","dispatch","channels","A","B","stdDivceDiff","getChannelNames","Object","keys","setChannel","channelName","player","createChannel","args","create","console","log","createBars","values","getFullCannel","getChannel","master","getChannelInterface","getSyncBarPosition","getSyncBarPostion","call","loadTrack","track","api","source","url","getUrl","id","loadWithEvent","load","updatePosition","updateTimeLeft","channel","parseInt","getDuration","getCurrentTime","togglePlay","currentValue","pause","play","toggleCue","isPaused","getState","playBackState","paused","cuePoint","backend","seekTo","drawer","progress","recenter","isPlaying","adjustPitch","setPlaybackRate","sync"],"mappings":"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","sourcesContent":["import store from \"./../../../store/\";\r\nimport ChannelBuilder from \"./channelBuilder/channelBuilder\";\r\nimport Synchronizer from \"./sync/synchronizer\";\r\nimport getApi from \"./../../../apis/apiProvider\";\r\nimport {setCuePoint, \r\n        setChannelReady, \r\n        setTimeLeft \r\n      } from \"./../../../actions\";\r\n\r\n\r\nexport default class Channels {\r\n  constructor() {\r\n    this.channelBuilder = new ChannelBuilder();\r\n    this.synchronizer = new Synchronizer(this);\r\n    this.dispatch = store.dispatch;\r\n    this.channels = {\r\n      A: null,\r\n      B: null\r\n    };\r\n\r\n    this.stdDivceDiff = {};\r\n  }\r\n\r\n  getChannelNames() {\r\n    return Object.keys(this.channels);\r\n  }\r\n\r\n  setChannel(channelName, player) {\r\n    this.channels[channelName] = player;\r\n  }\r\n\r\n  createChannel( channelName, ...args ){\r\n    this.channels[channelName] = \r\n      this.channelBuilder.create( channelName, ...args); \r\n    \r\n    console.log(this.channels[channelName]);\r\n  }\r\n\r\n  createBars( channelName, values ){\r\n    this.channelBuilder.createBars(this.getFullCannel(channelName), values);\r\n  }\r\n\r\n  getChannel(channelName) {\r\n    return this.channels[channelName].master;\r\n  }\r\n\r\n  getFullCannel(channelName){\r\n    return this.channels[channelName];\r\n  }\r\n\r\n  getChannelInterface(channelName) {\r\n    return {\r\n      getSyncBarPosition: () => \r\n        this.synchronizer.getSyncBarPostion.call(this.synchronizer,channelName)\r\n    };\r\n  }\r\n\r\n  //--------------------------------------------\r\n\r\n  loadTrack(channelName, track) {\r\n    let api = getApi(track.source);\r\n    let url = (api && api.getUrl(track.id)) || null;\r\n\r\n    this.dispatch(setChannelReady(false, channelName));\r\n\r\n    let player = this.channels[channelName];\r\n\r\n    if (player.loadWithEvent) {\r\n      player.loadWithEvent(url);\r\n    } else {\r\n      player.load(url);\r\n    }\r\n  }\r\n\r\n  updatePosition(channelName) {\r\n    this.updateTimeLeft(channelName);\r\n  }\r\n\r\n  updateTimeLeft(channelName) {\r\n    let channel = this.channels[channelName];\r\n    this.dispatch(\r\n      setTimeLeft(\r\n        channelName,\r\n        parseInt(channel.getDuration() - channel.getCurrentTime())\r\n      )\r\n    );\r\n  }\r\n\r\n  togglePlay(channelName, currentValue) {\r\n    if (currentValue) {\r\n      this.channels[channelName].pause();\r\n    } else {\r\n      this.channels[channelName].play();\r\n    }\r\n  }\r\n\r\n  toggleCue(channelName, currentValue) {\r\n    const player = this.channels[channelName];\r\n    const isPaused = store.getState().console.channel[channelName]\r\n                    .playBackState.paused;\r\n    if (!currentValue && isPaused) {\r\n      // back to cue point and pause\r\n      let cuePoint = store.getState().console.channel[channelName]\r\n                    .playBackState.cuePoint; //in seconds\r\n      //seek to\r\n      player.pause();\r\n      player.backend.seekTo(cuePoint);\r\n      player.drawer.progress(cuePoint / player.getDuration());\r\n      player.drawer.recenter(cuePoint / player.getDuration());\r\n    } else if (!currentValue) {\r\n      //Cancel cue and play\r\n      if (!player.isPlaying()) {\r\n        player.play();\r\n      }\r\n    } else {\r\n      const cuePoint = this.channels[channelName].getCurrentTime();\r\n      this.channels[channelName].play();\r\n      this.dispatch(setCuePoint(channelName, cuePoint)); // in float seconds\r\n    }\r\n  }\r\n\r\n  adjustPitch(channelName, currentValue) {\r\n    this.channels[channelName].setPlaybackRate(1 + currentValue / 100);\r\n  }\r\n\r\n  sync(channelName){\r\n    this.synchronizer.sync(channelName);\r\n  }\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}