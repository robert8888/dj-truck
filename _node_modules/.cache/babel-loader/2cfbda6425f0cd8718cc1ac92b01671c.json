{"ast":null,"code":"import { ACTIONS } from \"../../../actions\";\nimport { produce } from \"imer\";\nimport { unset, set, get } from \"lodash/object\";\nimport { findClosesDir, generateTemplateName } from \"./utils\";\nconst initState = {\n  list: [],\n  currentPlaylist: [],\n  // path to play list \n  currentSelection: ['root'],\n  // path to dir or playlist current selected\n  root: {},\n  // root dir for play list \n  //mock\n  root: {\n    \"Techno\": {\n      _open: true,\n      \"ZetTempo\": [],\n      \"empty dir\": {},\n      \"HardCore\": [],\n      \"Special\": {\n        _open: true,\n        \"DubTechno\": [],\n        \"Clasic 90\": []\n      }\n    },\n    \"Mini mal\": {\n      \"HighTech\": [],\n      \"Classic\": [],\n      \"EmptyFolder\": {}\n    }\n  }\n};\n\nfunction playListReducer(state = initState, action) {\n  switch (action.type) {\n    case ACTIONS.PL_PUSH_ROOT:\n      {\n        console.log(action.dirContent);\n        const content = action.dirContent;\n        return { ...state,\n          root: {\n            _id: content.dir.id\n          }\n        };\n      }\n\n    case ACTIONS.PUSH_TRACK:\n      {\n        if (state.currentPlaylist.length === 0) {\n          //if is not seelect any play list - create new\n          let pathToDir = [\"root\"];\n\n          if (state.currentSelection.length > 1) {\n            pathToDir = findClosesDir(state, state.currentSelection);\n          }\n\n          const name = generateTemplateName(state, pathToDir, \"New Playlist\");\n          const fullPath = [...pathToDir, name];\n          return produce(state, draftState => {\n            set(draftState, fullPath, []);\n            set(draftState, [...pathToDir, \"_open\"], true);\n            draftState.currentSelection = fullPath;\n            draftState.currentPlaylist = fullPath;\n            const playlist = Array.from(get(draftState, fullPath));\n            playlist.push(action.track);\n            draftState.list = playlist;\n            set(draftState, fullPath, playlist);\n          });\n        }\n\n        return produce(state, draftState => {\n          const list = Array.from(draftState.list);\n          list.push(action.track);\n          draftState.list = list;\n          set(draftState, state.currentPlaylist, Array.from(draftState.list));\n        });\n      }\n\n    case ACTIONS.SET_BPM_AND_OFFSET:\n      {\n        let {\n          id,\n          playlist,\n          bpm,\n          offset\n        } = action;\n        let isCurrent = false;\n\n        if (playlist === undefined || playlist.length === 0) {\n          isCurrent = true;\n          playlist = state.currentPlaylist;\n        }\n\n        const list = Array.from(get(state, playlist));\n        const index = list.findIndex(element => element._id === id);\n\n        if (index === -1) {\n          return state;\n        }\n\n        list[index].bpm = bpm;\n\n        if (offset) {\n          list[index].offset = offset;\n        }\n\n        return produce(state, draftState => {\n          set(draftState, playlist, list);\n\n          if (isCurrent) {\n            draftState.list = list;\n          }\n\n          draftState.refreshFalg = Math.random();\n        });\n      }\n\n    case ACTIONS.PL_TOGGLE_DIR:\n      {\n        const open = get(state, [...action.path, \"_open\"]);\n        return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open));\n      }\n\n    case ACTIONS.PL_SET_SELECTION:\n      {\n        return produce(state, draftState => draftState.currentSelection = action.path);\n      }\n\n    case ACTIONS.PL_SET_CURRENT_PLAYLIST:\n      {\n        return produce(state, draftState => {\n          draftState.currentPlayList = action.path;\n          draftState.list = Array.from(get(state, [action.path]));\n        });\n      }\n\n    case ACTIONS.PL_RENAME_SELECTED:\n      {\n        const content = get(state, state.currentSelection);\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          const newCurrent = draftState.currentSelection;\n          newCurrent.pop();\n          newCurrent.push(action.name);\n          draftState.currentSelection = newCurrent;\n          set(draftState, newCurrent, content);\n        });\n      }\n\n    case ACTIONS.PL_DELETE_SELECTED:\n      {\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          draftState.currentSelection = [];\n        });\n      }\n\n    case ACTIONS.PL_MOVE_TO:\n      {\n        const {\n          pathFrom,\n          pathTo\n        } = action;\n        const content = get(state, pathFrom);\n        const name = pathFrom.pop(); //if target and source are the same don't do anything\n\n        if (pathFrom.length === pathTo.length && pathFrom.every((e, i) => e === pathTo[i])) {\n          return state;\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathTo, name], content);\n          unset(draftState, [...pathFrom, name]);\n        });\n      }\n\n    case ACTIONS.PL_DELETE_TRACK:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          newList.splice(action.index, 1);\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_SWAP_TRACK_ON_CURRENT:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          let trackFrom = newList[action.from];\n          newList[action.from] = newList[action.to];\n          newList[action.to] = trackFrom;\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_ADD_TRACK_TO_LIST:\n      {\n        const list = get(state, action.path);\n        if (!list) return state;\n        return produce(state, draftState => {\n          list.push(action.track);\n          set(draftState, action.fullPath, list);\n        });\n      }\n    // case ACTIONS.PL_CREATE_DIR: {\n    //     console.log(action.name)\n    //     let name = action.name;\n    //     const pathToDir = findClosesDir(state, state.currentSelection);\n    //     if (!name) {\n    //         name = generateTemplateName(state, pathToDir, \"New Folder\");\n    //         console.log(\"new name\", name)\n    //     }\n    //     return produce(state, draftState => {\n    //         set(draftState, [...pathToDir, name], {})\n    //         set(draftState, [...pathToDir, \"_open\"], true);\n    //         draftState.currentSelection = [...pathToDir, name];\n    //     })\n    // }\n\n    case ACTIONS.PL_CREATE_DIR:\n      {\n        const {\n          id,\n          name\n        } = action;\n        const pathToDir = findClosesDir(state, state.currentSelection);\n        return produce(state, draftState => {\n          set(draftState, [...pathToDir, name], {\n            _id: id\n          });\n          set(draftState, [...pathToDir, \"_open\"], true);\n          draftState.currentSelection = [...pathToDir, name];\n        });\n      }\n\n    case ACTIONS.PL_CREATE_PLAYLIST:\n      {\n        let name = action.name;\n        const pathToDir = findClosesDir(state, state.currentSelection);\n\n        if (!name) {\n          name = generateTemplateName(state, pathToDir, \"New Playlist\");\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathToDir, name], []);\n          set(draftState, [...pathToDir, \"_open\"], true);\n          draftState.currentSelection = [...pathToDir, name];\n        });\n      }\n\n    case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST:\n      {\n        return produce(state, draftState => {\n          draftState.list = Array.from(get(state, state.currentSelection));\n          draftState.currentPlaylist = state.currentSelection;\n        });\n      }\n\n    default:\n      return state;\n  }\n}\n\nexport default playListReducer;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/reducers/console/playlist/playlistReducer.js"],"names":["ACTIONS","produce","unset","set","get","findClosesDir","generateTemplateName","initState","list","currentPlaylist","currentSelection","root","_open","playListReducer","state","action","type","PL_PUSH_ROOT","console","log","dirContent","content","_id","dir","id","PUSH_TRACK","length","pathToDir","name","fullPath","draftState","playlist","Array","from","push","track","SET_BPM_AND_OFFSET","bpm","offset","isCurrent","undefined","index","findIndex","element","refreshFalg","Math","random","PL_TOGGLE_DIR","open","path","PL_SET_SELECTION","PL_SET_CURRENT_PLAYLIST","currentPlayList","PL_RENAME_SELECTED","newCurrent","pop","PL_DELETE_SELECTED","PL_MOVE_TO","pathFrom","pathTo","every","e","i","PL_DELETE_TRACK","newList","splice","PL_SWAP_TRACK_ON_CURRENT","trackFrom","to","PL_ADD_TRACK_TO_LIST","PL_CREATE_DIR","PL_CREATE_PLAYLIST","PL_OPEN_CURRENT_PLAY_LIST"],"mappings":"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","sourcesContent":["import { ACTIONS } from \"../../../actions\";\r\nimport { produce } from \"imer\";\r\nimport { unset, set, get } from \"lodash/object\";\r\nimport {findClosesDir, generateTemplateName} from \"./utils\"\r\n\r\nconst initState = {\r\n    list: [],\r\n\r\n    currentPlaylist: [],// path to play list \r\n    currentSelection: ['root'], // path to dir or playlist current selected\r\n    root: {}, // root dir for play list \r\n\r\n    //mock\r\n    root: {\r\n        \"Techno\": {\r\n            _open: true,\r\n            \"ZetTempo\": [],\r\n            \"empty dir\": {},\r\n            \"HardCore\": [],\r\n            \"Special\": {\r\n                _open: true,\r\n                \"DubTechno\": [],\r\n                \"Clasic 90\": []\r\n            }\r\n        },\r\n        \"Mini mal\": {\r\n            \"HighTech\": [],\r\n            \"Classic\": [],\r\n            \"EmptyFolder\": {}\r\n        }\r\n    }\r\n}\r\n\r\nfunction playListReducer(state = initState, action) {\r\n    switch (action.type) {\r\n        case ACTIONS.PL_PUSH_ROOT:{\r\n            console.log(action.dirContent)\r\n            const content = action.dirContent;\r\n            return {\r\n                ...state,\r\n                root: {\r\n                    _id: content.dir.id\r\n                }\r\n            }\r\n        }\r\n\r\n        case ACTIONS.PUSH_TRACK: {\r\n            if (state.currentPlaylist.length === 0) {\r\n                //if is not seelect any play list - create new\r\n                let pathToDir = [\"root\"]\r\n                if (state.currentSelection.length > 1) {\r\n                    pathToDir = findClosesDir(state, state.currentSelection);\r\n                }\r\n                const name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n                const fullPath = [...pathToDir, name];\r\n                return produce(state, draftState => {\r\n                    set(draftState, fullPath, [])\r\n                    set(draftState, [...pathToDir, \"_open\"], true);\r\n                    draftState.currentSelection = fullPath\r\n                    draftState.currentPlaylist = fullPath;\r\n                    const playlist = Array.from(get(draftState, fullPath));\r\n                    playlist.push(action.track);\r\n                    draftState.list = playlist;\r\n                    set(draftState, fullPath, playlist);\r\n                })\r\n            }\r\n            return produce(state, draftState => {\r\n                const list = Array.from(draftState.list);\r\n                list.push(action.track)\r\n                draftState.list = list;\r\n                set(draftState, state.currentPlaylist, Array.from(draftState.list));\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_BPM_AND_OFFSET: {\r\n            let { id, playlist, bpm, offset } = action;\r\n            let isCurrent = false;\r\n            if (playlist === undefined || playlist.length === 0){\r\n                isCurrent = true;\r\n                playlist = state.currentPlaylist;\r\n            }\r\n            const list = Array.from(get(state, playlist));\r\n            const index = list.findIndex(element => element._id === id);\r\n            if(index === -1){\r\n                return state;\r\n            }\r\n            list[index].bpm = bpm;\r\n            if(offset){\r\n                list[index].offset = offset;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, playlist, list);\r\n                if(isCurrent){\r\n                    draftState.list = list;\r\n                }\r\n                draftState.refreshFalg = Math.random();\r\n            })\r\n        }\r\n        case ACTIONS.PL_TOGGLE_DIR: {\r\n            const open = get(state, [...action.path, \"_open\"])\r\n            return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open))\r\n        }\r\n        case ACTIONS.PL_SET_SELECTION: {\r\n            return produce(state, draftState => draftState.currentSelection = action.path)\r\n        }\r\n\r\n        case ACTIONS.PL_SET_CURRENT_PLAYLIST: {\r\n            return produce(state, draftState => {\r\n                draftState.currentPlayList = action.path;\r\n                draftState.list = Array.from(get(state, [action.path]));\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_RENAME_SELECTED: {\r\n            const content = get(state, state.currentSelection);\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                const newCurrent = draftState.currentSelection;\r\n                newCurrent.pop();\r\n                newCurrent.push(action.name);\r\n                draftState.currentSelection = newCurrent;\r\n                set(draftState, newCurrent, content)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_SELECTED: {\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                draftState.currentSelection = [];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_MOVE_TO: {\r\n            const { pathFrom, pathTo } = action;\r\n            const content = get(state, pathFrom);\r\n            const name = pathFrom.pop();\r\n            //if target and source are the same don't do anything\r\n            if (pathFrom.length === pathTo.length &&\r\n                pathFrom.every((e, i) => e === pathTo[i])) {\r\n                return state;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathTo, name], content);\r\n                unset(draftState, [...pathFrom, name]);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_TRACK: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                newList.splice(action.index, 1);\r\n                draftState.list = newList\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SWAP_TRACK_ON_CURRENT: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                let trackFrom = newList[action.from];\r\n                newList[action.from] = newList[action.to];\r\n                newList[action.to] = trackFrom;\r\n                draftState.list = newList;\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_ADD_TRACK_TO_LIST: {\r\n            const list = get(state, action.path);\r\n            if (!list) return state;\r\n            return produce(state, draftState => {\r\n                list.push(action.track);\r\n                set(draftState, action.fullPath, list);\r\n            })\r\n        }\r\n\r\n        // case ACTIONS.PL_CREATE_DIR: {\r\n        //     console.log(action.name)\r\n        //     let name = action.name;\r\n        //     const pathToDir = findClosesDir(state, state.currentSelection);\r\n        //     if (!name) {\r\n        //         name = generateTemplateName(state, pathToDir, \"New Folder\");\r\n        //         console.log(\"new name\", name)\r\n        //     }\r\n        //     return produce(state, draftState => {\r\n        //         set(draftState, [...pathToDir, name], {})\r\n        //         set(draftState, [...pathToDir, \"_open\"], true);\r\n        //         draftState.currentSelection = [...pathToDir, name];\r\n        //     })\r\n        // }\r\n        case ACTIONS.PL_CREATE_DIR:{\r\n            const {id , name} = action;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            return produce(state, draftState =>{\r\n                set(draftState, [...pathToDir, name], {_id: id});\r\n                set(draftState, [...pathToDir, \"_open\"], true);\r\n                draftState.currentSelection = [...pathToDir, name];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_CREATE_PLAYLIST: {\r\n            let name = action.name;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            if (!name) {\r\n                name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], [])\r\n                set(draftState, [...pathToDir, \"_open\"], true);\r\n                draftState.currentSelection = [...pathToDir, name];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST: {\r\n            return produce(state, draftState => {\r\n                draftState.list = Array.from(get(state, state.currentSelection))\r\n                draftState.currentPlaylist = state.currentSelection;\r\n            })\r\n        }\r\n\r\n\r\n        default: return state;\r\n    }\r\n}\r\n\r\nexport default playListReducer;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}