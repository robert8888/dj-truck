{"ast":null,"code":"import _defineProperty from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from\"react\";import{Col,Row}from\"react-bootstrap\";import{connect}from\"react-redux\";import{useHistory,useParams}from\"react-router-dom\";import PlayerControls from\"../common/components/PlayerControls/PlayerControls\";import Record from\"../common/components/Record/Record\";import{loadRecords,reqRecData,reqRecs,setFooterType}from\"./../../actions\";import RecordComments from\"./../common/components/RecordComments/RecordComments\";import RecordDetails from\"./../common/components/RecordDetails/RecordDetails\";import RecordTracklist from\"./../common/components/RecordTracklist/RecordTracklist\";import{useRecordPlayer}from\"./../common/Hooks/useRecordPlayer\";import\"./user-record.scss\";var UserRecord=function UserRecord(_ref){var _React$createElement;var setFooter=_ref.setFooter,requestRecordList=_ref.requestRecordList,recordsList=_ref.recordsList,requestRecordData=_ref.requestRecordData,userId=_ref.userId,setRecordsList=_ref.setRecordsList,countAll=_ref.countAll;var _useRecordPlayer=useRecordPlayer(),_useRecordPlayer2=_slicedToArray(_useRecordPlayer,2),controls=_useRecordPlayer2[0],player=_useRecordPlayer2[1];var _useParams=useParams(),user=_useParams.user,title=_useParams.title,id=_useParams.id;var history=useHistory();var _useState=useState(),_useState2=_slicedToArray(_useState,2),record=_useState2[0],setRecord=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),tracklist=_useState4[0],setTracklist=_useState4[1];var reqFlag=useRef();var escapeUnderdash=useCallback(function(str){return str.split(\"_\").join(\" \");},[]);useEffect(function(){setFooter(\"player\");},[setFooter]);useEffect(function(){if(!title&&!user){history.replace('/records');return;}if(!title&&user){history.replace('/records/'+user);return;}var _title=escapeUnderdash(title);var recs=recordsList===null||recordsList===void 0?void 0:recordsList.filter(function(r){return r.title===_title;});if(id){var _id=parseInt(id);recs=recs.filter(function(r){return r.id===_id;});}//if is exact this record \nif(recs&&recs.length===1){setRecord(recs[0]);return;}//if there is none record request it\nif((recs&&recs.length===0||!recs)&&!reqFlag.current){var where={title:_title};if(id){where.id=+id;}if(user){where.nickname=user;}else if(userId){where.userId=userId;}requestRecordList(100,0,where);//to prevent reqesting again if result is empty\nreqFlag.current=true;return;}// if is more than one record with this title \nif(recs.length>1){setRecordsList(recs);history.replace('/records?preloaded=true');}if(countAll===0){history.replace('/404');}},[recordsList,setRecord,title,id,userId,user,setRecordsList,escapeUnderdash,reqFlag,history]);useEffect(function(){if(!record)return;requestRecordData(record.id);},[record]);var seekToTrack=useCallback(function(time){if(!controls||!player||!record||time===undefined)return;controls.seek({id:record.id,progress:time/(record.duration/1000),duration:record.duration});},[controls,player,record]);return React.createElement(\"div\",{className:\"user-record\"},React.createElement(Record,{record:record,controls:controls,player:player,simple:true}),React.createElement(Row,null,React.createElement(Col,(_React$createElement={xs:12},_defineProperty(_React$createElement,\"xs\",{order:2}),_defineProperty(_React$createElement,\"md\",6),_defineProperty(_React$createElement,\"md\",{order:1}),_React$createElement),React.createElement(RecordComments,null)),React.createElement(Col,_defineProperty({xs:12,md:6},\"md\",{order:2}),React.createElement(RecordDetails,{record:record}),React.createElement(RecordTracklist,{onSeek:seekToTrack}))),React.createElement(PlayerControls,{controls:controls,player:player,list:record}));};var mapStateToProps=function mapStateToProps(state){return{recordsList:state.records.list,countAll:state.records.countAll,userId:state.user.dbId};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{requestRecordList:function requestRecordList(pageSize,page,where){return dispatch(reqRecs(pageSize,page,where));},requestRecordData:function requestRecordData(id){return dispatch(reqRecData(id));},setRecordsList:function setRecordsList(list){return dispatch(loadRecords(list));},setFooter:function setFooter(type){return dispatch(setFooterType(type));}};};export default connect(mapStateToProps,mapDispatchToProps)(UserRecord);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/userRecord/UserRecord.js"],"names":["React","useCallback","useEffect","useRef","useState","Col","Row","connect","useHistory","useParams","PlayerControls","Record","loadRecords","reqRecData","reqRecs","setFooterType","RecordComments","RecordDetails","RecordTracklist","useRecordPlayer","UserRecord","setFooter","requestRecordList","recordsList","requestRecordData","userId","setRecordsList","countAll","controls","player","user","title","id","history","record","setRecord","tracklist","setTracklist","reqFlag","escapeUnderdash","str","split","join","replace","_title","recs","filter","r","_id","parseInt","length","current","where","nickname","seekToTrack","time","undefined","seek","progress","duration","order","mapStateToProps","state","records","list","dbId","mapDispatchToProps","dispatch","pageSize","page","type"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { Col, Row } from \"react-bootstrap\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport PlayerControls from \"../common/components/PlayerControls/PlayerControls\";\r\nimport Record from \"../common/components/Record/Record\";\r\nimport { loadRecords, reqRecData, reqRecs, setFooterType } from \"./../../actions\";\r\nimport RecordComments from \"./../common/components/RecordComments/RecordComments\";\r\nimport RecordDetails from \"./../common/components/RecordDetails/RecordDetails\";\r\nimport RecordTracklist from \"./../common/components/RecordTracklist/RecordTracklist\";\r\nimport { useRecordPlayer } from \"./../common/Hooks/useRecordPlayer\";\r\nimport \"./user-record.scss\";\r\n\r\nconst UserRecord = ({ \r\n        setFooter,\r\n        requestRecordList, \r\n        recordsList,\r\n        requestRecordData, \r\n        userId, \r\n        setRecordsList, \r\n        countAll }) => {\r\n    const [controls, player] = useRecordPlayer();\r\n    const { user, title, id } = useParams();\r\n    const history = useHistory()\r\n    const [record, setRecord] = useState();\r\n    const [tracklist, setTracklist] = useState(null);\r\n\r\n    const reqFlag = useRef();\r\n\r\n    const escapeUnderdash = useCallback(str => str.split(\"_\").join(\" \"), []);\r\n\r\n    useEffect(()=>{\r\n        setFooter(\"player\")\r\n    },[setFooter])\r\n\r\n    useEffect(() => {\r\n        if (!title && !user) { \r\n            history.replace('/records') \r\n            return;\r\n        }\r\n        if (!title && user) {\r\n            history.replace('/records/' + user)\r\n            return;\r\n        }\r\n\r\n        const _title = escapeUnderdash(title);\r\n\r\n        let recs = recordsList?.filter(r => r.title === _title)\r\n        if (id) {\r\n            let _id = parseInt(id)\r\n            recs = recs.filter(r => r.id === _id);\r\n        }\r\n        //if is exact this record \r\n        if (recs && recs.length === 1) {\r\n            setRecord(recs[0]);\r\n            return;\r\n        }\r\n        //if there is none record request it\r\n        if ((recs && recs.length === 0 || !recs) && !reqFlag.current) {\r\n\r\n            const where = { title: _title}\r\n            if (id) {\r\n                where.id = +id;\r\n            }\r\n\r\n            if (user) {\r\n                where.nickname = user;\r\n            } else if (userId) {\r\n                where.userId = userId;\r\n            }\r\n        \r\n            requestRecordList(100, 0, where);\r\n            //to prevent reqesting again if result is empty\r\n            reqFlag.current = true;\r\n            return;\r\n        }\r\n        // if is more than one record with this title \r\n\r\n        if(recs.length > 1){\r\n            setRecordsList(recs);\r\n            history.replace('/records?preloaded=true')\r\n        }\r\n\r\n        if(countAll === 0){\r\n            history.replace('/404')\r\n        }\r\n\r\n    }, [recordsList, \r\n        setRecord, \r\n        title, \r\n        id, \r\n        userId,\r\n        user, \r\n        setRecordsList, \r\n        escapeUnderdash, \r\n        reqFlag,\r\n        history, \r\n    ])\r\n\r\n    useEffect(() => {\r\n        if(!record) return;\r\n        requestRecordData(record.id);\r\n    }, [record])\r\n\r\n    const seekToTrack = useCallback((time)=>{\r\n        if(!controls || !player || !record || time === undefined) return;\r\n        \r\n        controls.seek({\r\n            id: record.id,\r\n            progress: time / (record.duration / 1000),\r\n            duration: record.duration,\r\n        })\r\n    },[controls, player, record])\r\n\r\n    return (\r\n        <div className=\"user-record\">\r\n            <Record record={record} controls={controls} player={player} simple />\r\n            <Row>\r\n                <Col xs={12} xs={{order: 2}}  md={6} md={{order:1}}>\r\n                    <RecordComments/>\r\n                </Col>\r\n                <Col xs={12} md={6}  md={{order:2}}>\r\n                    <RecordDetails record={record} />\r\n                    <RecordTracklist onSeek={seekToTrack}/>\r\n                </Col> \r\n            </Row>\r\n            <PlayerControls controls={controls} player={player} list={record} />\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    recordsList: state.records.list,\r\n    countAll: state.records.countAll,\r\n    userId: state.user.dbId,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    requestRecordList: (pageSize, page, where) => dispatch(reqRecs(pageSize, page, where)),\r\n    requestRecordData: (id) => dispatch(reqRecData(id)),\r\n    setRecordsList: (list) => dispatch(loadRecords(list)),\r\n    setFooter: (type) => dispatch(setFooterType(type))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecord)\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}