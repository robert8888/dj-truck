{"ast":null,"code":"import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _objectSpread from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{ACTIONS}from\"./../../actions\";import{produce}from\"imer\";var initDeckState={track:{title:\"\",bpm:0,offset:0,quality:\"\",duration:\"\",source:\"\",sourceId:\"\",id:\"\",thumbnail:{}},// \nplayBackState:{ready:false,loadingProgress:0,paused:true,cuePoint:0,cueActive:false,pitch:0,timeLeft:null,offset:null,// move this to track now is in both\nsync:false,loop:false},deckState:{loopLength:-1}};var initState={master:null,//A, B ....\nchannel:{A:_objectSpread({},initDeckState),B:_objectSpread({},initDeckState)}};function nextState(part){return function(state,destination,haveToBeReady,variables){if(!state.channel[destination])return state;if(haveToBeReady&&!state.channel[destination].playBackState.ready)return state;var nextState=produce(state,function(draftState){for(var _i=0,_Object$entries=Object.entries(variables);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),variable=_Object$entries$_i[0],value=_Object$entries$_i[1];switch(part){case\"playBackState\":{draftState.channel[destination].playBackState[variable]=value;break;}case\"track\":{draftState.channel[destination].track[variable]=value;break;}case\"deckState\":{draftState.channel[destination].deckState[variable]=value;break;}default:break;}}});return nextState;};}var nextPlayBackState=nextState('playBackState');var nextTrackState=nextState('track');var nextDeckState=nextState('deckState');function consoleReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case ACTIONS.CONSOLE_RESET:{console.log('reset');var channels=Object.keys(state.channel);return produce(state,function(draftState){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=channels[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var channel=_step.value;draftState.channel[channel].playBackState=initDeckState.playBackState;draftState.channel[channel].track=initDeckState.track;}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}});}case ACTIONS.LOAD_TRACK:{var nextTrack=action.track;if(state.channel[action.destination].track.id===nextTrack.id){return state;}return produce(state,function(draftState){draftState.channel[action.destination].track={title:nextTrack.title,bpm:nextTrack.bpm||0,offset:nextTrack.offset,quality:nextTrack.quality,duration:nextTrack.duration,source:nextTrack.source,id:nextTrack.id,sourceId:nextTrack.sourceId,thumbnails:nextTrack.thumbnails};//reseting  play back state\ndraftState.channel[action.destination].playBackState=_objectSpread({},initState.channel[action.destination].playBackState,{offset:nextTrack.offset,loopLength:state.channel[action.destination].playBackState.loopLength});});}case ACTIONS.SET_LOADING_PROGRESS:{return nextPlayBackState(state,action.destination,false,{loadingProgress:action.value});}case ACTIONS.SET_READY:{return nextPlayBackState(state,action.destination,false,{ready:action.value});}case ACTIONS.SET_PITCH:{return nextPlayBackState(state,action.destination,false,{pitch:action.pitch});}case ACTIONS.INCREASE_PITCH:{var _state$channel$action,_state$channel$action2;var prevPitch=(_state$channel$action=state.channel[action.destination])===null||_state$channel$action===void 0?void 0:(_state$channel$action2=_state$channel$action.playBackState)===null||_state$channel$action2===void 0?void 0:_state$channel$action2.pitch;if(prevPitch===undefined)return state;return nextPlayBackState(state,action.destination,false,{pitch:prevPitch+action.amount});}case ACTIONS.DECREASE_PITCH:{var _state$channel$action3,_state$channel$action4;var _prevPitch=(_state$channel$action3=state.channel[action.destination])===null||_state$channel$action3===void 0?void 0:(_state$channel$action4=_state$channel$action3.playBackState)===null||_state$channel$action4===void 0?void 0:_state$channel$action4.pitch;if(_prevPitch===undefined)return state;return nextPlayBackState(state,action.destination,false,{pitch:_prevPitch-action.amount});}case ACTIONS.TOGGLE_PLAY:{var _state$channel$action5,_state$channel$action6;var prevPause=(_state$channel$action5=state.channel[action.destination])===null||_state$channel$action5===void 0?void 0:(_state$channel$action6=_state$channel$action5.playBackState)===null||_state$channel$action6===void 0?void 0:_state$channel$action6.paused;prevPause=prevPause===undefined?true:prevPause;return nextPlayBackState(state,action.destination,true,{paused:!prevPause});}case ACTIONS.SET_TIME_LEFT:{return nextPlayBackState(state,action.destination,true,{timeLeft:action.timeLeft});}case ACTIONS.TOGGLE_CUE:{var _state$channel$action7,_state$channel$action8;var prevCue=(_state$channel$action7=state.channel[action.destination])===null||_state$channel$action7===void 0?void 0:(_state$channel$action8=_state$channel$action7.playBackState)===null||_state$channel$action8===void 0?void 0:_state$channel$action8.cueActive;prevCue=prevCue===undefined?false:prevCue;return nextPlayBackState(state,action.destination,true,{cueActive:!prevCue});}case ACTIONS.CANCEL_CUE_AND_PLAY:{return nextPlayBackState(state,action.destination,true,{cueActive:false,paused:false});}case ACTIONS.SET_CUE_POINT:{return nextPlayBackState(state,action.destination,true,{cuePoint:action.position});}case ACTIONS.SET_MASTER:{var nextMaster=action.destination===state.master?\"\":action.destination;return produce(state,function(draftState){return draftState.master=nextMaster;});}case ACTIONS.TOGGLE_SYNC:{var _state$channel$action9,_state$channel$action10,_state$channel$action11,_state$channel$action12;var prevSync=(_state$channel$action9=state.channel[action.destination])===null||_state$channel$action9===void 0?void 0:(_state$channel$action10=_state$channel$action9.playBackState)===null||_state$channel$action10===void 0?void 0:_state$channel$action10.sync;prevSync=prevSync===undefined?false:prevSync;var offset=(_state$channel$action11=state.channel[action.destination])===null||_state$channel$action11===void 0?void 0:(_state$channel$action12=_state$channel$action11.playBackState)===null||_state$channel$action12===void 0?void 0:_state$channel$action12.offset;if(!offset&&!prevSync)return state;// can't turn on sync if offset is not calculated \nreturn nextPlayBackState(state,action.destination,true,{sync:!prevSync});}case ACTIONS.SET_SYNC:{var _state$channel$action13,_state$channel$action14;var _offset=(_state$channel$action13=state.channel[action.destination])===null||_state$channel$action13===void 0?void 0:(_state$channel$action14=_state$channel$action13.playBackState)===null||_state$channel$action14===void 0?void 0:_state$channel$action14.offset;if(!_offset)return state;// can't turn on sync if offset is not calculated \nreturn nextPlayBackState(state,action.destination,true,{sync:action.value});}case ACTIONS.PL_SET_BPM_AND_OFFSET:{if(action.bpm===undefined||action.bpm===null||action.offset===undefined||action.offset===null){return state;}var _channels=[];for(var _i2=0,_Object$keys=Object.keys(state.channel);_i2<_Object$keys.length;_i2++){var channelName=_Object$keys[_i2];if(state.channel[channelName].track.id===action.id){_channels.push(channelName);}}if(_channels.length===0)return state;return _channels.reduce(function(prevState,channelName){var trackState=nextTrackState(prevState,channelName,false,{bpm:action.bpm,offset:action.offset});return nextPlayBackState(trackState,channelName,false,{offset:action.offset});},state);}case ACTIONS.SET_LOOP:{var paused=state.channel[action.destination].playBackState.paused;var bpm=state.channel[action.destination].track.bpm;var _offset2=state.channel[action.destination].playBackState.offset;var newValue=action.value;if(paused||!bpm||_offset2===null){newValue=false;}return nextPlayBackState(state,action.destination,true,{loop:newValue});}case ACTIONS.SET_LOOP_LENGTH:{return nextDeckState(state,action.destination,false,{loopLength:action.value});}default:return state;}}export default consoleReducer;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/reducers/console/decksReducer.js"],"names":["ACTIONS","produce","initDeckState","track","title","bpm","offset","quality","duration","source","sourceId","id","thumbnail","playBackState","ready","loadingProgress","paused","cuePoint","cueActive","pitch","timeLeft","sync","loop","deckState","loopLength","initState","master","channel","A","B","nextState","part","state","destination","haveToBeReady","variables","draftState","Object","entries","variable","value","nextPlayBackState","nextTrackState","nextDeckState","consoleReducer","action","type","CONSOLE_RESET","console","log","channels","keys","LOAD_TRACK","nextTrack","thumbnails","SET_LOADING_PROGRESS","SET_READY","SET_PITCH","INCREASE_PITCH","prevPitch","undefined","amount","DECREASE_PITCH","TOGGLE_PLAY","prevPause","SET_TIME_LEFT","TOGGLE_CUE","prevCue","CANCEL_CUE_AND_PLAY","SET_CUE_POINT","position","SET_MASTER","nextMaster","TOGGLE_SYNC","prevSync","SET_SYNC","PL_SET_BPM_AND_OFFSET","channelName","push","length","reduce","prevState","trackState","SET_LOOP","newValue","SET_LOOP_LENGTH"],"mappings":"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","sourcesContent":["import { ACTIONS } from \"./../../actions\";\r\nimport { produce } from \"imer\";\r\n\r\nconst initDeckState = {\r\n    track: {\r\n        title: \"\",\r\n        bpm: 0,\r\n        offset: 0,\r\n        quality: \"\",\r\n        duration: \"\",\r\n        source: \"\",\r\n        sourceId: \"\",\r\n        id: \"\",\r\n        thumbnail: {}\r\n    }, // \r\n    playBackState: {\r\n        ready: false,\r\n        loadingProgress: 0,\r\n        paused: true,\r\n        cuePoint: 0,\r\n        cueActive: false,\r\n        pitch: 0,\r\n        timeLeft: null,\r\n        offset: null, // move this to track now is in both\r\n        sync: false,\r\n        loop: false,\r\n    },\r\n    deckState: {\r\n        loopLength: -1,\r\n    }\r\n}\r\n\r\n\r\nconst initState = {\r\n    master: null,//A, B ....\r\n    channel: {\r\n        A: {\r\n            ...initDeckState\r\n        },\r\n        B: {\r\n            ...initDeckState\r\n        }\r\n    },\r\n}\r\n\r\nfunction nextState(part) {\r\n    return (state, destination, haveToBeReady, variables) => {\r\n\r\n        if (!state.channel[destination]) return state;\r\n        if (haveToBeReady && !state.channel[destination].playBackState.ready) return state;\r\n\r\n        const nextState = produce(state, (draftState) => {\r\n            for (let [variable, value] of Object.entries(variables)) {\r\n                switch (part) {\r\n                    case \"playBackState\": {\r\n                        draftState.channel[destination].playBackState[variable] = value;\r\n                        break;\r\n                    }\r\n                    case \"track\": {\r\n                        draftState.channel[destination].track[variable] = value;\r\n                        break;\r\n                    }\r\n                    case \"deckState\": {\r\n                        draftState.channel[destination].deckState[variable] = value;\r\n                        break;\r\n                    }\r\n                    default: break;\r\n                }\r\n            }\r\n        })\r\n\r\n        return nextState;\r\n    }\r\n}\r\n\r\nconst nextPlayBackState = nextState('playBackState');\r\nconst nextTrackState = nextState('track');\r\nconst nextDeckState = nextState('deckState');\r\n\r\n\r\n\r\nfunction consoleReducer(state = initState, action) {\r\n    switch (action.type) {\r\n        case ACTIONS.CONSOLE_RESET : {\r\n            console.log('reset')\r\n            let channels = Object.keys(state.channel);\r\n            return produce(state, draftState=>{\r\n                for(let channel of channels){\r\n                    draftState.channel[channel].playBackState = initDeckState.playBackState;\r\n                    draftState.channel[channel].track = initDeckState.track;\r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.LOAD_TRACK: {\r\n            const nextTrack = action.track;\r\n            if (state.channel[action.destination].track.id === nextTrack.id) {\r\n                return state;\r\n            }\r\n            return produce(state, draftState => {\r\n                draftState.channel[action.destination].track = {\r\n                    title: nextTrack.title,\r\n                    bpm: nextTrack.bpm || 0,\r\n                    offset: nextTrack.offset,\r\n                    quality: nextTrack.quality,\r\n                    duration: nextTrack.duration,\r\n                    source: nextTrack.source,\r\n                    id: nextTrack.id,\r\n                    sourceId: nextTrack.sourceId,\r\n                    thumbnails: nextTrack.thumbnails,\r\n                }\r\n                //reseting  play back state\r\n                draftState.channel[action.destination].playBackState = {\r\n                    ...initState.channel[action.destination].playBackState,\r\n                    offset: nextTrack.offset,\r\n                    loopLength: state.channel[action.destination].playBackState.loopLength,\r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_LOADING_PROGRESS: {\r\n            return nextPlayBackState(state, action.destination, false, { loadingProgress: action.value })\r\n        }\r\n\r\n        case ACTIONS.SET_READY: {\r\n            return nextPlayBackState(state, action.destination, false, { ready: action.value })\r\n        }\r\n\r\n        case ACTIONS.SET_PITCH: {\r\n            return nextPlayBackState(state, action.destination, false, { pitch: action.pitch })\r\n        }\r\n\r\n        case ACTIONS.INCREASE_PITCH: {\r\n            let prevPitch = state.channel[action.destination]?.playBackState?.pitch;\r\n            if (prevPitch === undefined) return state;\r\n            return nextPlayBackState(state, action.destination, false, { pitch: prevPitch + action.amount })\r\n        }\r\n\r\n        case ACTIONS.DECREASE_PITCH: {\r\n            let prevPitch = state.channel[action.destination]?.playBackState?.pitch;\r\n            if (prevPitch === undefined) return state;\r\n            return nextPlayBackState(state, action.destination, false, { pitch: prevPitch - action.amount })\r\n        }\r\n\r\n\r\n        case ACTIONS.TOGGLE_PLAY: {\r\n            let prevPause = state.channel[action.destination]?.playBackState?.paused;\r\n            prevPause = (prevPause === undefined) ? true : prevPause;\r\n            return nextPlayBackState(state, action.destination, true, { paused: !prevPause })\r\n        }\r\n\r\n        case ACTIONS.SET_TIME_LEFT: {\r\n            return nextPlayBackState(state, action.destination, true, { timeLeft: action.timeLeft })\r\n        }\r\n\r\n        case ACTIONS.TOGGLE_CUE: {\r\n            let prevCue = state.channel[action.destination]?.playBackState?.cueActive;\r\n            prevCue = (prevCue === undefined) ? false : prevCue;\r\n            return nextPlayBackState(state, action.destination, true, { cueActive: !prevCue })\r\n        }\r\n\r\n        case ACTIONS.CANCEL_CUE_AND_PLAY: {\r\n            return nextPlayBackState(state, action.destination, true, {\r\n                cueActive: false,\r\n                paused: false,\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_CUE_POINT: {\r\n            return nextPlayBackState(state, action.destination, true, { cuePoint: action.position })\r\n        }\r\n\r\n\r\n        case ACTIONS.SET_MASTER: {\r\n            const nextMaster = (action.destination === state.master)\r\n                ? \"\"\r\n                : action.destination;\r\n            return produce(state, draftState => draftState.master = nextMaster)\r\n        }\r\n\r\n        case ACTIONS.TOGGLE_SYNC: {\r\n            let prevSync = state.channel[action.destination]?.playBackState?.sync;\r\n            prevSync = (prevSync === undefined) ? false : prevSync;\r\n            let offset = state.channel[action.destination]?.playBackState?.offset;\r\n            if (!offset && !prevSync) return state// can't turn on sync if offset is not calculated \r\n            return nextPlayBackState(state, action.destination, true, { sync: !prevSync })\r\n        }\r\n\r\n        case ACTIONS.SET_SYNC: {\r\n            let offset = state.channel[action.destination]?.playBackState?.offset;\r\n            if (!offset) return state;// can't turn on sync if offset is not calculated \r\n            return nextPlayBackState(state, action.destination, true, { sync: action.value });\r\n        }\r\n\r\n\r\n        case ACTIONS.PL_SET_BPM_AND_OFFSET: {\r\n            if(action.bpm === undefined || action.bpm === null ||\r\n               action.offset === undefined || action.offset === null){\r\n                return state;\r\n            }\r\n            let channels = [];\r\n            for (let channelName of Object.keys(state.channel)) {\r\n                if (state.channel[channelName].track.id === action.id) {\r\n                    channels.push(channelName);\r\n                }\r\n            }\r\n            if (channels.length === 0) return state;\r\n\r\n            return channels.reduce((prevState, channelName) => {\r\n                let trackState = nextTrackState(prevState, channelName, false, { bpm: action.bpm, offset:action.offset });\r\n                return nextPlayBackState(trackState, channelName, false, { offset: action.offset })\r\n            }, state);\r\n        }\r\n\r\n        case ACTIONS.SET_LOOP: {\r\n            const paused = state.channel[action.destination].playBackState.paused;\r\n            const bpm = state.channel[action.destination].track.bpm;\r\n            const offset = state.channel[action.destination].playBackState.offset;\r\n\r\n            let newValue = action.value;\r\n            if (paused || !bpm || offset === null) {\r\n                newValue = false;\r\n            }\r\n            return nextPlayBackState(state, action.destination, true, { loop: newValue });\r\n        }\r\n\r\n\r\n        case ACTIONS.SET_LOOP_LENGTH: {\r\n            return nextDeckState(state, action.destination, false, { loopLength: action.value });\r\n        }\r\n\r\n\r\n        default: return state;\r\n    }\r\n}\r\n\r\nexport default consoleReducer;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}