{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\src\\\\pages\\\\userRecord\\\\UserRecord.js\";\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { Col, Row } from \"react-bootstrap\";\nimport { connect } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport PlayerControls from \"../common/components/PlayerControls/PlayerControls\";\nimport Record from \"../common/components/Record/Record\";\nimport { loadRecords, reqRecData, reqRecs, setFooterType } from \"./../../actions\";\nimport RecordComments from \"./../common/components/RecordComments/RecordComments\";\nimport RecordDetails from \"./../common/components/RecordDetails/RecordDetails\";\nimport RecordTracklist from \"./../common/components/RecordTracklist/RecordTracklist\";\nimport { usePlayer } from \"./../common/Hooks/usePlayer\";\nimport \"./user-record.scss\";\n\nconst UserRecord = ({\n  setFooter,\n  requestRecordList,\n  recordsList,\n  requestRecordData,\n  userId,\n  setRecordsList,\n  countAll\n}) => {\n  const [controls, player] = usePlayer();\n  const {\n    user,\n    title,\n    id\n  } = useParams();\n  const history = useHistory();\n  const [record, setRecord] = useState();\n  const reqFlag = useRef();\n  const escapeUnderdash = useCallback(str => str.split(\"_\").join(\" \"), []);\n  useEffect(() => {\n    setFooter(\"player\");\n  }, [setFooter]);\n  useEffect(() => {\n    if (!title && !user) {\n      history.replace('/records');\n      return;\n    }\n\n    if (!title && user) {\n      history.replace('/records/' + user);\n      return;\n    }\n\n    const _title = escapeUnderdash(title);\n\n    let recs = recordsList === null || recordsList === void 0 ? void 0 : recordsList.filter(r => r.title === _title);\n\n    if (id) {\n      let _id = parseInt(id);\n\n      recs = recs.filter(r => r.id === _id);\n    } //if is exact this record \n\n\n    if (recs && recs.length === 1) {\n      setRecord(recs[0]);\n      return;\n    } //if there is none record request it\n\n\n    if ((recs && recs.length === 0 || !recs) && !reqFlag.current) {\n      const where = {\n        title: _title\n      };\n\n      if (id) {\n        where.id = +id;\n      }\n\n      if (user) {\n        where.nickname = user;\n      } else if (userId) {\n        where.userId = userId;\n      }\n\n      requestRecordList(100, 0, where); //to prevent reqesting again if result is empty\n\n      reqFlag.current = true;\n      return;\n    } // if is more than one record with this title \n\n\n    if (recs.length > 1) {\n      setRecordsList(recs);\n      history.replace('/records?preloaded=true');\n    }\n\n    if (countAll === 0) {\n      history.replace('/404');\n    }\n  }, [id, title, user, userId, recordsList, setRecord, setRecordsList, escapeUnderdash, reqFlag, history, countAll, requestRecordList]);\n  useEffect(() => {\n    if (!record) return;\n    requestRecordData(record.id);\n  }, [record, requestRecordData]);\n  const seekToTrack = useCallback(time => {\n    if (!controls || !player || !record || time === undefined) return;\n    controls.seek({\n      id: record.id,\n      progress: time / (record.duration / 1000),\n      duration: record.duration\n    });\n  }, [controls, player, record]);\n  return React.createElement(\"div\", {\n    className: \"user-record\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118\n    },\n    __self: this\n  }, React.createElement(Record, {\n    record: record,\n    controls: controls,\n    player: player,\n    simple: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  }), React.createElement(Row, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120\n    },\n    __self: this\n  }, React.createElement(Col, {\n    xs: {\n      span: 12,\n      order: 2\n    },\n    md: {\n      span: 6,\n      order: 1\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(RecordComments, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  })), React.createElement(Col, {\n    xs: 12,\n    md: {\n      span: 6,\n      order: 2\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124\n    },\n    __self: this\n  }, React.createElement(RecordDetails, {\n    record: record,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }), React.createElement(RecordTracklist, {\n    onSeek: seekToTrack,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }))), React.createElement(PlayerControls, {\n    controls: controls,\n    player: player,\n    list: record,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }));\n};\n\nconst mapStateToProps = state => ({\n  recordsList: state.records.list,\n  countAll: state.records.countAll,\n  userId: state.user.dbId\n});\n\nconst mapDispatchToProps = dispatch => ({\n  requestRecordList: (pageSize, page, where) => dispatch(reqRecs(pageSize, page, where)),\n  requestRecordData: id => dispatch(reqRecData(id)),\n  setRecordsList: list => dispatch(loadRecords(list)),\n  setFooter: type => dispatch(setFooterType(type))\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecord);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/userRecord/UserRecord.js"],"names":["React","useCallback","useEffect","useRef","useState","Col","Row","connect","useHistory","useParams","PlayerControls","Record","loadRecords","reqRecData","reqRecs","setFooterType","RecordComments","RecordDetails","RecordTracklist","usePlayer","UserRecord","setFooter","requestRecordList","recordsList","requestRecordData","userId","setRecordsList","countAll","controls","player","user","title","id","history","record","setRecord","reqFlag","escapeUnderdash","str","split","join","replace","_title","recs","filter","r","_id","parseInt","length","current","where","nickname","seekToTrack","time","undefined","seek","progress","duration","span","order","mapStateToProps","state","records","list","dbId","mapDispatchToProps","dispatch","pageSize","page","type"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,WAAhB,EAA6BC,SAA7B,EAAwCC,MAAxC,EAAgDC,QAAhD,QAAgE,OAAhE;AACA,SAASC,GAAT,EAAcC,GAAd,QAAyB,iBAAzB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,UAAT,EAAqBC,SAArB,QAAsC,kBAAtC;AACA,OAAOC,cAAP,MAA2B,oDAA3B;AACA,OAAOC,MAAP,MAAmB,oCAAnB;AACA,SAASC,WAAT,EAAsBC,UAAtB,EAAkCC,OAAlC,EAA2CC,aAA3C,QAAgE,iBAAhE;AACA,OAAOC,cAAP,MAA2B,sDAA3B;AACA,OAAOC,aAAP,MAA0B,oDAA1B;AACA,OAAOC,eAAP,MAA4B,wDAA5B;AACA,SAASC,SAAT,QAA0B,6BAA1B;AACA,OAAO,oBAAP;;AAEA,MAAMC,UAAU,GAAG,CAAC;AACZC,EAAAA,SADY;AAEZC,EAAAA,iBAFY;AAGZC,EAAAA,WAHY;AAIZC,EAAAA,iBAJY;AAKZC,EAAAA,MALY;AAMZC,EAAAA,cANY;AAOZC,EAAAA;AAPY,CAAD,KAOI;AACnB,QAAM,CAACC,QAAD,EAAWC,MAAX,IAAqBV,SAAS,EAApC;AACA,QAAM;AAAEW,IAAAA,IAAF;AAAQC,IAAAA,KAAR;AAAeC,IAAAA;AAAf,MAAsBvB,SAAS,EAArC;AACA,QAAMwB,OAAO,GAAGzB,UAAU,EAA1B;AACA,QAAM,CAAC0B,MAAD,EAASC,SAAT,IAAsB/B,QAAQ,EAApC;AAEA,QAAMgC,OAAO,GAAGjC,MAAM,EAAtB;AAEA,QAAMkC,eAAe,GAAGpC,WAAW,CAACqC,GAAG,IAAIA,GAAG,CAACC,KAAJ,CAAU,GAAV,EAAeC,IAAf,CAAoB,GAApB,CAAR,EAAkC,EAAlC,CAAnC;AAEAtC,EAAAA,SAAS,CAAC,MAAI;AACVmB,IAAAA,SAAS,CAAC,QAAD,CAAT;AACH,GAFQ,EAEP,CAACA,SAAD,CAFO,CAAT;AAIAnB,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAI,CAAC6B,KAAD,IAAU,CAACD,IAAf,EAAqB;AACjBG,MAAAA,OAAO,CAACQ,OAAR,CAAgB,UAAhB;AACA;AACH;;AACD,QAAI,CAACV,KAAD,IAAUD,IAAd,EAAoB;AAChBG,MAAAA,OAAO,CAACQ,OAAR,CAAgB,cAAcX,IAA9B;AACA;AACH;;AAED,UAAMY,MAAM,GAAGL,eAAe,CAACN,KAAD,CAA9B;;AAEA,QAAIY,IAAI,GAAGpB,WAAH,aAAGA,WAAH,uBAAGA,WAAW,CAAEqB,MAAb,CAAoBC,CAAC,IAAIA,CAAC,CAACd,KAAF,KAAYW,MAArC,CAAX;;AACA,QAAIV,EAAJ,EAAQ;AACJ,UAAIc,GAAG,GAAGC,QAAQ,CAACf,EAAD,CAAlB;;AACAW,MAAAA,IAAI,GAAGA,IAAI,CAACC,MAAL,CAAYC,CAAC,IAAIA,CAAC,CAACb,EAAF,KAASc,GAA1B,CAAP;AACH,KAhBW,CAiBZ;;;AACA,QAAIH,IAAI,IAAIA,IAAI,CAACK,MAAL,KAAgB,CAA5B,EAA+B;AAC3Bb,MAAAA,SAAS,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAT;AACA;AACH,KArBW,CAsBZ;;;AACA,QAAI,CAAEA,IAAI,IAAIA,IAAI,CAACK,MAAL,KAAgB,CAAzB,IAAgC,CAACL,IAAlC,KAA2C,CAACP,OAAO,CAACa,OAAxD,EAAiE;AAE7D,YAAMC,KAAK,GAAG;AAAEnB,QAAAA,KAAK,EAAEW;AAAT,OAAd;;AACA,UAAIV,EAAJ,EAAQ;AACJkB,QAAAA,KAAK,CAAClB,EAAN,GAAW,CAACA,EAAZ;AACH;;AAED,UAAIF,IAAJ,EAAU;AACNoB,QAAAA,KAAK,CAACC,QAAN,GAAiBrB,IAAjB;AACH,OAFD,MAEO,IAAIL,MAAJ,EAAY;AACfyB,QAAAA,KAAK,CAACzB,MAAN,GAAeA,MAAf;AACH;;AAEDH,MAAAA,iBAAiB,CAAC,GAAD,EAAM,CAAN,EAAS4B,KAAT,CAAjB,CAb6D,CAc7D;;AACAd,MAAAA,OAAO,CAACa,OAAR,GAAkB,IAAlB;AACA;AACH,KAxCW,CAyCZ;;;AAEA,QAAGN,IAAI,CAACK,MAAL,GAAc,CAAjB,EAAmB;AACftB,MAAAA,cAAc,CAACiB,IAAD,CAAd;AACAV,MAAAA,OAAO,CAACQ,OAAR,CAAgB,yBAAhB;AACH;;AAED,QAAGd,QAAQ,KAAK,CAAhB,EAAkB;AACdM,MAAAA,OAAO,CAACQ,OAAR,CAAgB,MAAhB;AACH;AAEJ,GApDQ,EAoDN,CACCT,EADD,EAECD,KAFD,EAGCD,IAHD,EAICL,MAJD,EAKCF,WALD,EAMCY,SAND,EAOCT,cAPD,EAQCW,eARD,EASCD,OATD,EAUCH,OAVD,EAWCN,QAXD,EAYCL,iBAZD,CApDM,CAAT;AAmEApB,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAG,CAACgC,MAAJ,EAAY;AACZV,IAAAA,iBAAiB,CAACU,MAAM,CAACF,EAAR,CAAjB;AACH,GAHQ,EAGN,CAACE,MAAD,EAASV,iBAAT,CAHM,CAAT;AAKA,QAAM4B,WAAW,GAAGnD,WAAW,CAAEoD,IAAD,IAAQ;AACpC,QAAG,CAACzB,QAAD,IAAa,CAACC,MAAd,IAAwB,CAACK,MAAzB,IAAmCmB,IAAI,KAAKC,SAA/C,EAA0D;AAE1D1B,IAAAA,QAAQ,CAAC2B,IAAT,CAAc;AACVvB,MAAAA,EAAE,EAAEE,MAAM,CAACF,EADD;AAEVwB,MAAAA,QAAQ,EAAEH,IAAI,IAAInB,MAAM,CAACuB,QAAP,GAAkB,IAAtB,CAFJ;AAGVA,MAAAA,QAAQ,EAAEvB,MAAM,CAACuB;AAHP,KAAd;AAKH,GAR8B,EAQ7B,CAAC7B,QAAD,EAAWC,MAAX,EAAmBK,MAAnB,CAR6B,CAA/B;AAUA,SACI;AAAK,IAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,MAAD;AAAQ,IAAA,MAAM,EAAEA,MAAhB;AAAwB,IAAA,QAAQ,EAAEN,QAAlC;AAA4C,IAAA,MAAM,EAAEC,MAApD;AAA4D,IAAA,MAAM,MAAlE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAEI,oBAAC,GAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,GAAD;AAAK,IAAA,EAAE,EAAE;AAAC6B,MAAAA,IAAI,EAAE,EAAP;AAAWC,MAAAA,KAAK,EAAE;AAAlB,KAAT;AAA+B,IAAA,EAAE,EAAE;AAACD,MAAAA,IAAI,EAAE,CAAP;AAAUC,MAAAA,KAAK,EAAC;AAAhB,KAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CADJ,EAII,oBAAC,GAAD;AAAK,IAAA,EAAE,EAAE,EAAT;AAAc,IAAA,EAAE,EAAE;AAACD,MAAAA,IAAI,EAAE,CAAP;AAAUC,MAAAA,KAAK,EAAC;AAAhB,KAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACI,oBAAC,aAAD;AAAe,IAAA,MAAM,EAAEzB,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,EAEI,oBAAC,eAAD;AAAiB,IAAA,MAAM,EAAEkB,WAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,CAJJ,CAFJ,EAWI,oBAAC,cAAD;AAAgB,IAAA,QAAQ,EAAExB,QAA1B;AAAoC,IAAA,MAAM,EAAEC,MAA5C;AAAoD,IAAA,IAAI,EAAEK,MAA1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXJ,CADJ;AAeH,CAtHD;;AAwHA,MAAM0B,eAAe,GAAGC,KAAK,KAAK;AAC9BtC,EAAAA,WAAW,EAAEsC,KAAK,CAACC,OAAN,CAAcC,IADG;AAE9BpC,EAAAA,QAAQ,EAAEkC,KAAK,CAACC,OAAN,CAAcnC,QAFM;AAG9BF,EAAAA,MAAM,EAAEoC,KAAK,CAAC/B,IAAN,CAAWkC;AAHW,CAAL,CAA7B;;AAMA,MAAMC,kBAAkB,GAAGC,QAAQ,KAAK;AACpC5C,EAAAA,iBAAiB,EAAE,CAAC6C,QAAD,EAAWC,IAAX,EAAiBlB,KAAjB,KAA2BgB,QAAQ,CAACpD,OAAO,CAACqD,QAAD,EAAWC,IAAX,EAAiBlB,KAAjB,CAAR,CADlB;AAEpC1B,EAAAA,iBAAiB,EAAGQ,EAAD,IAAQkC,QAAQ,CAACrD,UAAU,CAACmB,EAAD,CAAX,CAFC;AAGpCN,EAAAA,cAAc,EAAGqC,IAAD,IAAUG,QAAQ,CAACtD,WAAW,CAACmD,IAAD,CAAZ,CAHE;AAIpC1C,EAAAA,SAAS,EAAGgD,IAAD,IAAUH,QAAQ,CAACnD,aAAa,CAACsD,IAAD,CAAd;AAJO,CAAL,CAAnC;;AAOA,eAAe9D,OAAO,CAACqD,eAAD,EAAkBK,kBAAlB,CAAP,CAA6C7C,UAA7C,CAAf","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { Col, Row } from \"react-bootstrap\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport PlayerControls from \"../common/components/PlayerControls/PlayerControls\";\r\nimport Record from \"../common/components/Record/Record\";\r\nimport { loadRecords, reqRecData, reqRecs, setFooterType } from \"./../../actions\";\r\nimport RecordComments from \"./../common/components/RecordComments/RecordComments\";\r\nimport RecordDetails from \"./../common/components/RecordDetails/RecordDetails\";\r\nimport RecordTracklist from \"./../common/components/RecordTracklist/RecordTracklist\";\r\nimport { usePlayer } from \"./../common/Hooks/usePlayer\";\r\nimport \"./user-record.scss\";\r\n\r\nconst UserRecord = ({ \r\n        setFooter,\r\n        requestRecordList, \r\n        recordsList,\r\n        requestRecordData, \r\n        userId, \r\n        setRecordsList, \r\n        countAll }) => {\r\n    const [controls, player] = usePlayer();\r\n    const { user, title, id } = useParams();\r\n    const history = useHistory()\r\n    const [record, setRecord] = useState();\r\n\r\n    const reqFlag = useRef();\r\n\r\n    const escapeUnderdash = useCallback(str => str.split(\"_\").join(\" \"), []);\r\n\r\n    useEffect(()=>{\r\n        setFooter(\"player\")\r\n    },[setFooter])\r\n\r\n    useEffect(() => {\r\n        if (!title && !user) { \r\n            history.replace('/records') \r\n            return;\r\n        }\r\n        if (!title && user) {\r\n            history.replace('/records/' + user)\r\n            return;\r\n        }\r\n\r\n        const _title = escapeUnderdash(title);\r\n\r\n        let recs = recordsList?.filter(r => r.title === _title)\r\n        if (id) {\r\n            let _id = parseInt(id)\r\n            recs = recs.filter(r => r.id === _id);\r\n        }\r\n        //if is exact this record \r\n        if (recs && recs.length === 1) {\r\n            setRecord(recs[0]);\r\n            return;\r\n        }\r\n        //if there is none record request it\r\n        if (((recs && recs.length === 0 ) || !recs) && !reqFlag.current) {\r\n\r\n            const where = { title: _title}\r\n            if (id) {\r\n                where.id = +id;\r\n            }\r\n\r\n            if (user) {\r\n                where.nickname = user;\r\n            } else if (userId) {\r\n                where.userId = userId;\r\n            }\r\n        \r\n            requestRecordList(100, 0, where);\r\n            //to prevent reqesting again if result is empty\r\n            reqFlag.current = true;\r\n            return;\r\n        }\r\n        // if is more than one record with this title \r\n\r\n        if(recs.length > 1){\r\n            setRecordsList(recs);\r\n            history.replace('/records?preloaded=true')\r\n        }\r\n\r\n        if(countAll === 0){\r\n            history.replace('/404')\r\n        }\r\n\r\n    }, [\r\n        id, \r\n        title, \r\n        user,\r\n        userId,\r\n        recordsList, \r\n        setRecord, \r\n        setRecordsList, \r\n        escapeUnderdash, \r\n        reqFlag,\r\n        history,\r\n        countAll,\r\n        requestRecordList, \r\n    ])\r\n\r\n    useEffect(() => {\r\n        if(!record) return;\r\n        requestRecordData(record.id);\r\n    }, [record, requestRecordData])\r\n\r\n    const seekToTrack = useCallback((time)=>{\r\n        if(!controls || !player || !record || time === undefined) return;\r\n        \r\n        controls.seek({\r\n            id: record.id,\r\n            progress: time / (record.duration / 1000),\r\n            duration: record.duration,\r\n        })\r\n    },[controls, player, record])\r\n\r\n    return (\r\n        <div className=\"user-record\">\r\n            <Record record={record} controls={controls} player={player} simple />\r\n            <Row>\r\n                <Col xs={{span: 12, order: 2}} md={{span: 6, order:1}}>\r\n                    <RecordComments/>\r\n                </Col>\r\n                <Col xs={12}  md={{span: 6, order:2}}>\r\n                    <RecordDetails record={record} />\r\n                    <RecordTracklist onSeek={seekToTrack}/>\r\n                </Col> \r\n            </Row>\r\n            <PlayerControls controls={controls} player={player} list={record} />\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    recordsList: state.records.list,\r\n    countAll: state.records.countAll,\r\n    userId: state.user.dbId,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    requestRecordList: (pageSize, page, where) => dispatch(reqRecs(pageSize, page, where)),\r\n    requestRecordData: (id) => dispatch(reqRecData(id)),\r\n    setRecordsList: (list) => dispatch(loadRecords(list)),\r\n    setFooter: (type) => dispatch(setFooterType(type))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecord)\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}