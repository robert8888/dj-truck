{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\src\\\\pages\\\\common\\\\components\\\\PlayerControls\\\\ProgressSlider\\\\ProgressSlider.js\";\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { formater } from \"./../../../../../utils/time/timeFromater\";\nimport { toRange } from \"./../../../../../utils/math/argRanges\";\nimport useWindowSize from \"./../../../Hooks/useWindowSize\";\nimport \"./progress-slider.scss\"; //horizontal\n\nconst ProgressSlider = ({\n  player,\n  seek\n}) => {\n  const [progress, setProgress] = useState(0);\n  const [buffered, setBuffred] = useState(0);\n  const [currentRecord, setCurrentRecord] = useState(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [currentDuration, setCurrentDuration] = useState(0);\n  const isDragged = useRef();\n  const seekTarget = useRef();\n  const progressRef = useRef();\n  const durationRef = useRef();\n  const sliderArea = useRef(null);\n  const sliderThumb = useRef(null);\n  const sliderProgress = useRef(null);\n  const sliderBufferd = useRef(null);\n  const sliderTimePreview = useRef(null);\n  const sliderAreaRectCached = useRef();\n  const thumbAreaRectCached = useRef();\n  const [windowWidth] = useWindowSize();\n  const getSliderAreaRect = useCallback(() => {\n    if (!sliderAreaRectCached.current) {\n      sliderAreaRectCached.current = sliderArea.current.getBoundingClientRect();\n    }\n\n    return sliderAreaRectCached.current;\n  }, [sliderArea, sliderAreaRectCached]);\n  const getThumbAreaRect = useCallback(() => {\n    if (!thumbAreaRectCached.current) {\n      thumbAreaRectCached.current = sliderThumb.current.getBoundingClientRect();\n    }\n\n    return thumbAreaRectCached.current;\n  }, [sliderThumb, thumbAreaRectCached]);\n  const refrehsRects = useCallback(() => {\n    sliderAreaRectCached.current = null;\n    thumbAreaRectCached.current = null;\n  }, [sliderAreaRectCached, thumbAreaRectCached]);\n  const setThumbPosition = useCallback(progress => {\n    let position = 0;\n    const sliderAreaRect = getSliderAreaRect();\n    const thumbRect = getThumbAreaRect();\n    position = sliderAreaRect.width * progress;\n    sliderProgress.current.style.transform = `scaleX(${position}) translateX(50%)`;\n    position -= thumbRect.width / 2;\n    sliderThumb.current.style.transform = `translateX(${position}px)`;\n  }, [sliderArea, sliderThumb]);\n  const setBuffredPosition = useCallback(buffered => {\n    const sliderAreaRect = getSliderAreaRect();\n\n    if (!sliderAreaRect) {\n      return;\n    }\n\n    const position = sliderAreaRect.width * buffered;\n    sliderBufferd.current.style.transform = `scaleX(${position}) translateX(50%)`;\n  }, [sliderBufferd, sliderArea]);\n  useEffect(() => {\n    setBuffredPosition(buffered);\n  }, [buffered, setBuffredPosition]);\n  useEffect(() => {\n    setCurrentTime(currentDuration * progress);\n    setThumbPosition(progress);\n  }, [progress, currentDuration, setCurrentTime, setThumbPosition]);\n  const refreshBuffered = useCallback(() => setBuffredPosition(buffered), [buffered, setBuffredPosition]);\n  const refreshProgress = useCallback(() => setThumbPosition(progress), [progress, setThumbPosition]);\n  useEffect(() => {\n    refreshBuffered();\n    refreshProgress();\n  }, [windowWidth, refreshBuffered, refreshProgress]);\n  const setProgressHandler = useCallback(progress => {\n    if (!isDragged.current) {\n      setProgress(progress);\n      progressRef.current = progress;\n    }\n  }, [isDragged, progressRef]);\n  const getProgress = useCallback(() => {\n    return {\n      progress: progressRef.current,\n      duration: durationRef.current\n    };\n  }, [progressRef, durationRef]);\n  useEffect(() => {\n    if (currentRecord) {\n      setCurrentDuration(currentRecord.duration);\n      durationRef.current = currentRecord.duration;\n    }\n  }, [currentRecord, setCurrentDuration, durationRef]);\n  useEffect(() => {\n    if (!player) {\n      return;\n    } // console.log('progres slider')\n\n\n    player.subscribeProgress('#', setProgressHandler);\n    player.subscribeCurrent(setCurrentRecord);\n    player.subscribeBuffred(setBuffred);\n    player.addProgressProvider(\"#\", getProgress);\n    return () => {\n      console.log(\"unmouting slider\");\n      player.unSubscribeProgress('#', setProgressHandler);\n      player.unSubscribeCurrent(setCurrentRecord);\n      player.unSubscribeBuffered(setBuffred);\n      player.removeProgressProvider(\"#\", getProgress);\n    };\n  }, [player, setProgressHandler, getProgress]);\n  const thumbDraging = useCallback((areaRect, e) => {\n    const x = e.clientX - areaRect.left;\n    let progress = x / areaRect.width;\n    progress = toRange(progress, 0, 1);\n    seekTarget.current = progress;\n    setProgress(progress);\n  }, []);\n  const thumbMouseDown = useCallback(e => {\n    if (currentDuration === 0) {\n      return;\n    }\n\n    const sliderAreaRect = getSliderAreaRect();\n    const thumbDragingWithArgs = thumbDraging.bind(null, sliderAreaRect);\n    isDragged.current = true;\n\n    const mouseup = () => {\n      window.removeEventListener('mouseup', mouseup);\n      window.removeEventListener('mousemove', thumbDragingWithArgs);\n      isDragged.current = false;\n      seek({\n        progress: seekTarget.current\n      });\n      seekTarget.current = null;\n    };\n\n    window.addEventListener('mousemove', thumbDragingWithArgs);\n    window.addEventListener('mouseup', mouseup);\n  }, [thumbDraging, sliderArea, isDragged, seek, seekTarget, currentDuration]);\n  const areaMouseDown = useCallback(e => {\n    const sliderAreaRect = getSliderAreaRect();\n    const thumbRect = getThumbAreaRect();\n\n    if (e.target === sliderThumb.current) {\n      return;\n    }\n\n    const x = e.clientX - sliderAreaRect.left + thumbRect.width / 2;\n    let progress = x / sliderAreaRect.width;\n    progress = toRange(progress, 0, 1);\n    seek({\n      progress\n    });\n  }, [seek, sliderArea]);\n  const areaMouseMove = useCallback(e => {\n    const sliderAreaRect = getSliderAreaRect();\n    const thumbRect = getThumbAreaRect();\n    const x = e.clientX - sliderAreaRect.left + thumbRect.width / 2;\n    let progress = x / sliderAreaRect.width;\n    progress = toRange(progress, 0, 1);\n    const time = currentDuration * progress;\n    const str = formater.secondsToStr(time / 1000);\n    sliderTimePreview.current.dataset.value = time ? str : \"\";\n    sliderTimePreview.current.style.transform = `translateX(${x}px)`;\n  }, [currentDuration, sliderTimePreview]);\n  const areaMouseEnter = useCallback(e => {\n    sliderTimePreview.current.classList.add(\"preview--visible\");\n  }, [sliderTimePreview]);\n  const areaMouseLeave = useCallback(e => {\n    sliderTimePreview.current.classList.remove(\"preview--visible\");\n  }, [sliderTimePreview]);\n  return React.createElement(\"div\", {\n    className: \"seek-slider\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"slider-time time-current\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, formater.secondsToStr(currentTime / 1000))), React.createElement(\"div\", {\n    className: \"slider-active-area\",\n    ref: sliderArea,\n    onMouseDown: areaMouseDown,\n    onMouseEnter: areaMouseEnter,\n    onMouseLeave: areaMouseLeave,\n    onMouseMove: areaMouseMove,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"slider-buffered\",\n    ref: sliderBufferd,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-progress\",\n    ref: sliderProgress,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-thumb\",\n    ref: sliderThumb,\n    onMouseDown: thumbMouseDown,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-time-preview\",\n    ref: sliderTimePreview,\n    \"data-value\": \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"slider-time time-duration\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225\n    },\n    __self: this\n  }, formater.secondsToStr(currentDuration / 1000))));\n};\n\nexport default ProgressSlider;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/PlayerControls/ProgressSlider/ProgressSlider.js"],"names":["React","useState","useRef","useEffect","useCallback","formater","toRange","useWindowSize","ProgressSlider","player","seek","progress","setProgress","buffered","setBuffred","currentRecord","setCurrentRecord","currentTime","setCurrentTime","currentDuration","setCurrentDuration","isDragged","seekTarget","progressRef","durationRef","sliderArea","sliderThumb","sliderProgress","sliderBufferd","sliderTimePreview","sliderAreaRectCached","thumbAreaRectCached","windowWidth","getSliderAreaRect","current","getBoundingClientRect","getThumbAreaRect","refrehsRects","setThumbPosition","position","sliderAreaRect","thumbRect","width","style","transform","setBuffredPosition","refreshBuffered","refreshProgress","setProgressHandler","getProgress","duration","subscribeProgress","subscribeCurrent","subscribeBuffred","addProgressProvider","console","log","unSubscribeProgress","unSubscribeCurrent","unSubscribeBuffered","removeProgressProvider","thumbDraging","areaRect","e","x","clientX","left","thumbMouseDown","thumbDragingWithArgs","bind","mouseup","window","removeEventListener","addEventListener","areaMouseDown","target","areaMouseMove","time","str","secondsToStr","dataset","value","areaMouseEnter","classList","add","areaMouseLeave","remove"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport {formater} from \"./../../../../../utils/time/timeFromater\";\r\nimport {toRange} from \"./../../../../../utils/math/argRanges\";\r\nimport useWindowSize from \"./../../../Hooks/useWindowSize\"\r\nimport \"./progress-slider.scss\"\r\n\r\n//horizontal\r\nconst ProgressSlider = ({ player, seek}) => {\r\n    const [progress, setProgress] = useState(0);\r\n    const [buffered, setBuffred] = useState(0);\r\n    const [currentRecord, setCurrentRecord] = useState(null);\r\n    const [currentTime, setCurrentTime] = useState(0);\r\n    const [currentDuration, setCurrentDuration] = useState(0);\r\n    const isDragged = useRef();\r\n    const seekTarget = useRef();\r\n    const progressRef = useRef();\r\n    const durationRef = useRef();\r\n\r\n    const sliderArea = useRef(null);\r\n    const sliderThumb = useRef(null);\r\n    const sliderProgress = useRef(null);\r\n    const sliderBufferd = useRef(null);\r\n    const sliderTimePreview = useRef(null);\r\n\r\n    const sliderAreaRectCached = useRef();\r\n    const thumbAreaRectCached = useRef();\r\n\r\n    const [ windowWidth, ] = useWindowSize();\r\n\r\n    const getSliderAreaRect = useCallback(()=>{\r\n        if(!sliderAreaRectCached.current){\r\n            sliderAreaRectCached.current = sliderArea.current.getBoundingClientRect();\r\n        }\r\n        return sliderAreaRectCached.current;\r\n    }, [sliderArea, sliderAreaRectCached])\r\n\r\n    const getThumbAreaRect = useCallback(()=>{\r\n        if(!thumbAreaRectCached.current){\r\n            thumbAreaRectCached.current = sliderThumb.current.getBoundingClientRect();\r\n        }\r\n        return thumbAreaRectCached.current;\r\n    }, [sliderThumb, thumbAreaRectCached])\r\n\r\n    const refrehsRects = useCallback(()=>{\r\n        sliderAreaRectCached.current = null;\r\n        thumbAreaRectCached.current = null;\r\n    },[ sliderAreaRectCached, thumbAreaRectCached])\r\n\r\n    const setThumbPosition = useCallback((progress)=>{\r\n        let position = 0;\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        position = sliderAreaRect.width * progress ;\r\n        sliderProgress.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n        position -= (thumbRect.width / 2) ;  \r\n        sliderThumb.current.style.transform = `translateX(${position}px)`;\r\n    }, [sliderArea, sliderThumb])\r\n\r\n    const setBuffredPosition = useCallback((buffered) => {\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        if(!sliderAreaRect){\r\n            return;\r\n        }\r\n        const position = sliderAreaRect.width * buffered;\r\n        sliderBufferd.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n    }, [sliderBufferd, sliderArea])\r\n\r\n    useEffect(()=>{\r\n        setBuffredPosition(buffered)\r\n    }, [buffered, setBuffredPosition])\r\n\r\n    useEffect(()=>{\r\n        setCurrentTime(currentDuration * progress);\r\n        setThumbPosition(progress);\r\n     }, [progress, currentDuration, setCurrentTime, setThumbPosition])\r\n\r\n    const refreshBuffered = useCallback(\r\n            () => setBuffredPosition(buffered), \r\n            [buffered, setBuffredPosition]\r\n        );\r\n    const refreshProgress = useCallback(\r\n            () => setThumbPosition(progress), \r\n            [progress, setThumbPosition]\r\n        )\r\n\r\n    useEffect(()=>{\r\n        refreshBuffered();\r\n        refreshProgress();\r\n    },[windowWidth, refreshBuffered, refreshProgress])\r\n\r\n\r\n    const setProgressHandler = useCallback((progress)=>{\r\n        if(!isDragged.current){\r\n            setProgress(progress);\r\n            progressRef.current = progress\r\n        }\r\n    }, [isDragged, progressRef])\r\n\r\n    const getProgress = useCallback(()=>{\r\n        return {\r\n            progress: progressRef.current,\r\n            duration: durationRef.current,\r\n        };\r\n    }, [progressRef, durationRef])\r\n\r\n    useEffect(()=>{\r\n        if(currentRecord){\r\n           setCurrentDuration(currentRecord.duration);\r\n           durationRef.current = currentRecord.duration;\r\n        }\r\n    }, [currentRecord, setCurrentDuration, durationRef])\r\n\r\n    useEffect(()=>{\r\n        if(!player){\r\n            return;\r\n        }\r\n       // console.log('progres slider')\r\n        player.subscribeProgress('#', setProgressHandler);\r\n        player.subscribeCurrent(setCurrentRecord);\r\n        player.subscribeBuffred(setBuffred);\r\n        player.addProgressProvider(\"#\", getProgress)\r\n\r\n        return () => {\r\n            console.log(\"unmouting slider\")\r\n            player.unSubscribeProgress('#', setProgressHandler);\r\n            player.unSubscribeCurrent(setCurrentRecord);\r\n            player.unSubscribeBuffered(setBuffred);\r\n            player.removeProgressProvider(\"#\", getProgress)\r\n        }\r\n\r\n    }, [player, setProgressHandler, getProgress])\r\n\r\n    const thumbDraging = useCallback( (areaRect, e) => {\r\n       const x = e.clientX - areaRect.left;\r\n       let progress = x / areaRect.width;\r\n       progress = toRange(progress, 0 ,1);\r\n       seekTarget.current = progress;\r\n       setProgress(progress)\r\n    }, [])\r\n\r\n    const thumbMouseDown = useCallback((e)=>{\r\n        if(currentDuration === 0){\r\n            return;\r\n        }\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbDragingWithArgs = thumbDraging.bind(null, sliderAreaRect)\r\n        isDragged.current = true;\r\n        const mouseup = () => {\r\n            window.removeEventListener('mouseup', mouseup);\r\n            window.removeEventListener('mousemove', thumbDragingWithArgs);\r\n            isDragged.current = false;\r\n            seek({progress : seekTarget.current});\r\n            seekTarget.current = null;\r\n        }\r\n        window.addEventListener('mousemove', thumbDragingWithArgs)\r\n        window.addEventListener('mouseup', mouseup)\r\n    }, [thumbDraging, \r\n        sliderArea, \r\n        isDragged,\r\n        seek, \r\n        seekTarget, \r\n        currentDuration])\r\n\r\n    const areaMouseDown = useCallback((e)=>{\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        if(e.target === sliderThumb.current){\r\n            return;\r\n        }\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width  ;\r\n        progress = toRange(progress, 0 , 1)\r\n        seek({progress})\r\n    }, [seek, sliderArea])\r\n\r\n    const areaMouseMove = useCallback( e =>{\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width;\r\n        progress = toRange(progress, 0 , 1)\r\n        const time = currentDuration * progress;\r\n        const str = formater.secondsToStr(time / 1000);\r\n        sliderTimePreview.current.dataset.value = time ? str : \"\";\r\n        sliderTimePreview.current.style.transform = `translateX(${x}px)`\r\n    }, [currentDuration , sliderTimePreview])\r\n\r\n    const areaMouseEnter = useCallback( e => {\r\n        sliderTimePreview.current.classList.add(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n    const areaMouseLeave = useCallback( e => {\r\n        sliderTimePreview.current.classList.remove(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n\r\n    return (\r\n        <div className=\"seek-slider\">\r\n            <div className=\"slider-time time-current\">\r\n                 <span>{formater.secondsToStr(currentTime / 1000)}</span>\r\n            </div>\r\n            <div className=\"slider-active-area\" \r\n                 ref={sliderArea}\r\n                 onMouseDown={areaMouseDown}\r\n                 onMouseEnter={areaMouseEnter}\r\n                 onMouseLeave={areaMouseLeave} \r\n                 onMouseMove={areaMouseMove}\r\n                 draggable=\"false\">\r\n                    <div className=\"slider-buffered\" \r\n                         ref={sliderBufferd} \r\n                         draggable=\"false\"/>\r\n                    <div className=\"slider-progress\" \r\n                         ref={sliderProgress} \r\n                         draggable=\"false\"/>\r\n                    \r\n                    <div className=\"slider-thumb\" \r\n                         ref={sliderThumb} \r\n                         onMouseDown={thumbMouseDown} \r\n                         draggable=\"false\"/>\r\n                    <div className=\"slider-time-preview\"  \r\n                         ref={sliderTimePreview} \r\n                         data-value=\"\"/>\r\n            </div>\r\n            <div className=\"slider-time time-duration\">\r\n                <span>{formater.secondsToStr(currentDuration/1000)}</span>\r\n            </div>\r\n        </div>\r\n    \r\n    )\r\n}\r\n\r\nexport default ProgressSlider;\r\n\r\n"]},"metadata":{},"sourceType":"module"}