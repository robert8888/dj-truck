{"ast":null,"code":"import _wrapRegExp from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/wrapRegExp\";import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect}from\"react\";import{connect}from\"react-redux\";import{Link,useLocation}from\"react-router-dom\";import UUIDClass from\"uuidjs\";import{reqUserProfile}from\"./../../../../actions\";import{useFormatRelative}from\"./../../Hooks/useFormatDate\";import Edit from\"./Edit/Edit\";import\"./user-profile.scss\";import ErrorBoundary from\"../ErrorBoundary/ErrorBoundary\";var UserProfile=function UserProfile(_ref){var nickname=_ref.nickname,profile=_ref.profile,reqProfile=_ref.reqProfile,withGenres=_ref.withGenres,editable=_ref.editable,_ref$onChange=_ref.onChange,onChange=_ref$onChange===void 0?function(ifEmpty){return null;}:_ref$onChange;var location=useLocation();var _useFormatRelative=useFormatRelative(),_useFormatRelative2=_slicedToArray(_useFormatRelative,1),formatRelative=_useFormatRelative2[0];useEffect(function(){if(nickname&&!profile||profile.user.nickname!==nickname){reqProfile(nickname);}},[nickname,profile,reqProfile]);var parsePirctureUrl=useCallback(function(url){if(url.startsWith(\"https://platform-lookaside.fbsbx.com\")){var asid=url.match(_wrapRegExp(/asid=([0-9]+)/,{asid:1})).groups.asid;url=\"https://graph.facebook.com/v2.5/\".concat(asid,\"/picture?type=large\");}return url;},[]);var linkToGenre=useCallback(function(genre){var pathname=location.pathname,search=location.search;search=search.replace(/\\??&?genres=[^&]+/g,\"\");return pathname+search+(search?\"&\":\"?\")+\"genres=\"+genre;},[location]);if(!profile||!nickname){return null;}return React.createElement(ErrorBoundary,null,React.createElement(\"div\",{className:\"user-profile\"},React.createElement(\"main\",null,React.createElement(\"div\",{className:\"user-picture\"},React.createElement(Edit,{active:editable,type:\"image\",onChange:onChange.bind(null,'picture')},React.createElement(\"img\",{src:parsePirctureUrl(profile.user.picture),alt:\"user avatar\"}))),React.createElement(\"section\",null,React.createElement(\"div\",{className:\"user-nickname\"},React.createElement(Edit,{active:editable,type:\"text\",onChange:onChange.bind(null,'nickname')},React.createElement(\"h4\",null,profile.user.nickname))),React.createElement(\"div\",{className:\"user-joined\"},React.createElement(\"h5\",null,formatRelative(profile.user.createdAt,{timezone:true}))),React.createElement(\"div\",{className:\"user-record-stat\"},React.createElement(\"span\",null,\"\".concat(profile.records,\" records\")),React.createElement(\"span\",null,\"\".concat(~~(profile.recordsTime/(60*1000)),\" min\"))))),React.createElement(\"aside\",null,React.createElement(\"div\",{className:\"user-description\"},React.createElement(Edit,{active:editable,type:\"textarea\",onChange:onChange.bind(null,'description')},React.createElement(\"p\",null,profile.description))),withGenres&&React.createElement(\"div\",{className:\"genres\"},React.createElement(\"ul\",null,profile.genres&&profile.genres.length&&profile.genres.map(function(genreWrapper){return React.createElement(\"li\",{key:UUIDClass.genV1()},React.createElement(Link,{to:linkToGenre(genreWrapper.genre.name)},\"\".concat(genreWrapper.genre.name,\" - \").concat(genreWrapper.occurrence)));}))))));};var mapStateToProps=function mapStateToProps(state){return{profile:state.profile.current};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{reqProfile:function reqProfile(nickname){return dispatch(reqUserProfile(nickname));}};};export default connect(mapStateToProps,mapDispatchToProps)(UserProfile);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/UserProfile/UserProfile.js"],"names":["React","useCallback","useEffect","connect","Link","useLocation","UUIDClass","reqUserProfile","useFormatRelative","Edit","ErrorBoundary","UserProfile","nickname","profile","reqProfile","withGenres","editable","onChange","ifEmpty","location","formatRelative","user","parsePirctureUrl","url","startsWith","asid","match","groups","linkToGenre","genre","pathname","search","replace","bind","picture","createdAt","timezone","records","recordsTime","description","genres","length","map","genreWrapper","genV1","name","occurrence","mapStateToProps","state","current","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { Link, useLocation } from \"react-router-dom\";\r\nimport UUIDClass from \"uuidjs\";\r\nimport { reqUserProfile } from \"./../../../../actions\";\r\nimport { useFormatRelative } from \"./../../Hooks/useFormatDate\";\r\nimport Edit from \"./Edit/Edit\";\r\nimport \"./user-profile.scss\";\r\nimport ErrorBoundary from \"../ErrorBoundary/ErrorBoundary\";\r\n\r\nconst UserProfile = ({ nickname, profile, reqProfile, withGenres, editable , onChange = ifEmpty => null }) => {\r\n    const location = useLocation();\r\n    const [formatRelative] = useFormatRelative();\r\n\r\n    useEffect(() => {\r\n        if ((nickname && !profile) || profile.user.nickname !== nickname) {\r\n            reqProfile(nickname);\r\n        }\r\n    }, [nickname, profile, reqProfile])\r\n\r\n    const parsePirctureUrl = useCallback((url) => {\r\n        if (url.startsWith(\"https://platform-lookaside.fbsbx.com\")) {\r\n            const asid = url.match(/asid=(?<asid>\\d+)/).groups.asid;\r\n            url = `https://graph.facebook.com/v2.5/${asid}/picture?type=large`\r\n        }\r\n        return url\r\n    }, [])\r\n\r\n    const linkToGenre = useCallback((genre)=>{\r\n        let {pathname, search} = location;\r\n        search = search.replace(/\\??&?genres=[^&]+/g, \"\")\r\n        return pathname + search + ((search) ? \"&\" : \"?\") + \"genres=\" + genre;\r\n    },[location])\r\n\r\n    if (!profile || !nickname) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <ErrorBoundary>\r\n            <div className=\"user-profile\">\r\n                <main>\r\n                <div className=\"user-picture\">\r\n                    <Edit active={editable} type=\"image\" onChange={onChange.bind(null, 'picture')}>\r\n                        <img src={parsePirctureUrl(profile.user.picture)} alt=\"user avatar\" />\r\n                    </Edit>\r\n                </div>\r\n                <section>\r\n                    <div className=\"user-nickname\" >\r\n                        <Edit active={editable} type=\"text\" onChange={onChange.bind(null, 'nickname')} >\r\n                            <h4>{profile.user.nickname}</h4>\r\n                        </Edit>\r\n                    </div>\r\n                    <div className=\"user-joined\">\r\n                            <h5>{formatRelative(profile.user.createdAt, {timezone :true})}</h5>\r\n                    </div>\r\n                    <div className=\"user-record-stat\">\r\n                        <span>{`${profile.records} records`}</span>\r\n                        <span>{`${~~(profile.recordsTime / (60 * 1000)) } min`}</span>\r\n                    </div>\r\n                </section>\r\n                </main>\r\n                <aside>\r\n                <div className=\"user-description\">\r\n                    <Edit active={editable} type=\"textarea\" onChange={onChange.bind(null, 'description')}>\r\n                        <p>{profile.description}</p>\r\n                    </Edit>\r\n                </div>\r\n            {withGenres && \r\n            <div className=\"genres\">\r\n                        <ul>\r\n                            {profile.genres && profile.genres.length &&\r\n                                profile.genres.map( genreWrapper => (\r\n                                    <li key={UUIDClass.genV1()}>\r\n                                        <Link to={linkToGenre(genreWrapper.genre.name)}>\r\n                                            {`${genreWrapper.genre.name} - ${genreWrapper.occurrence}`}\r\n                                        </Link>\r\n                                    </li>\r\n                                ))\r\n                            }\r\n                        </ul>\r\n                </div>\t}\r\n                </aside>\r\n            </div>\r\n        </ErrorBoundary>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    profile: state.profile.current\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    reqProfile: (nickname) => dispatch(reqUserProfile(nickname))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserProfile);\r\n\r\n"]},"metadata":{},"sourceType":"module"}