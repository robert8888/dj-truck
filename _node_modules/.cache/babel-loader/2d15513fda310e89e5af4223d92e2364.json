{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\src\\\\components\\\\Deck\\\\Player\\\\Player.js\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport WaveSurfer from \"wavesurfer\";\nimport Console from \"./../../../core/console/console\";\nimport { setChannelReady, setTimeLeft } from \"./../../../actions\";\nimport { getBitLength } from \"./../../../utils/bpm/converter\";\nimport config from \"./configuration\";\nimport \"./player.scss\";\n\nclass Player extends React.Component {\n  constructor() {\n    super();\n    this.masterContainer = React.createRef();\n    this.slaveContainer = React.createRef();\n    this.state = {\n      loadingProgress: 0,\n      wasCleared: false\n    };\n  }\n\n  setLoading(progress) {\n    this.setState(state => {\n      let _state = { ...state\n      };\n      _state.loadingProgress = progress;\n      return _state;\n    });\n  }\n\n  drawBeatBars(bpm, offset) {\n    //console.log(bpm, offset, this.props.isReady)\n    //clears previus \n    console.log(this.barsElements); //  (this.barsElements && this.barsElements.forEach( htmlElement => {console.log('removing'); htmlElement.remove()}));\n    //  console.log(bpm)\n\n    let wrapper = this.master.drawer.wrapper;\n    let styleApply = WaveSurfer.Drawer.style;\n    let minPxPerSec = config.master().minPxPerSec;\n    let bitLength = getBitLength(bpm);\n    let barPostions = []; //offset,bitLength, 2*bitLength, 3* bitLength, offset + bitLength, 3,4,5,6];\n\n    for (let i = offset; i < this.master.getDuration(); i += bitLength) {\n      barPostions.push(i);\n    } // console.log(bpm, offset, bitLength, barPostions);\n\n\n    let barStyle = position => ({\n      position: 'absolute',\n      left: position + \"px\",\n      top: '0px',\n      width: '1px',\n      maxWidth: '1px',\n      height: '100%',\n      background: 'rgba(255,255,255, 0.5)'\n    });\n\n    this.barsElements = [];\n    barPostions.forEach(position => {\n      let bar = document.createElement('div');\n      let style = barStyle(minPxPerSec * position);\n      styleApply(bar, style);\n      wrapper.appendChild(bar);\n      this.barsElements.push(bar);\n    });\n  }\n\n  clearState() {\n    this.slave.load(null, []);\n    this.setState({ ...this.state,\n      clearSlaveFlag: true\n    });\n\n    if (this.barsElements) {\n      this.barsElements.forEach(htmlElement => htmlElement.remove());\n    }\n  }\n\n  componentDidMount() {\n    this.master = WaveSurfer.create(config.master(this.masterContainer.current, this.props.name));\n    this.slave = WaveSurfer.create(config.slave(this.slaveContainer.current, this.props.name));\n    console.log('prototype', this.master.__proto__.load);\n\n    this.master.__proto__.load(function (...args) {\n      console.log('loading');\n      this.load(...args);\n    });\n\n    const mixConsole = Console.Get();\n    mixConsole.setPlayer(this.props.name, this.master);\n    this.master.on('ready', () => {\n      this.currentDuration = this.master.getDuration();\n      this.slave.load(null, this.master.backend.getPeaks(430, 0, 430));\n      this.setState({ ...this.state,\n        loadingProgress: 100,\n        wasCleared: false\n      });\n      this.props.setReadyHandler(true);\n      startSync();\n      console.log('loaded slave');\n    });\n    this.slave.on('seek', progress => {\n      let wasPlaying = this.master.isPlaying();\n      this.master.backend.seekTo(progress * this.currentDuration);\n      this.master.drawer.progress(progress);\n      this.master.fireEvent('seek', progress);\n\n      if (wasPlaying) {\n        this.master.play();\n      }\n\n      this.slave.drawer.progress(progress);\n\n      if (wasPlaying) {\n        this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - this.master.getCurrentTime()));\n      } else {\n        this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - this.master.getDuration() * progress));\n      }\n    });\n    this.master.on('loading', progress => {\n      this.setLoading(progress);\n\n      if (!this.state.wasCleared) {\n        this.clearState();\n      }\n    });\n\n    const startSync = () => {\n      this.syncHandle = setInterval(() => {\n        this.slave.drawer.progress(this.master.getCurrentTime() / this.currentDuration);\n      }, 100);\n    };\n  }\n\n  render() {\n    if (this.props.bpm && this.props.offset && this.props.isReady) {\n      this.drawBeatBars(this.props.bpm, this.props.offset);\n    }\n\n    return React.createElement(\"div\", {\n      className: \"player player-\" + this.props.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144\n      },\n      __self: this\n    }, this.state.loadingProgress < 100 && this.state.loadingProgress > 0 && React.createElement(\"div\", {\n      className: \"player-loading\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147\n      },\n      __self: this\n    }, \"Loading \", this.state.loadingProgress, \" % \")), React.createElement(\"div\", {\n      className: \"master\",\n      ref: this.masterContainer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"slave\",\n      ref: this.slaveContainer,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150\n      },\n      __self: this\n    }));\n  }\n\n}\n\nconst mapStateToProps = (state, ownProps) => ({\n  bpm: state.console.channel[ownProps.name].track.bpm,\n  offset: state.console.channel[ownProps.name].playBackState.offset,\n  isReady: state.console.channel[ownProps.name].playBackState.ready\n});\n\nconst mapDispachToProps = (dispatch, ownProps) => ({\n  setReadyHandler: status => dispatch(setChannelReady(status, ownProps.name)),\n  setTimeLeftHandler: timeLeft => dispatch(setTimeLeft(ownProps.name, timeLeft))\n});\n\nexport default connect(mapStateToProps, mapDispachToProps)(Player);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/components/Deck/Player/Player.js"],"names":["React","connect","WaveSurfer","Console","setChannelReady","setTimeLeft","getBitLength","config","Player","Component","constructor","masterContainer","createRef","slaveContainer","state","loadingProgress","wasCleared","setLoading","progress","setState","_state","drawBeatBars","bpm","offset","console","log","barsElements","wrapper","master","drawer","styleApply","Drawer","style","minPxPerSec","bitLength","barPostions","i","getDuration","push","barStyle","position","left","top","width","maxWidth","height","background","forEach","bar","document","createElement","appendChild","clearState","slave","load","clearSlaveFlag","htmlElement","remove","componentDidMount","create","current","props","name","__proto__","args","mixConsole","Get","setPlayer","on","currentDuration","backend","getPeaks","setReadyHandler","startSync","wasPlaying","isPlaying","seekTo","fireEvent","play","setTimeLeftHandler","parseInt","getCurrentTime","syncHandle","setInterval","render","isReady","mapStateToProps","ownProps","channel","track","playBackState","ready","mapDispachToProps","dispatch","status","timeLeft"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport WaveSurfer from \"wavesurfer\";\r\nimport Console from \"./../../../core/console/console\";\r\nimport {setChannelReady , setTimeLeft } from \"./../../../actions\";\r\nimport {getBitLength} from \"./../../../utils/bpm/converter\";\r\nimport config from \"./configuration\";\r\nimport \"./player.scss\"\r\n\r\n\r\n\r\nclass Player extends React.Component {\r\n    constructor(){\r\n        super();\r\n        this.masterContainer = React.createRef();\r\n        this.slaveContainer = React.createRef();\r\n\r\n        this.state = {\r\n            loadingProgress : 0,\r\n\r\n            wasCleared: false,\r\n        }\r\n    }\r\n\r\n    setLoading(progress){\r\n        this.setState( state => {\r\n            let _state = {...state};\r\n            _state.loadingProgress = progress;\r\n            return _state\r\n        })\r\n    }\r\n\r\n    drawBeatBars(bpm, offset){\r\n         //console.log(bpm, offset, this.props.isReady)\r\n        //clears previus \r\n        console.log(this.barsElements);\r\n      //  (this.barsElements && this.barsElements.forEach( htmlElement => {console.log('removing'); htmlElement.remove()}));\r\n      //  console.log(bpm)\r\n        let wrapper = this.master.drawer.wrapper;\r\n        let styleApply = WaveSurfer.Drawer.style;\r\n        let minPxPerSec = config.master().minPxPerSec;\r\n        let bitLength = getBitLength(bpm);\r\n\r\n        let barPostions = []//offset,bitLength, 2*bitLength, 3* bitLength, offset + bitLength, 3,4,5,6];\r\n\r\n        for(let i = offset; i< this.master.getDuration(); i += bitLength){\r\n            barPostions.push(i);\r\n        }\r\n       // console.log(bpm, offset, bitLength, barPostions);\r\n        let barStyle = (position) => ({ \r\n            position: 'absolute',\r\n            left: position + \"px\",\r\n            top: '0px',\r\n            width: '1px',\r\n            maxWidth: '1px',\r\n            height: '100%',\r\n            background: 'rgba(255,255,255, 0.5)'\r\n        })\r\n\r\n        this.barsElements = []\r\n        barPostions.forEach( position => {\r\n            let bar = document.createElement('div');\r\n            let style = barStyle(minPxPerSec * position);\r\n            styleApply(bar, style)\r\n            wrapper.appendChild(bar);\r\n            this.barsElements.push(bar);\r\n        })\r\n        \r\n    }\r\n\r\n    clearState(){\r\n        this.slave.load(null, []);\r\n        this.setState({...this.state, clearSlaveFlag : true})\r\n        if(this.barsElements){\r\n            this.barsElements.forEach( htmlElement => htmlElement.remove())\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.master = WaveSurfer.create(config.master(this.masterContainer.current, this.props.name));\r\n        this.slave = WaveSurfer.create(config.slave(this.slaveContainer.current, this.props.name));\r\n\r\n        console.log('prototype', this.master.__proto__.load)\r\n        this.master.__proto__.load(function (...args){\r\n            console.log('loading')\r\n            this.load(...args);\r\n        })\r\n\r\n\r\n        const mixConsole = Console.Get();\r\n        mixConsole.setPlayer(this.props.name, this.master);\r\n\r\n        this.master.on('ready', ()=>{\r\n            this.currentDuration = this.master.getDuration();\r\n            this.slave.load(null, this.master.backend.getPeaks(430, 0, 430));\r\n            this.setState({...this.state, loadingProgress: 100, wasCleared : false})\r\n            this.props.setReadyHandler(true);\r\n            startSync();\r\n            console.log('loaded slave')\r\n        })\r\n\r\n        this.slave.on('seek', (progress)=>{\r\n            let wasPlaying = this.master.isPlaying();\r\n            this.master.backend.seekTo(progress * this.currentDuration);\r\n            this.master.drawer.progress(progress);\r\n            this.master.fireEvent('seek', progress);\r\n\r\n            if(wasPlaying){\r\n                this.master.play();\r\n            }\r\n            this.slave.drawer.progress(progress);\r\n\r\n            if(wasPlaying){\r\n                this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - this.master.getCurrentTime()))\r\n            } else {\r\n                this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - (this.master.getDuration() * progress)))\r\n            }\r\n\r\n\r\n        })\r\n\r\n        this.master.on('loading', (progress)=>{\r\n            this.setLoading(progress);\r\n            if(!this.state.wasCleared){\r\n                this.clearState();\r\n            }\r\n        })\r\n\r\n        const startSync = () => {\r\n            this.syncHandle = setInterval(() => {\r\n                this.slave.drawer.progress(this.master.getCurrentTime() / this.currentDuration);\r\n            }, 100)\r\n        }\r\n    }\r\n\r\n\r\n\r\n    render(){\r\n        if(this.props.bpm && this.props.offset && this.props.isReady){\r\n            this.drawBeatBars(this.props.bpm, this.props.offset)\r\n        }\r\n\r\n        return (\r\n            <div className={\"player player-\"+this.props.name}>\r\n                {\r\n                (this.state.loadingProgress < 100 && this.state.loadingProgress > 0) &&\r\n                    <div className=\"player-loading\"><span>Loading { this.state.loadingProgress } % </span></div>\r\n                }\r\n                <div className=\"master\" ref={ this.masterContainer } />\r\n                <div className=\"slave\" ref={ this.slaveContainer } /> \r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => ({\r\n    bpm : state.console.channel[ownProps.name].track.bpm,\r\n    offset : state.console.channel[ownProps.name].playBackState.offset,\r\n    isReady : state.console.channel[ownProps.name].playBackState.ready,\r\n})\r\n\r\n\r\nconst mapDispachToProps = (dispatch, ownProps) =>({\r\n    setReadyHandler : (status) => dispatch(setChannelReady(status, ownProps.name)),\r\n    setTimeLeftHandler : (timeLeft) => dispatch(setTimeLeft(ownProps.name, timeLeft))\r\n})\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispachToProps)(Player);"]},"metadata":{},"sourceType":"module"}