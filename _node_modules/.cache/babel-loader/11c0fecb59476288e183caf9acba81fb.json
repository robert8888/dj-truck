{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(deleteTrackRequestSaga),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(handel);import{hideLoading,showLoading}from'react-redux-loading-bar';import{put,select,takeEvery}from\"redux-saga/effects\";import{ACTIONS,deleteTrack,pushLog}from\"../../actions\";import{getApi}from\"./../../apis/apiProvider\";import{Log}from\"./../../utils/logger/logger\";import errorParser from\"./../../utils/serverErrorParser/errorParser\";export default function deleteTrackRequestSaga(){return _regeneratorRuntime.wrap(function deleteTrackRequestSaga$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeEvery(ACTIONS.PL_DELETE_TRACK_REQUEST,handel);case 2:case\"end\":return _context.stop();}}},_marked);}var getToken=function getToken(state){return state.user.token;};function handel(action){var path,token,_getApi,callQuery,queries,response;return _regeneratorRuntime.wrap(function handel$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:path=['saga','playlist','request delete track'];_context2.next=3;return select(getToken);case 3:token=_context2.sent;if(token){_context2.next=8;break;}_context2.next=7;return put(deleteTrack(action.index));case 7:return _context2.abrupt(\"return\",_context2.sent);case 8:_context2.prev=8;_context2.next=11;return put(showLoading());case 11:_getApi=getApi(\"UserAssets\"),callQuery=_getApi.callQuery,queries=_getApi.queries;_context2.next=14;return callQuery(queries.deleteQl.deleteTrack(action.id),token);case 14:response=_context2.sent;if(!response.errors){_context2.next=17;break;}throw new Error('Server response contains errors '+errorParser(response.errors));case 17:if(response.data.deleteTrack){_context2.next=19;break;}throw new Error();case 19:_context2.next=21;return put(deleteTrack(action.index));case 21:_context2.next=23;return put(pushLog(new Log(\"Track deleted from database\",path)));case 23:_context2.next=29;break;case 25:_context2.prev=25;_context2.t0=_context2[\"catch\"](8);_context2.next=29;return put(pushLog(Log.Error(path,\"Can't delete track\"+_context2.t0.message,\"Sorry. During process deleting track occurred a problem\",_context2.t0)));case 29:_context2.prev=29;_context2.next=32;return put(hideLoading());case 32:return _context2.finish(29);case 33:case\"end\":return _context2.stop();}}},_marked2,null,[[8,25,29,33]]);}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/sagas/playlists/reqDeleteTrackSaga.js"],"names":["deleteTrackRequestSaga","handel","hideLoading","showLoading","put","select","takeEvery","ACTIONS","deleteTrack","pushLog","getApi","Log","errorParser","PL_DELETE_TRACK_REQUEST","getToken","state","user","token","action","path","index","callQuery","queries","deleteQl","id","response","errors","Error","data","message"],"mappings":"2JAOyBA,sB,iDAMfC,M,EAbV,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,yBAAzC,CACA,OAASC,GAAT,CAAcC,MAAd,CAAsBC,SAAtB,KAAuC,oBAAvC,CACA,OAASC,OAAT,CAAkBC,WAAlB,CAA+BC,OAA/B,KAA8C,eAA9C,CACA,OAASC,MAAT,KAAuB,0BAAvB,CACA,OAASC,GAAT,KAAoB,6BAApB,CACA,MAAOC,CAAAA,WAAP,KAAwB,6CAAxB,CAEA,cAAe,SAAUZ,CAAAA,sBAAV,kJACX,MAAMM,CAAAA,SAAS,CAACC,OAAO,CAACM,uBAAT,CAAkCZ,MAAlC,CAAf,CADW,sDAIf,GAAMa,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACC,IAAN,CAAWC,KAAf,EAAtB,CAEA,QAAUhB,CAAAA,MAAV,CAAiBiB,MAAjB,sKACUC,IADV,CACiB,CAAC,MAAD,CAAS,UAAT,CAAqB,sBAArB,CADjB,kBAEkB,MAAMd,CAAAA,MAAM,CAACS,QAAD,CAAZ,CAFlB,OAEUG,KAFV,mBAISA,KAJT,2CAKe,MAAMb,CAAAA,GAAG,CAACI,WAAW,CAACU,MAAM,CAACE,KAAR,CAAZ,CAAT,CALf,kGAQQ,MAAMhB,CAAAA,GAAG,CAACD,WAAW,EAAZ,CAAT,CARR,gBASuCO,MAAM,CAAC,YAAD,CAT7C,CASgBW,SAThB,SASgBA,SAThB,CAS2BC,OAT3B,SAS2BA,OAT3B,mBAUuB,MAAMD,CAAAA,SAAS,CAACC,OAAO,CAACC,QAAR,CAAiBf,WAAjB,CAA6BU,MAAM,CAACM,EAApC,CAAD,CAA0CP,KAA1C,CAAf,CAVvB,QAUYQ,QAVZ,oBAYWA,QAAQ,CAACC,MAZpB,gCAakB,IAAIC,CAAAA,KAAJ,CAAU,mCAAoCf,WAAW,CAACa,QAAQ,CAACC,MAAV,CAAzD,CAblB,YAeaD,QAAQ,CAACG,IAAT,CAAcpB,WAf3B,gCAgBkB,IAAImB,CAAAA,KAAJ,EAhBlB,2BAmBQ,MAAMvB,CAAAA,GAAG,CAACI,WAAW,CAACU,MAAM,CAACE,KAAR,CAAZ,CAAT,CAnBR,0BAqBQ,MAAMhB,CAAAA,GAAG,CAACK,OAAO,CAAC,GAAIE,CAAAA,GAAJ,CAAQ,6BAAR,CAAuCQ,IAAvC,CAAD,CAAR,CAAT,CArBR,+GAuBQ,MAAMf,CAAAA,GAAG,CAACK,OAAO,CAACE,GAAG,CAACgB,KAAJ,CACdR,IADc,CAEd,qBAAuB,aAAMU,OAFf,CAGd,yDAHc,cAAD,CAAR,CAAT,CAvBR,4CA8BQ,MAAMzB,CAAAA,GAAG,CAACF,WAAW,EAAZ,CAAT,CA9BR","sourcesContent":["import { hideLoading, showLoading } from 'react-redux-loading-bar';\r\nimport { put, select, takeEvery } from \"redux-saga/effects\";\r\nimport { ACTIONS, deleteTrack, pushLog } from \"../../actions\";\r\nimport { getApi } from \"./../../apis/apiProvider\";\r\nimport { Log } from \"./../../utils/logger/logger\";\r\nimport errorParser from \"./../../utils/serverErrorParser/errorParser\";\r\n\r\nexport default function* deleteTrackRequestSaga() {\r\n    yield takeEvery(ACTIONS.PL_DELETE_TRACK_REQUEST, handel)\r\n}\r\n\r\nconst getToken = state => state.user.token;\r\n\r\nfunction* handel(action) {\r\n    const path = ['saga', 'playlist', 'request delete track'];\r\n    const token = yield select(getToken);\r\n\r\n    if (!token) {\r\n        return yield put(deleteTrack(action.index));\r\n    }\r\n    try {\r\n        yield put(showLoading());\r\n        const { callQuery, queries } = getApi(\"UserAssets\");\r\n        let response = yield callQuery(queries.deleteQl.deleteTrack(action.id), token);\r\n\r\n        if(response.errors){\r\n            throw new Error('Server response contains errors '+ errorParser(response.errors))\r\n        }\r\n        if (!response.data.deleteTrack) {\r\n            throw new Error();\r\n        }\r\n\r\n        yield put(deleteTrack(action.index));\r\n        \r\n        yield put(pushLog(new Log(\"Track deleted from database\", path)))\r\n    } catch (error) {\r\n        yield put(pushLog(Log.Error(\r\n            path,\r\n            \"Can't delete track\" + error.message,\r\n            \"Sorry. During process deleting track occurred a problem\",\r\n            error\r\n        )))\r\n    } finally {\r\n        yield put(hideLoading())\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}