{"ast":null,"code":"import _toConsumableArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{ACTIONS}from\"../../../actions\";import{produce}from\"imer\";import{unset,set,get}from\"lodash/object\";import{findClosesDir,generateTemplateName}from\"./utils\";var initState={list:[],currentPlaylist:[],// path to play list \ncurrentSelection:['root'],// path to dir or playlist current selected\nroot:{},// root dir for play list \nrenameMode:false//mock\n// root: {\n//     _type: \"dir\",\n//     \"Techno\": {\n//         _open: true,\n//         \"ZetTempo\": {\n//             _type: \"playlist\",\n//             _content: [],\n//         },\n//         \"empty dir\": {\n//             _type: \"dir\"\n//         },\n//         \"HardCore\": {\n//             _type: \"playlist\",\n//             _content: [],\n//         },\n//         \"Special\": {\n//             _type: \"dir\",\n//             _open: true,\n//             \"DubTechno\": {\n//                 _type: \"playlist\",\n//                 _content: [],\n//             },\n//             \"Clasic 90\": {\n//                 _type: \"playlist\",\n//                 _content: [],\n//             },\n//         }\n//     },\n//     \"Mini mal\": {\n//         _type: \"dir\",\n//         \"HighTech\": {\n//             _type: \"playlist\",\n//             _content: [],\n//         },\n//         \"Classic\": {\n//             _type: \"playlist\",\n//             _content: [],\n//         },\n//         \"EmptyFolder\": {\n//             _type: \"dir\",\n//         },\n//     }\n// }\n};function playListReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){// ------ dir section ---------------------------\ncase ACTIONS.PL_PUSH_DIR_CONTENT:{var dbDirs=action.dirContent.dirs||[];var dbPlaylists=action.dirContent.playlists||[];var dirs={};dbDirs.forEach(function(dir){dirs[dir.name]={_type:\"dir\",_id:dir.id};});var playlists={};dbPlaylists.forEach(function(pl){playlists[pl.name]={_id:pl.id,_type:\"playlist\",_content:[]};});if(action.isRoot){return _objectSpread({},state,{root:_objectSpread({_id:action.dirContent.dir.id},dirs,{},playlists)});}else{var path=action.path;return produce(state,function(draftState){set(draftState,path,_objectSpread({_id:action.dirContent.dir.id,_type:\"dir\",_loaded:true,_open:action.open||false},dirs,{},playlists));});}}case ACTIONS.PL_CREATE_DIR:{var id=action.id,name=action.name,renameMode=action.renameMode;var pathToDir=findClosesDir(state,state.currentSelection);if(!name){name=generateTemplateName(state,pathToDir,\"New folder\");}return produce(state,function(draftState){set(draftState,[].concat(_toConsumableArray(pathToDir),[name]),{_id:id,_type:\"dir\"});set(draftState,[].concat(_toConsumableArray(pathToDir),[\"_open\"]),true);// parent\ndraftState.currentSelection=[].concat(_toConsumableArray(pathToDir),[name]);if(renameMode){draftState.renameMode=renameMode;}});}case ACTIONS.PL_TOGGLE_DIR:{var open=get(state,[].concat(_toConsumableArray(action.path),[\"_open\"]));return produce(state,function(draftState){return set(draftState,[].concat(_toConsumableArray(action.path),[\"_open\"]),!open);});}// ------ playlist section -------------------------------   \ncase ACTIONS.PL_CREATE_PLAYLIST:{var _name=action.name,_id=action.id,_renameMode=action.renameMode,setCurrent=action.setCurrent;var _pathToDir=findClosesDir(state,state.currentSelection);if(!_name){_name=generateTemplateName(state,_pathToDir,\"New Playlist\");}return produce(state,function(draftState){set(draftState,[].concat(_toConsumableArray(_pathToDir),[_name]),{_id:_id,_type:\"playlist\",_content:[]});set(draftState,[].concat(_toConsumableArray(_pathToDir),[\"_open\"]),true);// open parent dir\ndraftState.currentSelection=[].concat(_toConsumableArray(_pathToDir),[_name]);// set focus on new element \nif(setCurrent){draftState.currentPlaylist=[].concat(_toConsumableArray(_pathToDir),[_name]);}if(_renameMode){draftState.renameMode=_renameMode;}});}case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST:{return produce(state,function(draftState){draftState.list=get(state,[].concat(_toConsumableArray(state.currentSelection),[\"_content\"]));draftState.currentPlaylist=state.currentSelection;});}case ACTIONS.PL_SET_PLAYLIST_CONTENT:{var tracks=action.playlistContent.tracks;tracks.sort(function(a,b){return a.position-b.position;});return produce(state,function(draftState){set(draftState,[].concat(_toConsumableArray(action.path),[\"_content\"]),tracks);});}case ACTIONS.PL_RESET_CURRENT_PLAYLIST_CONTETN:{return produce(state,function(draftState){draftState.list=action.list;set(draftState,[].concat(_toConsumableArray(state.currentPlaylist),[\"_contetnt\"]),action.list);});}// ---------- selction actions ----------------------\ncase ACTIONS.PL_SET_SELECTION:{return produce(state,function(draftState){return draftState.currentSelection=action.path;});}case ACTIONS.PL_SET_CURRENT_PLAYLIST:{return produce(state,function(draftState){draftState.currentPlayList=action.path;draftState.list=Array.from(get(state,[action.path]));});}case ACTIONS.PL_RENAME_SELECTED:{var content=get(state,state.currentSelection);return produce(state,function(draftState){unset(draftState,state.currentSelection);var newCurrent=draftState.currentSelection;newCurrent.pop();newCurrent.push(action.name);draftState.currentSelection=newCurrent;set(draftState,newCurrent,content);draftState.renameMode=false;});}case ACTIONS.PL_MOVE_TO:{var pathFrom=action.pathFrom,pathTo=action.pathTo;var _content=get(state,pathFrom);var _name2=pathFrom.pop();//if target and source are the same don't do anything\nif(pathFrom.length===pathTo.length&&pathFrom.every(function(e,i){return e===pathTo[i];})){return state;}return produce(state,function(draftState){set(draftState,[].concat(_toConsumableArray(pathTo),[_name2]),_content);unset(draftState,[].concat(_toConsumableArray(pathFrom),[_name2]));if([].concat(_toConsumableArray(pathFrom),[_name2]).join(\"\")===state.currentPlaylist.join(\"\")){draftState.currentPlaylist=[].concat(_toConsumableArray(pathTo),[_name2]);}});}case ACTIONS.PL_DELETE_SELECTED:{return produce(state,function(draftState){unset(draftState,state.currentSelection);draftState.currentSelection=['root'];if(state.currentSelection.every(function(el,i){return el===state.currentPlaylist[i];})){draftState.list=[];}});}//--------------- track actions ------------------\ncase ACTIONS.PL_PUSH_TRACK:{if(state.currentPlaylist.length===0&&action.createNew){//if is not seelect any play list - create new\nvar _pathToDir2=[\"root\"];if(state.currentSelection.length>1){_pathToDir2=findClosesDir(state,state.currentSelection);}var _name3=generateTemplateName(state,_pathToDir2,\"New Playlist\");var fullPath=[].concat(_toConsumableArray(_pathToDir2),[_name3]);return produce(state,function(draftState){// ?? check\nset(draftState,fullPath,{_type:\"playlist\",_content:[]});set(draftState,[].concat(_toConsumableArray(_pathToDir2),[\"_open\"]),true);draftState.currentSelection=fullPath;draftState.currentPlaylist=fullPath;var playlist=Array.from(get(draftState,fullPath));playlist.push(action.track);draftState.list=playlist;set(draftState,fullPath,playlist);});}return produce(state,function(draftState){var list=Array.from(draftState.list);list.push(action.track);draftState.list=list;set(draftState,[].concat(_toConsumableArray(state.currentPlaylist),[\"_content\"]),Array.from(draftState.list));});}case ACTIONS.PL_COPY_TRACK_TO_LIST:{var list=get(state,[].concat(_toConsumableArray(action.path),[\"_content\"]));if(!list)return state;return produce(state,function(draftState){list.push(action.track);set(draftState,[].concat(_toConsumableArray(action.path),[\"_content\"]),list);});}case ACTIONS.PL_SWAP_TRACK_ON_CURRENT:{return produce(state,function(draftState){var newList=_toConsumableArray(state.list);//swaping\nvar trackFrom=newList[action.from];newList[action.from]=newList[action.to];newList[action.to]=trackFrom;draftState.list=newList;set(draftState,[].concat(_toConsumableArray(draftState.currentPlaylist),[\"_content\"]),newList);});}case ACTIONS.PL_SET_BPM_AND_OFFSET:{var _id2=action.id,playlist=action.playlist,bpm=action.bpm,offset=action.offset;var isCurrent=false;if(playlist===undefined||playlist.length===0){isCurrent=true;playlist=state.currentPlaylist;}var _list=get(state,[].concat(_toConsumableArray(playlist),[\"_content\"]));// ?? check\nif(!_list){return state;}_list=Array.from(_list);var index=_list.findIndex(function(element){return element.id===_id2;});if(index===-1){return state;}_list[index].bpm=bpm;if(offset){_list[index].offset=offset;}return produce(state,function(draftState){set(draftState,[].concat(_toConsumableArray(playlist),[\"_content\"]),_list);// ?? check\nif(isCurrent){draftState.list=_list;}draftState.refreshFalg=Math.random();});}case ACTIONS.PL_DELETE_TRACK:{return produce(state,function(draftState){var newList=_toConsumableArray(state.list);newList.splice(action.index,1);draftState.list=newList;set(draftState,[].concat(_toConsumableArray(draftState.currentPlaylist),[\"_content\"]),newList);//?? check\n});}default:return state;}}export default playListReducer;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/reducers/console/playlist/playlistReducer.js"],"names":["ACTIONS","produce","unset","set","get","findClosesDir","generateTemplateName","initState","list","currentPlaylist","currentSelection","root","renameMode","playListReducer","state","action","type","PL_PUSH_DIR_CONTENT","dbDirs","dirContent","dirs","dbPlaylists","playlists","forEach","dir","name","_type","_id","id","pl","_content","isRoot","path","draftState","_loaded","_open","open","PL_CREATE_DIR","pathToDir","PL_TOGGLE_DIR","PL_CREATE_PLAYLIST","setCurrent","PL_OPEN_CURRENT_PLAY_LIST","PL_SET_PLAYLIST_CONTENT","tracks","playlistContent","sort","a","b","position","PL_RESET_CURRENT_PLAYLIST_CONTETN","PL_SET_SELECTION","PL_SET_CURRENT_PLAYLIST","currentPlayList","Array","from","PL_RENAME_SELECTED","content","newCurrent","pop","push","PL_MOVE_TO","pathFrom","pathTo","length","every","e","i","join","PL_DELETE_SELECTED","el","PL_PUSH_TRACK","createNew","fullPath","playlist","track","PL_COPY_TRACK_TO_LIST","PL_SWAP_TRACK_ON_CURRENT","newList","trackFrom","to","PL_SET_BPM_AND_OFFSET","bpm","offset","isCurrent","undefined","index","findIndex","element","refreshFalg","Math","random","PL_DELETE_TRACK","splice"],"mappings":"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","sourcesContent":["import { ACTIONS } from \"../../../actions\";\r\nimport { produce } from \"imer\";\r\nimport { unset, set, get } from \"lodash/object\";\r\nimport { findClosesDir, generateTemplateName } from \"./utils\"\r\n\r\nconst initState = {\r\n    list: [],\r\n\r\n    currentPlaylist: [],// path to play list \r\n    currentSelection: ['root'], // path to dir or playlist current selected\r\n    root: {}, // root dir for play list \r\n\r\n    renameMode: false,\r\n\r\n    //mock\r\n    // root: {\r\n    //     _type: \"dir\",\r\n    //     \"Techno\": {\r\n    //         _open: true,\r\n    //         \"ZetTempo\": {\r\n    //             _type: \"playlist\",\r\n    //             _content: [],\r\n    //         },\r\n    //         \"empty dir\": {\r\n    //             _type: \"dir\"\r\n    //         },\r\n    //         \"HardCore\": {\r\n    //             _type: \"playlist\",\r\n    //             _content: [],\r\n    //         },\r\n    //         \"Special\": {\r\n    //             _type: \"dir\",\r\n    //             _open: true,\r\n    //             \"DubTechno\": {\r\n    //                 _type: \"playlist\",\r\n    //                 _content: [],\r\n    //             },\r\n    //             \"Clasic 90\": {\r\n    //                 _type: \"playlist\",\r\n    //                 _content: [],\r\n    //             },\r\n    //         }\r\n    //     },\r\n    //     \"Mini mal\": {\r\n    //         _type: \"dir\",\r\n    //         \"HighTech\": {\r\n    //             _type: \"playlist\",\r\n    //             _content: [],\r\n    //         },\r\n    //         \"Classic\": {\r\n    //             _type: \"playlist\",\r\n    //             _content: [],\r\n    //         },\r\n    //         \"EmptyFolder\": {\r\n    //             _type: \"dir\",\r\n    //         },\r\n    //     }\r\n    // }\r\n\r\n}\r\n\r\nfunction playListReducer(state = initState, action) {\r\n    switch (action.type) {\r\n        // ------ dir section ---------------------------\r\n        case ACTIONS.PL_PUSH_DIR_CONTENT: {\r\n            const dbDirs = action.dirContent.dirs || [];\r\n            const dbPlaylists = action.dirContent.playlists || [];\r\n\r\n            const dirs = {};\r\n            dbDirs.forEach((dir) => {\r\n                dirs[dir.name] = {\r\n                    _type: \"dir\",\r\n                    _id: dir.id\r\n                }\r\n            })\r\n\r\n            const playlists = {};\r\n            dbPlaylists.forEach((pl) => {\r\n                playlists[pl.name] = {\r\n                    _id: pl.id,\r\n                    _type: \"playlist\",\r\n                    _content: []\r\n                };\r\n            })\r\n\r\n            if (action.isRoot) {\r\n                return {\r\n                    ...state,\r\n                    root: {\r\n                        _id: action.dirContent.dir.id,\r\n                        ...dirs,\r\n                        ...playlists,\r\n                    }\r\n                }\r\n            } else {\r\n                const path = action.path;\r\n                return produce(state, draftState => {\r\n                    set(draftState, path, {\r\n                        _id: action.dirContent.dir.id,\r\n                        _type: \"dir\",\r\n                        _loaded: true,\r\n                        _open: action.open || false,\r\n                        ...dirs,\r\n                        ...playlists\r\n                    })\r\n                })\r\n            }\r\n        }\r\n\r\n        case ACTIONS.PL_CREATE_DIR: {\r\n            let { id, name, renameMode } = action;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            if (!name) {\r\n                name = generateTemplateName(state, pathToDir, \"New folder\")\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], {\r\n                    _id: id,\r\n                    _type: \"dir\",\r\n                });\r\n                set(draftState, [...pathToDir, \"_open\"], true); // parent\r\n                draftState.currentSelection = [...pathToDir, name];\r\n                if (renameMode) {\r\n                    draftState.renameMode = renameMode;\r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_TOGGLE_DIR: {\r\n            const open = get(state, [...action.path, \"_open\"])\r\n            return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open))\r\n        }\r\n\r\n        // ------ playlist section -------------------------------   \r\n\r\n        case ACTIONS.PL_CREATE_PLAYLIST: {\r\n            let { name, id, renameMode, setCurrent } = action;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            if (!name) {\r\n                name = generateTemplateName(state, pathToDir, \"New Playlist\")\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], {\r\n                    _id: id,\r\n                    _type: \"playlist\",\r\n                    _content: []\r\n                })\r\n                set(draftState, [...pathToDir, \"_open\"], true); // open parent dir\r\n                draftState.currentSelection = [...pathToDir, name]; // set focus on new element \r\n                if (setCurrent) {\r\n                    draftState.currentPlaylist = [...pathToDir, name];\r\n                }\r\n                if (renameMode) {\r\n                    draftState.renameMode = renameMode;\r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST: {\r\n            return produce(state, draftState => {\r\n                draftState.list = get(state, [...state.currentSelection, \"_content\"]);\r\n                draftState.currentPlaylist = state.currentSelection;\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SET_PLAYLIST_CONTENT: {\r\n            const tracks = action.playlistContent.tracks;\r\n            tracks.sort((a, b) => a.position - b.position);\r\n            return produce(state, draftState => {\r\n                set(draftState,\r\n                    [...action.path, \"_content\"],\r\n                    tracks\r\n                );\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_RESET_CURRENT_PLAYLIST_CONTETN: {\r\n            return produce(state, draftState => {\r\n                draftState.list = action.list;\r\n                set(draftState, [...state.currentPlaylist, \"_contetnt\"], action.list);\r\n            })\r\n        }\r\n\r\n        // ---------- selction actions ----------------------\r\n\r\n        case ACTIONS.PL_SET_SELECTION: {\r\n            return produce(state, draftState => draftState.currentSelection = action.path)\r\n        }\r\n\r\n        case ACTIONS.PL_SET_CURRENT_PLAYLIST: {\r\n            return produce(state, draftState => {\r\n                draftState.currentPlayList = action.path;\r\n                draftState.list = Array.from(get(state, [action.path]));\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_RENAME_SELECTED: {\r\n            const content = get(state, state.currentSelection);\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                const newCurrent = draftState.currentSelection;\r\n                newCurrent.pop();\r\n                newCurrent.push(action.name);\r\n                draftState.currentSelection = newCurrent;\r\n                set(draftState, newCurrent, content);\r\n                draftState.renameMode = false;\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_MOVE_TO: {\r\n            const { pathFrom, pathTo } = action;\r\n            const content = get(state, pathFrom);\r\n            const name = pathFrom.pop();\r\n            //if target and source are the same don't do anything\r\n            if (pathFrom.length === pathTo.length &&\r\n                pathFrom.every((e, i) => e === pathTo[i])) {\r\n                return state;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathTo, name], content);\r\n                unset(draftState, [...pathFrom, name]);\r\n                if([...pathFrom, name].join(\"\") === state.currentPlaylist.join(\"\")){\r\n                    draftState.currentPlaylist = [...pathTo, name]; \r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_SELECTED: {\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                draftState.currentSelection = ['root'];\r\n                if(state.currentSelection.every((el, i) => el === state.currentPlaylist[i])){\r\n                    draftState.list  = [];\r\n                }\r\n            })\r\n        }\r\n\r\n        //--------------- track actions ------------------\r\n\r\n        case ACTIONS.PL_PUSH_TRACK: {\r\n            if (state.currentPlaylist.length === 0 && action.createNew) {\r\n                //if is not seelect any play list - create new\r\n                let pathToDir = [\"root\"]\r\n                if (state.currentSelection.length > 1) {\r\n                    pathToDir = findClosesDir(state, state.currentSelection);\r\n                }\r\n                const name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n                const fullPath = [...pathToDir, name];\r\n                return produce(state, draftState => { // ?? check\r\n                    set(draftState, fullPath, {\r\n                        _type: \"playlist\",\r\n                        _content: []\r\n                    })\r\n                    set(draftState, [...pathToDir, \"_open\"], true);\r\n                    draftState.currentSelection = fullPath\r\n                    draftState.currentPlaylist = fullPath;\r\n                    const playlist = Array.from(get(draftState, fullPath));\r\n                    playlist.push(action.track);\r\n                    draftState.list = playlist;\r\n                    set(draftState, fullPath, playlist);\r\n                })\r\n            }\r\n            return produce(state, draftState => {\r\n                const list = Array.from(draftState.list);\r\n                list.push(action.track)\r\n                draftState.list = list;\r\n                set(draftState, [...state.currentPlaylist, \"_content\"], Array.from(draftState.list));\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_COPY_TRACK_TO_LIST: {\r\n            const list = get(state, [...action.path, \"_content\"]);\r\n            if (!list) return state;\r\n            return produce(state, draftState => {\r\n                list.push(action.track);\r\n                set(draftState, [...action.path, \"_content\"], list);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SWAP_TRACK_ON_CURRENT: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                //swaping\r\n                let trackFrom = newList[action.from];\r\n                newList[action.from] = newList[action.to];\r\n                newList[action.to] = trackFrom;\r\n\r\n                draftState.list = newList;\r\n                set(draftState, [...draftState.currentPlaylist, \"_content\"], newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SET_BPM_AND_OFFSET: {\r\n            let { id, playlist, bpm, offset } = action;\r\n            let isCurrent = false;\r\n            if (playlist === undefined || playlist.length === 0) {\r\n                isCurrent = true;\r\n                playlist = state.currentPlaylist;\r\n            }\r\n            let list = get(state, [...playlist, \"_content\"]) // ?? check\r\n            if (!list) {\r\n                return state;\r\n            }\r\n            list = Array.from(list);\r\n            const index = list.findIndex(element => element.id === id);\r\n            if (index === -1) {\r\n                return state;\r\n            }\r\n            list[index].bpm = bpm;\r\n            if (offset) {\r\n                list[index].offset = offset;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...playlist, \"_content\"], list); // ?? check\r\n                if (isCurrent) {\r\n                    draftState.list = list;\r\n                }\r\n                draftState.refreshFalg = Math.random();\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_TRACK: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                newList.splice(action.index, 1);\r\n                draftState.list = newList\r\n                set(draftState, [...draftState.currentPlaylist, \"_content\"], newList) //?? check\r\n            })\r\n        }\r\n\r\n        default: return state;\r\n    }\r\n}\r\n\r\nexport default playListReducer;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}