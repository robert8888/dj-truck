{"ast":null,"code":"import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{Fragment,useCallback}from\"react\";import{connect}from\"react-redux\";import{reqDeleteComment,reqPostComment,reqUpdateComment}from\"./../../../../actions\";import{usePlayer}from\"./../../Hooks/usePlayer\";import CommentContent from\"./Comment/Comment\";import\"./record-comments.scss\";var RecordComments=function RecordComments(_ref){var userId=_ref.userId,record=_ref.record,postComment=_ref.postComment,updateComment=_ref.updateComment,deleteComment=_ref.deleteComment;var _usePlayer=usePlayer(),_usePlayer2=_slicedToArray(_usePlayer,2),player=_usePlayer2[1];var post=useCallback(function(text){if(!postComment||!record||!userId)return;var timeOfComment=0;var currentPlayback=player.getCurrent();if(currentPlayback.id===record.id){timeOfComment=currentPlayback.progress*currentPlayback.duration;}var commentData={recordId:record.id,userId:userId,text:text,time:timeOfComment};postComment(commentData);},[postComment,record,userId,player]);var update=useCallback(function(id,text){if(!userId||!record)return;var commentData={commentId:id,text:text};updateComment(commentData);},[updateComment,userId,record]);var onDelete=useCallback(function(id){if(!userId)return;deleteComment(id);},[userId,deleteComment]);var onCommentChange=useCallback(function(id,text){if(!text)return;if(!id){post(text);}else{update(id,text);}},[post,update]);return React.createElement(\"div\",{className:\"record-comments\"},userId&&React.createElement(Fragment,null,React.createElement(\"h6\",null,\"Create new comment: \"),React.createElement(\"div\",{className:\"comment-post-form\"},React.createElement(CommentContent,{creationMode:true,onChange:onCommentChange.bind(null,null)}))),record&&record.comments&&record.comments.length>0&&React.createElement(Fragment,null,React.createElement(\"h6\",null,\"Comments: \"),record.comments.map(function(comment){return React.createElement(CommentContent,{key:'comment - '+comment.id,header:comment.user.nickname,editable:comment.user.id===userId,onChange:onCommentChange.bind(null,comment.id),onDelete:onDelete.bind(null,comment.id),date:comment.createdAt,text:comment.text});})));};var mapStateToProps=function mapStateToProps(state){return{record:state.records.currentRecord,userId:state.user.dbId};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{postComment:function postComment(data){return dispatch(reqPostComment(data));},updateComment:function updateComment(data){return dispatch(reqUpdateComment(data));},deleteComment:function deleteComment(id){return dispatch(reqDeleteComment(id));}};};export default connect(mapStateToProps,mapDispatchToProps)(RecordComments);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/RecordComments/RecordComments.js"],"names":["React","Fragment","useCallback","connect","reqDeleteComment","reqPostComment","reqUpdateComment","usePlayer","CommentContent","RecordComments","userId","record","postComment","updateComment","deleteComment","player","post","text","timeOfComment","currentPlayback","getCurrent","id","progress","duration","commentData","recordId","time","update","commentId","onDelete","onCommentChange","bind","comments","length","map","comment","user","nickname","createdAt","mapStateToProps","state","records","currentRecord","dbId","mapDispatchToProps","dispatch","data"],"mappings":"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","sourcesContent":["import React, { Fragment, useCallback } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { reqDeleteComment, reqPostComment, reqUpdateComment } from \"./../../../../actions\";\r\nimport { usePlayer } from \"./../../Hooks/usePlayer\";\r\nimport CommentContent from \"./Comment/Comment\";\r\nimport \"./record-comments.scss\";\r\n\r\n\r\n\r\nconst RecordComments = ({\r\n        userId,\r\n        record, \r\n        postComment,\r\n        updateComment,\r\n        deleteComment, \r\n    }) =>{\r\n    const [, player] = usePlayer();\r\n\r\n    const post = useCallback((text) => {\r\n        if(!postComment || !record || !userId) return;\r\n\r\n        let timeOfComment = 0;\r\n        const currentPlayback = player.getCurrent();\r\n        if(currentPlayback.id === record.id){\r\n            timeOfComment = currentPlayback.progress * currentPlayback.duration;\r\n        }\r\n\r\n        const commentData = {\r\n            recordId : record.id,\r\n            userId: userId,\r\n            text: text,\r\n            time: timeOfComment,\r\n        }\r\n        postComment(commentData)\r\n    },[postComment, record, userId, player])\r\n\r\n    const update = useCallback((id, text) => {\r\n        if(!userId || !record) return;\r\n        const commentData = {\r\n            commentId : id,\r\n            text : text,\r\n\r\n        }\r\n        updateComment(commentData)\r\n    }, [updateComment, userId, record])\r\n\r\n    const onDelete = useCallback( id => {\r\n        if(!userId) return;\r\n        deleteComment(id)\r\n    }, [userId, deleteComment])\r\n\r\n    const onCommentChange = useCallback((id, text) => {\r\n        if(!text) return;\r\n        \r\n        if(!id){\r\n            post(text);\r\n        } else {\r\n            update(id, text)\r\n        }\r\n    },[ post, update ])\r\n\r\n\r\n\r\n    return (\r\n        <div className=\"record-comments\">\r\n            {/* Creating new post field */}\r\n\r\n            {userId && \r\n                <Fragment>\r\n                    <h6>Create new comment: </h6>\r\n                    <div className=\"comment-post-form\">\r\n                    <CommentContent \r\n                        creationMode\r\n                        onChange={ onCommentChange.bind(null, null)}/>\r\n                    </div>\r\n                </Fragment>\r\n            }\r\n            {/* Comments list */}\r\n            \r\n            { (record && record.comments && record.comments.length > 0) &&\r\n              <Fragment>\r\n                <h6>Comments: </h6>\r\n                {record.comments.map( comment => (\r\n                    <CommentContent key={'comment - ' + comment.id}\r\n                        header={comment.user.nickname}\r\n                        editable={comment.user.id === userId}\r\n                        onChange={onCommentChange.bind(null, comment.id)}\r\n                        onDelete={onDelete.bind(null, comment.id)}\r\n                        date={comment.createdAt}\r\n                        text={comment.text}/>\r\n                ))}\r\n              </Fragment>\r\n            }\r\n\r\n                       \r\n        </div>\r\n    )\r\n}\r\nconst mapStateToProps = state => ({\r\n    record: state.records.currentRecord,\r\n    userId: state.user.dbId,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    postComment: (data) => dispatch(reqPostComment(data)),\r\n    updateComment : (data) => dispatch(reqUpdateComment(data)),\r\n    deleteComment: (id) => dispatch(reqDeleteComment(id)),\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(RecordComments)"]},"metadata":{},"sourceType":"module"}