{"ast":null,"code":"/**\r\n * Adapted from https://github.com/web-audio-components/simple-reverb\r\n */\nimport Effect from \"./../effect\";\nimport worker from \"./buildImpulseWebWorker\";\nimport WebWorker from \"./workerSetup\";\nimport { toRange } from \"./../../../../../../../utils/math/argRanges\";\nexport default class Reverb extends Effect {\n  static defaultParams() {\n    return {\n      params: {\n        seconds: {\n          min: 1,\n          max: 50,\n          defaultValue: 3,\n          type: \"float\",\n          description: \"time\"\n        },\n        decay: {\n          min: 0,\n          max: 100,\n          defaultValue: 2,\n          type: \"float\",\n          description: \"decay\"\n        },\n        reverse: {\n          min: 0,\n          max: 1,\n          defaultValue: 0,\n          type: \"bool\",\n          description: \"rev\"\n        }\n      }\n    };\n  }\n\n  constructor(context, params) {\n    super();\n    this.inputNode = this.output = context.createConvolver();\n    this._context = context;\n    this._default = Reverb.defaultParams().params;\n\n    this._initParams(params);\n\n    this.configWorker();\n\n    this._buildImpulse();\n  }\n\n  configWorker() {\n    this._buildImpulseWorker = new WebWorker(worker);\n\n    this._buildImpulseWorker.addEventListener(\"message\", e => {\n      if (e.data[0].type === \"IMPLUSE\") {\n        const impulseL = e.data[1];\n        const impulseR = e.data[2];\n        const length = e.data[0].length;\n\n        const impulse = this._context.createBuffer(2, length, this._context.sampleRate);\n\n        impulse.copyToChannel(impulseL, 0, 0);\n        impulse.copyToChannel(impulseR, 1, 0);\n        this.inputNode.buffer = impulse;\n      }\n    });\n  }\n\n  connect(input, dest) {\n    super.connect(input, dest);\n\n    if (!this._buildImpulseWorker) {\n      this.configWorker();\n    }\n  }\n\n  disconnect() {\n    super.disconnect();\n\n    this._buildImpulseWorker.terminate();\n\n    delete this._buildImpulseWorker;\n  }\n\n  _buildImpulse() {\n    if (!this._buildImpulseWorker) {\n      return;\n    }\n\n    let rate = this._context.sampleRate;\n    const length = rate * this.seconds;\n\n    const impulse = this._context.createBuffer(2, length, rate);\n\n    const impulseR = new Float32Array(length);\n    const impulseL = new Float32Array(length);\n    impulse.copyFromChannel(impulseL, 0, 0);\n    impulse.copyFromChannel(impulseR, 1, 0);\n\n    this._buildImpulseWorker.postMessage([{\n      type: \"BUILD_IMPULSE\",\n      length: length,\n      decay: this._decay,\n      reverse: this._reverse\n    }, impulseL, impulseR]);\n  }\n\n  get name() {\n    return \"Reverb\";\n  }\n\n  get seconds() {\n    return this._seconds;\n  }\n\n  set seconds(value) {\n    value = this._valueToRange(value, \"seconds\");\n    this._seconds = value;\n\n    this._buildImpulse();\n  }\n\n  get decay() {\n    return this._decay;\n  }\n\n  set decay(value) {\n    value = this._valueToRange(value, \"decay\");\n    this._decay = value;\n\n    this._buildImpulse();\n  }\n\n  get reverse() {\n    return this._reverse;\n  }\n\n  set reverse(value) {\n    this._reverse = value === 1 || value === \"true\";\n\n    this._buildImpulse();\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/pages/app/core/console/effector/effects/reverb/reverb.js"],"names":["Effect","worker","WebWorker","toRange","Reverb","defaultParams","params","seconds","min","max","defaultValue","type","description","decay","reverse","constructor","context","inputNode","output","createConvolver","_context","_default","_initParams","configWorker","_buildImpulse","_buildImpulseWorker","addEventListener","e","data","impulseL","impulseR","length","impulse","createBuffer","sampleRate","copyToChannel","buffer","connect","input","dest","disconnect","terminate","rate","Float32Array","copyFromChannel","postMessage","_decay","_reverse","name","_seconds","value","_valueToRange"],"mappings":"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","sourcesContent":["/**\r\n * Adapted from https://github.com/web-audio-components/simple-reverb\r\n */\r\nimport Effect from \"./../effect\";\r\nimport worker from \"./buildImpulseWebWorker\";\r\nimport WebWorker from \"./workerSetup\";\r\nimport {toRange} from \"./../../../../../../../utils/math/argRanges\";\r\n\r\nexport default class Reverb extends Effect {\r\n    static defaultParams() {\r\n        return {\r\n            params: {\r\n                seconds: {\r\n                    min: 1,\r\n                    max: 50,\r\n                    defaultValue: 3,\r\n                    type: \"float\",\r\n                    description: \"time\"\r\n                },\r\n                decay: {\r\n                    min: 0,\r\n                    max: 100,\r\n                    defaultValue: 2,\r\n                    type: \"float\",\r\n                    description: \"decay\"\r\n                },\r\n                reverse: {\r\n                    min: 0,\r\n                    max: 1,\r\n                    defaultValue: 0,\r\n                    type: \"bool\",\r\n                    description : \"rev\"\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    constructor(context, params) {\r\n        super();\r\n        this.inputNode = this.output = context.createConvolver()\r\n        this._context = context;\r\n        this._default = Reverb.defaultParams().params;\r\n\r\n        this._initParams(params);\r\n        this.configWorker();\r\n        this._buildImpulse();\r\n    }\r\n\r\n    configWorker(){\r\n        this._buildImpulseWorker = new WebWorker(worker);\r\n        this._buildImpulseWorker.addEventListener(\"message\", e =>{\r\n            if(e.data[0].type === \"IMPLUSE\"){\r\n                const impulseL = e.data[1];\r\n                const impulseR = e.data[2];\r\n                const length = e.data[0].length;\r\n         \r\n                const impulse = this._context.createBuffer(2, length, this._context.sampleRate);\r\n                impulse.copyToChannel(impulseL, 0, 0);\r\n                impulse.copyToChannel(impulseR, 1, 0);\r\n                this.inputNode.buffer = impulse;\r\n            }\r\n        })\r\n    }\r\n\r\n    connect(input, dest) {\r\n        super.connect(input, dest);\r\n        if(!this._buildImpulseWorker){\r\n            this.configWorker();\r\n        }\r\n    }\r\n\r\n    disconnect() {\r\n        super.disconnect();\r\n        this._buildImpulseWorker.terminate();\r\n        delete this._buildImpulseWorker;\r\n    }\r\n\r\n    _buildImpulse(){\r\n        if(!this._buildImpulseWorker){\r\n            return;\r\n        }\r\n        let rate = this._context.sampleRate;\r\n        const length = rate * this.seconds;\r\n\r\n        const impulse = this._context.createBuffer(2, length, rate);\r\n        const impulseR = new Float32Array(length);\r\n        const impulseL = new Float32Array(length);\r\n        impulse.copyFromChannel(impulseL, 0, 0);\r\n        impulse.copyFromChannel(impulseR, 1, 0);\r\n\r\n        this._buildImpulseWorker.postMessage([{\r\n            type: \"BUILD_IMPULSE\",\r\n            length : length,\r\n            decay : this._decay,\r\n            reverse : this._reverse\r\n        }, impulseL, impulseR])\r\n    }\r\n\r\n    get name(){\r\n        return \"Reverb\";\r\n    }\r\n\r\n    get seconds() {\r\n        return this._seconds;\r\n    }\r\n\r\n    set seconds(value) {\r\n        value = this._valueToRange(value, \"seconds\")\r\n        this._seconds = value;\r\n        this._buildImpulse();\r\n    }\r\n\r\n    get decay() {\r\n        return this._decay;\r\n    }\r\n\r\n    set decay(value) {\r\n        value = this._valueToRange(value, \"decay\")\r\n        this._decay = value;\r\n        this._buildImpulse();\r\n    }\r\n\r\n    get reverse() {\r\n        return this._reverse;\r\n    };\r\n\r\n    set reverse(value) {\r\n        this._reverse = (value === 1 || value === \"true\");\r\n        this._buildImpulse();\r\n    }\r\n\r\n\r\n}\r\n"]},"metadata":{},"sourceType":"module"}