{"ast":null,"code":"import store from \"./../../../store/\";\nimport getApi from \"./../../../apis/apiProvider\";\nimport { setCuePoint, setChannelReady, setTimeLeft } from \"./../../../actions\";\nexport default class Channels {\n  constructor() {\n    this.dispatch = store.dispatch;\n    this.channels = {\n      A: null,\n      B: null\n    };\n  }\n\n  getChannelNames() {\n    return Object.keys(this.channels);\n  }\n\n  setChannel(channelName, player) {\n    this.channels[channelName] = player;\n  }\n\n  getChannel(channelName) {\n    return this.channels[channelName];\n  }\n\n  getChannelInterface(channelName) {\n    return {\n      getSyncBarPosition: () => this.getSyncBarPostion(channelName)\n    };\n  } //--------------------------------------------\n\n\n  loadTrack(channelName, track) {\n    let api = getApi(track.source);\n    let url = api && api.getUrl(track.id) || null;\n    this.dispatch(setChannelReady(false, channelName));\n    let player = this.channels[channelName];\n\n    if (player.loadWithEvent) {\n      player.loadWithEvent(url);\n    } else {\n      player.load(url);\n    }\n  }\n\n  updatePosition(channelName) {\n    this.updateTimeLeft(channelName);\n  }\n\n  updateTimeLeft(channelName) {\n    let channel = this.channels[channelName];\n    this.dispatch(setTimeLeft(channelName, parseInt(channel.getDuration() - channel.getCurrentTime())));\n  }\n\n  togglePlay(channelName, currentValue) {\n    if (currentValue) {\n      this.channels[channelName].pause();\n    } else {\n      this.channels[channelName].play();\n    }\n  }\n\n  toggleCue(channelName, currentValue) {\n    const player = this.channels[channelName];\n    const isPaused = store.getState().console.channel[channelName].playBackState.paused;\n\n    if (!currentValue && isPaused) {\n      // back to cue point and pause\n      let cuePoint = store.getState().console.channel[channelName].playBackState.cuePoint; //in seconds\n      //seek to\n\n      player.pause();\n      player.backend.seekTo(cuePoint);\n      player.drawer.progress(cuePoint / player.getDuration());\n      player.drawer.recenter(cuePoint / player.getDuration());\n    } else if (!currentValue) {\n      //Cancel cue and play\n      if (!player.isPlaying()) {\n        player.play();\n      }\n    } else {\n      const cuePoint = this.channels[channelName].getCurrentTime();\n      this.channels[channelName].play();\n      this.dispatch(setCuePoint(channelName, cuePoint)); // in float seconds\n    }\n  }\n\n  adjustPitch(channelName, currentValue) {\n    this.channels[channelName].setPlaybackRate(1 + currentValue / 100);\n  } //---------------------\n\n\n  getSyncBarPostion(channelName) {\n    let state = this.store.getState();\n    const master = this.channels[state.console.master];\n    const slave = this.channels[channelName];\n    const masterBpm = state.console.channels[state.console.master].track.bpm;\n    const masterOffset = state.console.channels[state.console.master].playBackState.offset;\n    const slaveBpm = state.console.channels[channelName].track.bpm;\n    const slaveOffset = state.console.channels[channelName].playBackState.offset;\n    return store.getState().console.master;\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/core/console/channels/channels.js"],"names":["store","getApi","setCuePoint","setChannelReady","setTimeLeft","Channels","constructor","dispatch","channels","A","B","getChannelNames","Object","keys","setChannel","channelName","player","getChannel","getChannelInterface","getSyncBarPosition","getSyncBarPostion","loadTrack","track","api","source","url","getUrl","id","loadWithEvent","load","updatePosition","updateTimeLeft","channel","parseInt","getDuration","getCurrentTime","togglePlay","currentValue","pause","play","toggleCue","isPaused","getState","console","playBackState","paused","cuePoint","backend","seekTo","drawer","progress","recenter","isPlaying","adjustPitch","setPlaybackRate","state","master","slave","masterBpm","bpm","masterOffset","offset","slaveBpm","slaveOffset"],"mappings":"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","sourcesContent":["import store from \"./../../../store/\";\r\nimport getApi from \"./../../../apis/apiProvider\";\r\nimport { setCuePoint, setChannelReady, setTimeLeft }\r\n    from \"./../../../actions\";\r\n\r\nexport default class Channels{\r\n    constructor(){\r\n        this.dispatch = store.dispatch;\r\n        this.channels = {\r\n            A: null, \r\n            B: null\r\n        }\r\n    }\r\n\r\n    getChannelNames(){\r\n        return Object.keys(this.channels);\r\n    }\r\n\r\n    setChannel(channelName, player){\r\n        this.channels[channelName] = player;\r\n    }\r\n\r\n    getChannel(channelName){\r\n        return this.channels[channelName];\r\n    }\r\n\r\n    getChannelInterface(channelName){\r\n        return {\r\n            getSyncBarPosition : () =>  this.getSyncBarPostion(channelName),\r\n        }\r\n    }\r\n    \r\n    //--------------------------------------------\r\n\r\n    loadTrack(channelName, track){\r\n        let api = getApi(track.source);\r\n        let url = (api && api.getUrl(track.id)) || null;\r\n\r\n        this.dispatch(setChannelReady(false, channelName));\r\n\r\n        let player = this.channels[channelName];\r\n\r\n        if(player.loadWithEvent){\r\n            player.loadWithEvent(url);\r\n        } else {\r\n            player.load(url)\r\n        }\r\n\r\n    }\r\n\r\n    updatePosition(channelName){\r\n        this.updateTimeLeft(channelName)\r\n    }\r\n\r\n    updateTimeLeft(channelName){\r\n        let channel = this.channels[channelName];\r\n        this.dispatch(setTimeLeft(channelName, parseInt(channel.getDuration() - channel.getCurrentTime())))\r\n    }\r\n\r\n    togglePlay(channelName, currentValue){\r\n        if(currentValue){\r\n            this.channels[channelName].pause();\r\n        } else {\r\n            this.channels[channelName].play();\r\n        }\r\n    }\r\n\r\n    toggleCue(channelName, currentValue){\r\n        const player = this.channels[channelName]\r\n        const isPaused = store.getState().console.channel[channelName].playBackState.paused;\r\n        if(!currentValue && isPaused){ // back to cue point and pause\r\n            let cuePoint =  store.getState().console.channel[channelName].playBackState.cuePoint; //in seconds\r\n            //seek to\r\n            player.pause();\r\n            player.backend.seekTo(cuePoint);\r\n            player.drawer.progress(cuePoint / player.getDuration());\r\n            player.drawer.recenter(cuePoint / player.getDuration());\r\n        } else if(!currentValue) { //Cancel cue and play\r\n            if(!player.isPlaying()){\r\n                player.play();\r\n            }\r\n        }\r\n        else {\r\n            const cuePoint = this.channels[channelName].getCurrentTime();\r\n            this.channels[channelName].play();\r\n            this.dispatch(setCuePoint(channelName, cuePoint)) // in float seconds\r\n        }\r\n    }\r\n\r\n    adjustPitch(channelName, currentValue){\r\n        this.channels[channelName].setPlaybackRate( 1 + currentValue/100 )\r\n    }\r\n\r\n    //---------------------\r\n\r\n    getSyncBarPostion(channelName){\r\n        let state  = this.store.getState();\r\n        const master = this.channels[state.console.master] \r\n        const slave = this.channels[channelName];\r\n        const masterBpm =  state.console.channels[state.console.master].track.bpm;\r\n        const masterOffset = state.console.channels[state.console.master].playBackState.offset;\r\n        const slaveBpm = state.console.channels[channelName].track.bpm;\r\n        const slaveOffset = state.console.channels[channelName].playBackState.offset;\r\n        \r\n        return store.getState().console.master;\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}