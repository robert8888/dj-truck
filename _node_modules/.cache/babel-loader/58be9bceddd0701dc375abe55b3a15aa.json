{"ast":null,"code":"import React, { useMemo, useState, useEffect, useCallback, useContext } from \"react\";\nimport { getApi } from \"./../../../../apis/apiProvider\";\nimport { PLAYBACK_STATE } from \"./ListItem/PlaybackButton/PlaybackButton\"; //getRecordUrl\n\nexport const PlayerContext = React.createContext({\n  subscirbes: new Set(),\n\n  subscribeSrcChange(subscirber) {\n    this.add(subscirber);\n  },\n\n  spread(id) {\n    for (let sub of this.subscirbes) {\n      sub.currentIs(id);\n    }\n  }\n\n});\nexport function useRecordPlayer() {\n  const [btnStore, setBtnControl] = useState(null);\n  const [mediaElement, setMediaElement] = useState(null);\n  const subCtx = useContext(PlayerContext);\n  const api = useMemo(() => {\n    return getApi('RecordsStore');\n  }, [getApi]);\n  useEffect(() => {\n    const medEl = document.createElement('audio');\n    medEl.autoplay = true;\n    medEl.preload = 'metadata';\n    setMediaElement(medEl);\n  }, [setMediaElement]);\n  const playback = useCallback((id, pbState) => {\n    if (pbState === PLAYBACK_STATE.PLAY) {\n      mediaElement.src = api.getRecordUrl(id);\n      mediaElement.play();\n    } else if (pbState === PLAYBACK_STATE.PAUSE) {\n      mediaElement.puase();\n    }\n\n    console.log(id, pbState);\n  }, [mediaElement, api]);\n\n  function seek(id, position) {\n    mediaElement.src = api.getRecordUrl(id, position);\n    console.log(\"seek \", id, position);\n  }\n\n  function setCtrBtnHandler(id, ref) {\n    console.log(id, ref);\n    setBtnControl({ ...btnStore //  [id]: () => ref()\n\n    });\n  }\n\n  return [playback, seek, PlayerContext];\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/RecordList/useRecordPlayer.js"],"names":["React","useMemo","useState","useEffect","useCallback","useContext","getApi","PLAYBACK_STATE","PlayerContext","createContext","subscirbes","Set","subscribeSrcChange","subscirber","add","spread","id","sub","currentIs","useRecordPlayer","btnStore","setBtnControl","mediaElement","setMediaElement","subCtx","api","medEl","document","createElement","autoplay","preload","playback","pbState","PLAY","src","getRecordUrl","play","PAUSE","puase","console","log","seek","position","setCtrBtnHandler","ref"],"mappings":"AAAA,OAAOA,KAAP,IAAgBC,OAAhB,EAAyBC,QAAzB,EAAmCC,SAAnC,EAA8CC,WAA9C,EAA2DC,UAA3D,QAA6E,OAA7E;AACA,SAASC,MAAT,QAAuB,gCAAvB;AACA,SAAQC,cAAR,QAA6B,0CAA7B,C,CAEA;;AACA,OAAO,MAAMC,aAAa,GAAGR,KAAK,CAACS,aAAN,CAAoB;AAC7CC,EAAAA,UAAU,EAAE,IAAIC,GAAJ,EADiC;;AAG7CC,EAAAA,kBAAkB,CAACC,UAAD,EAAY;AAC1B,SAAKC,GAAL,CAASD,UAAT;AACH,GAL4C;;AAO7CE,EAAAA,MAAM,CAACC,EAAD,EAAI;AACN,SAAI,IAAIC,GAAR,IAAe,KAAKP,UAApB,EAA+B;AAC3BO,MAAAA,GAAG,CAACC,SAAJ,CAAcF,EAAd;AACH;AACJ;;AAX4C,CAApB,CAAtB;AAcP,OAAO,SAASG,eAAT,GAA0B;AAC7B,QAAM,CAACC,QAAD,EAAWC,aAAX,IAA4BnB,QAAQ,CAAC,IAAD,CAA1C;AACA,QAAM,CAACoB,YAAD,EAAeC,eAAf,IAAkCrB,QAAQ,CAAC,IAAD,CAAhD;AACA,QAAMsB,MAAM,GAAGnB,UAAU,CAACG,aAAD,CAAzB;AAEA,QAAMiB,GAAG,GAAGxB,OAAO,CAAC,MAAI;AACpB,WAAOK,MAAM,CAAC,cAAD,CAAb;AACH,GAFkB,EAEhB,CAACA,MAAD,CAFgB,CAAnB;AAIAH,EAAAA,SAAS,CAAC,MAAI;AACV,UAAMuB,KAAK,GAAGC,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAd;AACAF,IAAAA,KAAK,CAACG,QAAN,GAAiB,IAAjB;AACAH,IAAAA,KAAK,CAACI,OAAN,GAAgB,UAAhB;AACAP,IAAAA,eAAe,CAACG,KAAD,CAAf;AACH,GALQ,EAKN,CAACH,eAAD,CALM,CAAT;AAOA,QAAMQ,QAAQ,GAAG3B,WAAW,CAAC,CAACY,EAAD,EAAKgB,OAAL,KAAe;AACxC,QAAGA,OAAO,KAAKzB,cAAc,CAAC0B,IAA9B,EAAmC;AAC/BX,MAAAA,YAAY,CAACY,GAAb,GAAmBT,GAAG,CAACU,YAAJ,CAAiBnB,EAAjB,CAAnB;AACAM,MAAAA,YAAY,CAACc,IAAb;AACH,KAHD,MAGO,IAAGJ,OAAO,KAAKzB,cAAc,CAAC8B,KAA9B,EAAoC;AACvCf,MAAAA,YAAY,CAACgB,KAAb;AACH;;AACDC,IAAAA,OAAO,CAACC,GAAR,CAAYxB,EAAZ,EAAgBgB,OAAhB;AACH,GAR2B,EAQzB,CAACV,YAAD,EAAeG,GAAf,CARyB,CAA5B;;AAUA,WAASgB,IAAT,CAAczB,EAAd,EAAkB0B,QAAlB,EAA2B;AAEvBpB,IAAAA,YAAY,CAACY,GAAb,GAAmBT,GAAG,CAACU,YAAJ,CAAiBnB,EAAjB,EAAqB0B,QAArB,CAAnB;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBxB,EAArB,EAA0B0B,QAA1B;AACH;;AAED,WAASC,gBAAT,CAA0B3B,EAA1B,EAA8B4B,GAA9B,EAAkC;AAC9BL,IAAAA,OAAO,CAACC,GAAR,CAAYxB,EAAZ,EAAgB4B,GAAhB;AACAvB,IAAAA,aAAa,CAAC,EACV,GAAGD,QADO,CAEZ;;AAFY,KAAD,CAAb;AAIH;;AAED,SAAO,CAACW,QAAD,EAAWU,IAAX,EAAkBjC,aAAlB,CAAP;AACH","sourcesContent":["import React, { useMemo, useState, useEffect, useCallback, useContext } from \"react\"\r\nimport { getApi } from \"./../../../../apis/apiProvider\";\r\nimport {PLAYBACK_STATE} from \"./ListItem/PlaybackButton/PlaybackButton\";\r\n\r\n//getRecordUrl\r\nexport const PlayerContext = React.createContext({\r\n    subscirbes: new Set(),\r\n\r\n    subscribeSrcChange(subscirber){\r\n        this.add(subscirber)\r\n    },\r\n\r\n    spread(id){\r\n        for(let sub of this.subscirbes){\r\n            sub.currentIs(id);\r\n        }\r\n    }\r\n})\r\n\r\nexport function useRecordPlayer(){\r\n    const [btnStore, setBtnControl] = useState(null);\r\n    const [mediaElement, setMediaElement] = useState(null);\r\n    const subCtx = useContext(PlayerContext);\r\n\r\n    const api = useMemo(()=>{\r\n        return getApi('RecordsStore');\r\n    }, [getApi])\r\n\r\n    useEffect(()=>{\r\n        const medEl = document.createElement('audio');\r\n        medEl.autoplay = true;\r\n        medEl.preload = 'metadata'\r\n        setMediaElement(medEl)\r\n    }, [setMediaElement])\r\n\r\n    const playback = useCallback((id, pbState)=>{\r\n        if(pbState === PLAYBACK_STATE.PLAY){\r\n            mediaElement.src = api.getRecordUrl(id);\r\n            mediaElement.play(); \r\n        } else if(pbState === PLAYBACK_STATE.PAUSE){\r\n            mediaElement.puase(); \r\n        }\r\n        console.log(id, pbState);\r\n    }, [mediaElement, api])\r\n\r\n    function seek(id, position){\r\n\r\n        mediaElement.src = api.getRecordUrl(id, position)\r\n        console.log(\"seek \", id , position)\r\n    }\r\n\r\n    function setCtrBtnHandler(id, ref){\r\n        console.log(id, ref)\r\n        setBtnControl({\r\n            ...btnStore,\r\n          //  [id]: () => ref()\r\n        })\r\n    }\r\n\r\n    return [playback, seek , PlayerContext]\r\n}"]},"metadata":{},"sourceType":"module"}