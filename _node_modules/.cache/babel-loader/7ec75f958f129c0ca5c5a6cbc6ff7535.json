{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(renameSelectedRequestSaga),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(callApi);import{get}from\"lodash/object\";import{hideLoading,showLoading}from'react-redux-loading-bar';import{put,select,takeEvery}from\"redux-saga/effects\";import{ACTIONS,pushLog,renameSelected}from\"../../actions\";import{getApi}from\"./../../apis/apiProvider\";import{findClosesDir,generateTemplateName as generateName}from\"./../../reducers/console/playlist/utils\";import{Log}from\"./../../utils/logger/logger\";import errorParser from\"./../../utils/serverErrorParser/errorParser\";export default function renameSelectedRequestSaga(){return _regeneratorRuntime.wrap(function renameSelectedRequestSaga$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return takeEvery(ACTIONS.PL_RENAME_SELECTED_REQUEST,callApi);case 2:case\"end\":return _context.stop();}}},_marked);}var getToken=function getToken(state){return state.user.token;};var getCurrentSelection=function getCurrentSelection(state){return state.playList.currentSelection;};var getCurrent=function getCurrent(state,path){return get(state.playList,path);};var parentDirPath=function parentDirPath(state,path){return findClosesDir(state.playList,path);};var parseName=function parseName(state,path,name){return generateName(state.playList,path,name);};function callApi(action){var path,token,_getApi,callQuery,queries,currentSelection,current,parentPath,id,isPlaylist,name,query,response;return _regeneratorRuntime.wrap(function callApi$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:path=['saga','playlist','request rename selected element'];_context2.next=3;return select(getToken);case 3:token=_context2.sent;if(token){_context2.next=8;break;}_context2.next=7;return put(renameSelected(action.name));case 7:return _context2.abrupt(\"return\");case 8:_context2.prev=8;_context2.next=11;return put(showLoading());case 11:_getApi=getApi(\"UserAssets\"),callQuery=_getApi.callQuery,queries=_getApi.queries;_context2.next=14;return select(getCurrentSelection);case 14:currentSelection=_context2.sent;_context2.next=17;return select(getCurrent,currentSelection);case 17:current=_context2.sent;_context2.next=20;return select(parentDirPath,currentSelection);case 20:parentPath=_context2.sent;id=current._id;isPlaylist=current._type===\"playlist\";_context2.next=25;return select(parseName,parentPath,action.name);case 25:name=_context2.sent;if(id){_context2.next=28;break;}throw new Error(\"Element id missing\");case 28:if(isPlaylist){query=queries.renameQl.renamePlaylist(id,name);}else{// dir\nquery=queries.renameQl.renameDir(id,name);}_context2.next=31;return callQuery(query,token);case 31:response=_context2.sent;if(!response.errors){_context2.next=34;break;}throw new Error('Server response contains errors '+errorParser(response.errors));case 34:_context2.next=36;return put(renameSelected(name));case 36:_context2.next=38;return put(pushLog(new Log(\"Renamed selected \".concat(isPlaylist?\"playlist\":\"dir\",\" succesful id:\")+id,path)));case 38:_context2.next=44;break;case 40:_context2.prev=40;_context2.t0=_context2[\"catch\"](8);_context2.next=44;return put(pushLog(Log.Error(path,\"Can't rename selected\"+_context2.t0.message,\"Sorry. During process renaming occurred a problem\",_context2.t0)));case 44:_context2.prev=44;_context2.next=47;return put(hideLoading());case 47:return _context2.finish(44);case 48:case\"end\":return _context2.stop();}}},_marked2,null,[[8,40,44,48]]);}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/sagas/playlists/reqRenameSelectedSaga.js"],"names":["renameSelectedRequestSaga","callApi","get","hideLoading","showLoading","put","select","takeEvery","ACTIONS","pushLog","renameSelected","getApi","findClosesDir","generateTemplateName","generateName","Log","errorParser","PL_RENAME_SELECTED_REQUEST","getToken","state","user","token","getCurrentSelection","playList","currentSelection","getCurrent","path","parentDirPath","parseName","name","action","callQuery","queries","current","parentPath","id","_id","isPlaylist","_type","Error","query","renameQl","renamePlaylist","renameDir","response","errors","message"],"mappings":"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","sourcesContent":["import { get } from \"lodash/object\";\r\nimport { hideLoading, showLoading } from 'react-redux-loading-bar';\r\nimport { put, select, takeEvery } from \"redux-saga/effects\";\r\nimport { ACTIONS, pushLog, renameSelected } from \"../../actions\";\r\nimport { getApi } from \"./../../apis/apiProvider\";\r\nimport { findClosesDir, generateTemplateName as generateName } from \"./../../reducers/console/playlist/utils\";\r\nimport { Log } from \"./../../utils/logger/logger\";\r\nimport errorParser from \"./../../utils/serverErrorParser/errorParser\";\r\n\r\nexport default function* renameSelectedRequestSaga() {\r\n    yield takeEvery(ACTIONS.PL_RENAME_SELECTED_REQUEST, callApi)\r\n}\r\n\r\nconst getToken = state => state.user.token;\r\n\r\nconst getCurrentSelection = state => state.playList.currentSelection;\r\n\r\nconst getCurrent = (state, path) => get(state.playList, path);\r\n\r\nconst parentDirPath = (state, path) => findClosesDir(state.playList, path);\r\n\r\nconst parseName = (state, path, name) => generateName(state.playList, path, name);\r\n\r\nfunction* callApi(action) {\r\n    const path = ['saga', 'playlist', 'request rename selected element']\r\n\r\n    const token = yield select(getToken);\r\n    if (!token) {\r\n        yield put(renameSelected(action.name));\r\n        return;\r\n    }\r\n    try {\r\n        yield put(showLoading());\r\n        const { callQuery, queries } = getApi(\"UserAssets\");\r\n        const currentSelection = yield select(getCurrentSelection);\r\n        const current = yield select(getCurrent, currentSelection);\r\n        const parentPath = yield select(parentDirPath, currentSelection);\r\n\r\n        const id = current._id;\r\n        const isPlaylist = (current._type === \"playlist\");\r\n\r\n        const name = yield select(parseName, parentPath, action.name)\r\n\r\n        if (!id) {\r\n            throw new Error(\"Element id missing\")\r\n        }\r\n\r\n        let query;\r\n        if (isPlaylist) {\r\n            query = queries.renameQl.renamePlaylist(id, name)\r\n        } else { // dir\r\n            query = queries.renameQl.renameDir(id, name)\r\n        }\r\n\r\n        let response = yield callQuery(query, token);\r\n        \r\n        if(response.errors){\r\n            throw new Error('Server response contains errors '+ errorParser(response.errors))\r\n        }\r\n\r\n        yield put(renameSelected(name));\r\n\r\n        yield put(pushLog(new Log(\r\n                `Renamed selected ${isPlaylist ? \"playlist\" : \"dir\"} succesful id:` + id,\r\n                path)\r\n             ))\r\n    } catch (error) {\r\n        yield put(pushLog(Log.Error(\r\n            path,\r\n            \"Can't rename selected\" + error.message,\r\n            \"Sorry. During process renaming occurred a problem\",\r\n            error\r\n        )))\r\n    } finally{\r\n      yield put(hideLoading())\r\n    }\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}