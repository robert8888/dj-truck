{"ast":null,"code":"import store from \"./../../../../../store\";\nimport { setAvailableEffects } from \"./../../../../../actions\";\nimport Reverb from \"./effects/reverb/reverb\";\nimport Delay from \"./effects/delay/delay\";\nexport default class Effector {\n  constructor(audioContext) {\n    this.config = store.getState().configuration.effector;\n    this.mainAC = audioContext;\n    this.channels = new Array(this.config.channels).fill(null).map(() => Object.create(null));\n    this.effects = {\n      \"reverb\": {\n        create: Reverb,\n        params: Reverb.defaultParams().params\n      },\n      \"delay\": {\n        create: Delay,\n        params: Delay.defaultParams().params\n      }\n    };\n    const exportEffects = {};\n    Object.entries(this.effects).forEach(([key, element]) => exportEffects[key] = element.params);\n    store.dispatch(setAvailableEffects(exportEffects));\n  }\n\n  connect(inputs) {\n    const outputs = inputs.map(() => this.mainAC.createGain());\n    inputs.forEach((inputNode, channelNumber) => {\n      const dryNode = this.mainAC.createGain();\n      const wetNode = this.mainAC.createGain();\n      inputNode.connect(dryNode);\n      dryNode.connect(outputs[channelNumber]);\n      this.channels[channelNumber].inputNode = inputNode;\n      this.channels[channelNumber].dryNode = dryNode;\n      this.channels[channelNumber].wetNode = wetNode;\n      this.channels[channelNumber].outputNode = outputs[channelNumber];\n    });\n    return outputs;\n  }\n\n  setDryWet(channelNumber, value) {\n    console.log(\"set dry wet\", channelNumber + \" val:\", value);\n  }\n\n  setEffect(channelNumber, effect) {\n    if (effect) {\n      let params = { ...this.effects[effect].params\n      };\n      const effectorChannel = store.getState().effector.channels;\n\n      if (effectorChannel && effectorChannel[channelNumber]) {\n        params = { ...effectorChannel[channelNumber].effects[effect]\n        };\n      }\n\n      const effect = this.effects[effect].create(params);\n      this.channels[channelNumber].currentEffect = effect;\n      const channel = this.channels[channelNumber];\n      effect.connect(channel.inputNode, channel.wetNode);\n    } else {} //remove effect\n    //  const params = {...channelEffects[effect]};\n    //  console.log(params);\n    //\n\n  }\n\n  setParam(channelNumber, effect, param) {\n    console.log(\"set param : \" + channelNumber, \"effect: \" + effect, \" pram: \" + param);\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/pages/app/core/console/effector/effector.js"],"names":["store","setAvailableEffects","Reverb","Delay","Effector","constructor","audioContext","config","getState","configuration","effector","mainAC","channels","Array","fill","map","Object","create","effects","params","defaultParams","exportEffects","entries","forEach","key","element","dispatch","connect","inputs","outputs","createGain","inputNode","channelNumber","dryNode","wetNode","outputNode","setDryWet","value","console","log","setEffect","effect","effectorChannel","currentEffect","channel","setParam","param"],"mappings":"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","sourcesContent":["\r\nimport store from \"./../../../../../store\";\r\nimport { setAvailableEffects } from \"./../../../../../actions\";\r\n\r\nimport Reverb from \"./effects/reverb/reverb\";\r\nimport Delay from \"./effects/delay/delay\";\r\n\r\n\r\n\r\nexport default class Effector {\r\n    constructor(audioContext) {\r\n        this.config = store.getState().configuration.effector;\r\n        this.mainAC = audioContext;\r\n\r\n        this.channels = new Array(this.config.channels)\r\n                         .fill(null).map(() => Object.create(null));\r\n        \r\n        this.effects = {\r\n            \"reverb\": {\r\n                create: Reverb,\r\n                params: Reverb.defaultParams().params,\r\n            },\r\n            \"delay\": {\r\n                create: Delay,\r\n                params: Delay.defaultParams().params\r\n            }\r\n        }\r\n\r\n        const exportEffects = {};\r\n        Object.entries(this.effects).forEach(([key, element]) =>\r\n                exportEffects[key] = element.params\r\n            );\r\n        store.dispatch(setAvailableEffects(exportEffects));\r\n    }\r\n\r\n    connect(inputs) {\r\n        const outputs = inputs.map(() => this.mainAC.createGain())\r\n\r\n        inputs.forEach((inputNode, channelNumber) => {\r\n            const dryNode = this.mainAC.createGain();\r\n            const wetNode = this.mainAC.createGain();\r\n            inputNode.connect(dryNode);\r\n            dryNode.connect(outputs[channelNumber]);\r\n\r\n            this.channels[channelNumber].inputNode = inputNode;\r\n            this.channels[channelNumber].dryNode = dryNode;\r\n            this.channels[channelNumber].wetNode = wetNode;\r\n            this.channels[channelNumber].outputNode = outputs[channelNumber];\r\n        });\r\n\r\n        return outputs;\r\n    }\r\n\r\n\r\n    setDryWet(channelNumber, value){\r\n        console.log(\"set dry wet\", channelNumber + \" val:\", value);\r\n    }\r\n       \r\n    setEffect(channelNumber, effect){ \r\n        if(effect){\r\n            let params = {...this.effects[effect].params};\r\n            const effectorChannel =  store.getState().effector.channels;\r\n            if(effectorChannel && effectorChannel[channelNumber]){\r\n                params = {...effectorChannel[channelNumber].effects[effect]}\r\n            }\r\n\r\n            const effect = this.effects[effect].create(params);\r\n            this.channels[channelNumber].currentEffect = effect;\r\n\r\n            const channel = this.channels[channelNumber];\r\n\r\n            effect.connect(channel.inputNode, channel.wetNode)\r\n\r\n        } else {\r\n            //remove effect\r\n        }\r\n\r\n      //  const params = {...channelEffects[effect]};\r\n      //  console.log(params);\r\n        //\r\n    }\r\n\r\n    setParam(channelNumber, effect, param){\r\n        console.log(\"set param : \"+ channelNumber, \"effect: \" + effect, \" pram: \" + param);\r\n    }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}