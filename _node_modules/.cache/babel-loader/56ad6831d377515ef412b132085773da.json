{"ast":null,"code":"import store from \"./../../store\";\nimport Observer from \"./observer/observer\";\nimport STATUS from \"./observer/STATUS\";\nimport { togglePlay, setTimeLeft } from \"./../../actions\";\nimport Channels from \"./channels/channels\";\nimport Mixer from \"./mixer/mixer\";\nlet mixConsole;\nexport default class Console {\n  constructor() {\n    store.subscribe(this.handleChange.bind(this));\n    this.dispatch = store.dispatch;\n    this.observer = new Observer(store);\n    this.channels = new Channels();\n    this.mixer = new Mixer(this.channels);\n  }\n\n  static Create() {\n    mixConsole = new Console();\n  }\n\n  static Get() {\n    if (!mixConsole) {\n      mixConsole = new Console();\n      return mixConsole;\n    } else {\n      return mixConsole;\n    }\n  }\n\n  getMixerChannelInterface(channelName) {\n    return this.mixer.getChannelInterface(channelName);\n  }\n\n  getChannelInterface(channelName) {\n    return this.channels.getChannelInterface(channelName);\n  }\n\n  setPlayer(channelName, player) {\n    this.channels.setChannel(channelName, player);\n    this.mixer.setUpAudioNodes(channelName);\n    this.attachEvents(channelName);\n  }\n\n  createChannel(...args) {\n    this.channels.createChannel(...args);\n  }\n\n  attachEvents(channelName) {\n    const player = this.channels.getChannel(channelName);\n    player.on('finish', () => {\n      this.dispatch(togglePlay(channelName));\n    });\n    let lastUpdate = new Date().getTime();\n    player.on('audioprocess', () => {\n      const currentTime = new Date().getTime();\n\n      if (currentTime - lastUpdate >= 500) {\n        lastUpdate = currentTime;\n        this.channels.updatePosition(channelName);\n      }\n    }); // updating time Left value\n    ///Because on seek event is called a 1000 time per second, is created watcher witch update \n    // value after 500 ms with last progress value \n\n    let lastCall = {\n      time: new Date().getTime(),\n      value: null\n    };\n    let watcher = null;\n    player.on('seek', progress => {\n      lastCall.time = new Date().getTime();\n      lastCall.value = progress;\n\n      if (!watcher) {\n        watcher = setTimeout(() => {\n          if (new Date().getTime() - lastCall.time >= 100) {\n            this.dispatch(setTimeLeft(channelName, parseInt(player.getDuration() * lastCall.value)));\n            clearTimeout(watcher);\n            watcher = null;\n          }\n        }, 500);\n      }\n    });\n  }\n\n  handleChange() {\n    const storeChanges = this.observer.check();\n\n    for (let diff of storeChanges) {\n      this.callAction(diff);\n    }\n  }\n\n  callAction(diff) {\n    switch (diff.status) {\n      case STATUS.TRACK_LOADED:\n        {\n          this.channels.loadTrack(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.BPM_AND_OFFSET_READY:\n        {\n          this.channels.createBars(diff.channelName, diff.currentValue);\n        }\n\n      case STATUS.TOGGLE_PLAY:\n        {\n          this.channels.togglePlay(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.TOGGLE_CUE:\n        {\n          this.channels.toggleCue(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.PITCH_CHANGE:\n        {\n          this.channels.adjustPitch(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.GAIN_CHANGE:\n        {\n          this.mixer.setGain(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.EQ_LOW_CHANGE:\n        {\n          this.mixer.setEqLow(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.EQ_MID_CHANGE:\n        {\n          this.mixer.setEqMid(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.EQ_HI_CHANGE:\n        {\n          this.mixer.setEqHigh(diff.channel, diff.currentValue);\n          break;\n        }\n\n      case STATUS.FADER_CHANGE:\n        {\n          this.mixer.setFader(diff.currentValue);\n          break;\n        }\n\n      case STATUS.SYNC_ACTIVATE:\n        {\n          this.channels.sync(diff.channel);\n        }\n\n      default:\n        return;\n    }\n  }\n\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/core/console/console.js"],"names":["store","Observer","STATUS","togglePlay","setTimeLeft","Channels","Mixer","mixConsole","Console","constructor","subscribe","handleChange","bind","dispatch","observer","channels","mixer","Create","Get","getMixerChannelInterface","channelName","getChannelInterface","setPlayer","player","setChannel","setUpAudioNodes","attachEvents","createChannel","args","getChannel","on","lastUpdate","Date","getTime","currentTime","updatePosition","lastCall","time","value","watcher","progress","setTimeout","parseInt","getDuration","clearTimeout","storeChanges","check","diff","callAction","status","TRACK_LOADED","loadTrack","channel","currentValue","BPM_AND_OFFSET_READY","createBars","TOGGLE_PLAY","TOGGLE_CUE","toggleCue","PITCH_CHANGE","adjustPitch","GAIN_CHANGE","setGain","EQ_LOW_CHANGE","setEqLow","EQ_MID_CHANGE","setEqMid","EQ_HI_CHANGE","setEqHigh","FADER_CHANGE","setFader","SYNC_ACTIVATE","sync"],"mappings":"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","sourcesContent":["import store from \"./../../store\";\r\nimport Observer from \"./observer/observer\";\r\nimport STATUS from \"./observer/STATUS\";\r\nimport { togglePlay,\r\n         setTimeLeft }\r\n         from \"./../../actions\";\r\nimport Channels from \"./channels/channels\";\r\nimport Mixer from \"./mixer/mixer\";\r\n\r\nlet mixConsole;\r\n\r\nexport default class Console{\r\n    constructor(){\r\n        store.subscribe(this.handleChange.bind(this));\r\n        this.dispatch = store.dispatch;\r\n        this.observer = new Observer(store);\r\n\r\n        this.channels = new Channels();\r\n        this.mixer = new Mixer(this.channels);\r\n\r\n    }\r\n\r\n    static Create(){\r\n        mixConsole = new Console();\r\n    }\r\n\r\n    static Get(){\r\n        if(!mixConsole){\r\n            mixConsole = new Console();\r\n            return mixConsole;\r\n        } else {\r\n            return mixConsole;\r\n        }\r\n    }\r\n\r\n    getMixerChannelInterface(channelName){\r\n        return this.mixer.getChannelInterface(channelName);\r\n    }\r\n\r\n    getChannelInterface(channelName){\r\n        return this.channels.getChannelInterface(channelName);\r\n    }\r\n\r\n    setPlayer(channelName, player){\r\n        this.channels.setChannel(channelName, player);\r\n        this.mixer.setUpAudioNodes(channelName);\r\n        this.attachEvents(channelName);\r\n    }\r\n\r\n    createChannel(...args){\r\n        this.channels.createChannel(...args)\r\n    }\r\n\r\n\r\n    attachEvents(channelName){\r\n        const player = this.channels.getChannel(channelName);\r\n        player.on('finish', ()=>{\r\n            this.dispatch(togglePlay(channelName))\r\n        })\r\n\r\n        let lastUpdate = (new Date()).getTime();\r\n        player.on('audioprocess', ()=>{\r\n            const currentTime = (new Date()).getTime();\r\n            if((currentTime - lastUpdate) >= 500){\r\n                lastUpdate = currentTime;\r\n                this.channels.updatePosition(channelName)\r\n            }\r\n        })\r\n        // updating time Left value\r\n        ///Because on seek event is called a 1000 time per second, is created watcher witch update \r\n        // value after 500 ms with last progress value \r\n        let lastCall = {\r\n            time :(new Date()).getTime(),\r\n            value : null\r\n        };\r\n        let watcher = null;\r\n        player.on('seek', progress => {\r\n            lastCall.time = (new Date()).getTime();\r\n            lastCall.value = progress;\r\n            if(!watcher){\r\n                watcher = setTimeout(()=>{\r\n                        if(((new Date()).getTime() - lastCall.time) >= 100)\r\n                        {\r\n                            this.dispatch(setTimeLeft(channelName, parseInt(player.getDuration() * lastCall.value)))\r\n                            clearTimeout(watcher);\r\n                            watcher = null\r\n                        }\r\n                    }, 500)\r\n            }\r\n        })\r\n    }\r\n\r\n    handleChange(){\r\n        const storeChanges = this.observer.check();\r\n        for(let diff of storeChanges){\r\n            this.callAction(diff);\r\n        }\r\n    }\r\n\r\n    callAction(diff){\r\n        switch(diff.status){\r\n            case STATUS.TRACK_LOADED : {\r\n                this.channels.loadTrack(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n\r\n            case STATUS.BPM_AND_OFFSET_READY : {\r\n                this.channels.createBars(diff.channelName, diff.currentValue)\r\n            }\r\n            \r\n            case STATUS.TOGGLE_PLAY : {\r\n                this.channels.togglePlay(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n            case STATUS.TOGGLE_CUE : {\r\n                this.channels.toggleCue(diff.channel, diff.currentValue)\r\n                break;\r\n            }\r\n            case STATUS.PITCH_CHANGE : {\r\n                this.channels.adjustPitch(diff.channel, diff.currentValue)\r\n                break;\r\n            }\r\n            case STATUS.GAIN_CHANGE : {\r\n                this.mixer.setGain(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n            case STATUS.EQ_LOW_CHANGE : {\r\n                this.mixer.setEqLow(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n            case STATUS.EQ_MID_CHANGE : {\r\n                this.mixer.setEqMid(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n            case STATUS.EQ_HI_CHANGE : {\r\n                this.mixer.setEqHigh(diff.channel, diff.currentValue);\r\n                break;\r\n            }\r\n            case STATUS.FADER_CHANGE : {\r\n                this.mixer.setFader(diff.currentValue);\r\n                break;\r\n            }\r\n\r\n            case STATUS.SYNC_ACTIVATE : {\r\n                this.channels.sync(diff.channel);\r\n            }\r\n            default : return; \r\n        }\r\n    }\r\n\r\n}"]},"metadata":{},"sourceType":"module"}