{"ast":null,"code":"import { ACTIONS } from \"../../../actions\";\nimport { produce } from \"imer\";\nimport { unset, set, get } from \"lodash/object\";\nimport { findClosesDir, generateTemplateName } from \"./utils\";\nconst initState = {\n  list: [],\n  currentPlaylist: [],\n  // path to play list \n  currentSelection: ['root'],\n  // path to dir or playlist current selected\n  root: {},\n  // root dir for play list \n  renameMode: false,\n  //mock\n  root: {\n    \"Techno\": {\n      _open: true,\n      \"ZetTempo\": [],\n      \"empty dir\": {},\n      \"HardCore\": [],\n      \"Special\": {\n        _open: true,\n        \"DubTechno\": [],\n        \"Clasic 90\": []\n      }\n    },\n    \"Mini mal\": {\n      \"HighTech\": [],\n      \"Classic\": [],\n      \"EmptyFolder\": {}\n    }\n  }\n};\n\nfunction playListReducer(state = initState, action) {\n  switch (action.type) {\n    //done\n    case ACTIONS.PL_PUSH_DIR_CONTENT:\n      {\n        const dbDirs = action.dirContent.dirs || [];\n        const dbPlaylists = action.dirContent.playlists || [];\n        const dirs = {};\n        dbDirs.map(dir => {\n          dirs[dir.name] = {\n            _id: dir.id\n          };\n        });\n        const playlists = {};\n        dbPlaylists.map(pl => {\n          let newPlaylist = [];\n          newPlaylist._id = pl.id;\n          playlists[pl.name] = newPlaylist;\n        });\n\n        if (action.isRoot) {\n          return { ...state,\n            root: {\n              _id: action.dirContent.dir.id,\n              ...dirs,\n              ...playlists\n            }\n          };\n        } else {\n          const path = action.path;\n          return produce(state, draftState => {\n            set(draftState, path, {\n              _id: action.dirContent.dir.id,\n              _loaded: true,\n              _open: action.open || false,\n              ...dirs,\n              ...playlists\n            });\n          });\n        }\n      }\n\n    case ACTIONS.PUSH_TRACK:\n      {\n        if (state.currentPlaylist.length === 0 && action.createNew) {\n          //if is not seelect any play list - create new\n          let pathToDir = [\"root\"];\n\n          if (state.currentSelection.length > 1) {\n            pathToDir = findClosesDir(state, state.currentSelection);\n          }\n\n          const name = generateTemplateName(state, pathToDir, \"New Playlist\");\n          const fullPath = [...pathToDir, name];\n          return produce(state, draftState => {\n            set(draftState, fullPath, []);\n            set(draftState, [...pathToDir, \"_open\"], true);\n            draftState.currentSelection = fullPath;\n            draftState.currentPlaylist = fullPath;\n            const playlist = Array.from(get(draftState, fullPath));\n            playlist.push(action.track);\n            draftState.list = playlist;\n            set(draftState, fullPath, playlist);\n          });\n        }\n\n        return produce(state, draftState => {\n          const list = Array.from(draftState.list);\n          list.push(action.track);\n          draftState.list = list;\n          set(draftState, state.currentPlaylist, Array.from(draftState.list));\n        });\n      }\n\n    case ACTIONS.SET_BPM_AND_OFFSET:\n      {\n        let {\n          id,\n          playlist,\n          bpm,\n          offset\n        } = action; //  console.log(\"Set bpm and offset\", id, playlist, bpm, offset);\n\n        let isCurrent = false;\n\n        if (playlist === undefined || playlist.length === 0) {\n          isCurrent = true;\n          playlist = state.currentPlaylist;\n        }\n\n        let list = get(state, playlist);\n\n        if (!list) {\n          return state;\n        }\n\n        list = Array.from(list);\n        const index = list.findIndex(element => element.id === id);\n\n        if (index === -1) {\n          return state;\n        }\n\n        list[index].bpm = bpm;\n\n        if (offset) {\n          list[index].offset = offset;\n        }\n\n        return produce(state, draftState => {\n          set(draftState, playlist, list);\n\n          if (isCurrent) {\n            draftState.list = list;\n          }\n\n          draftState.refreshFalg = Math.random();\n        });\n      }\n\n    case ACTIONS.PL_TOGGLE_DIR:\n      {\n        const open = get(state, [...action.path, \"_open\"]);\n        return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open));\n      }\n\n    case ACTIONS.PL_SET_SELECTION:\n      {\n        return produce(state, draftState => draftState.currentSelection = action.path);\n      }\n\n    case ACTIONS.PL_SET_CURRENT_PLAYLIST:\n      {\n        return produce(state, draftState => {\n          draftState.currentPlayList = action.path;\n          draftState.list = Array.from(get(state, [action.path]));\n        });\n      }\n    //done\n\n    case ACTIONS.PL_RENAME_SELECTED:\n      {\n        const content = get(state, state.currentSelection);\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          const newCurrent = draftState.currentSelection;\n          newCurrent.pop();\n          newCurrent.push(action.name);\n          draftState.currentSelection = newCurrent;\n          set(draftState, newCurrent, content);\n          draftState.renameMode = false;\n        });\n      }\n\n    case ACTIONS.PL_DELETE_SELECTED:\n      {\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          draftState.currentSelection = ['root'];\n        });\n      }\n\n    case ACTIONS.PL_MOVE_TO:\n      {\n        const {\n          pathFrom,\n          pathTo\n        } = action;\n        const content = get(state, pathFrom);\n        const name = pathFrom.pop(); //if target and source are the same don't do anything\n\n        if (pathFrom.length === pathTo.length && pathFrom.every((e, i) => e === pathTo[i])) {\n          return state;\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathTo, name], content);\n          unset(draftState, [...pathFrom, name]);\n        });\n      }\n\n    case ACTIONS.PL_DELETE_TRACK:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          newList.splice(action.index, 1);\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_SWAP_TRACK_ON_CURRENT:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          let trackFrom = newList[action.from];\n          newList[action.from] = newList[action.to];\n          newList[action.to] = trackFrom;\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_ADD_TRACK_TO_LIST:\n      {\n        const list = get(state, action.path);\n        if (!list) return state;\n        return produce(state, draftState => {\n          list.push(action.track);\n          set(draftState, action.fullPath, list);\n        });\n      }\n    //done\n\n    case ACTIONS.PL_CREATE_DIR:\n      {\n        const {\n          id,\n          name,\n          renameMode\n        } = action;\n        const pathToDir = findClosesDir(state, state.currentSelection);\n        return produce(state, draftState => {\n          set(draftState, [...pathToDir, name], {\n            _id: id\n          });\n          set(draftState, [...pathToDir, \"_open\"], true);\n          draftState.currentSelection = [...pathToDir, name];\n\n          if (renameMode) {\n            draftState.renameMode = renameMode;\n          }\n        });\n      }\n    //done\n\n    case ACTIONS.PL_CREATE_PLAYLIST:\n      {\n        const {\n          name,\n          id,\n          renameMode,\n          setCurrent\n        } = action;\n        console.log(\"creating playlist reducer\", name, id, renameMode);\n        const pathToDir = findClosesDir(state, state.currentSelection); // const next = produce(state, draftState => {\n        //     const newPlaylist = [];\n        //     newPlaylist._id = id;\n        //     set(draftState, [...pathToDir, name], newPlaylist)\n        //     set(draftState, [...pathToDir, \"_open\"], true);\n        //     draftState.currentSelection = [...pathToDir, name];\n        //     if(setCurrent){\n        //         draftState.currentPlaylist = [...pathToDir, name];\n        //     }\n        //     if(renameMode){\n        //         draftState.renameMode = renameMode;\n        //     }\n        // })\n\n        let nextState = { ...state\n        };\n        const newPlaylist = [];\n        newPlaylist._id = id;\n        set(nextState, [...pathToDir, name], newPlaylist);\n        set(nextState, [...pathToDir, \"_open\"], true);\n        nextState.currentSelection = [...pathToDir, name];\n\n        if (setCurrent) {\n          nextState.currentPlaylist = [...pathToDir, name];\n        }\n\n        if (renameMode) {\n          nextStaterenameMode = renameMode;\n        }\n\n        return nextState;\n      }\n\n    case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST:\n      {\n        return produce(state, draftState => {\n          draftState.list = get(state, state.currentSelection);\n          draftState.currentPlaylist = state.currentSelection;\n        });\n      }\n\n    default:\n      return state;\n  }\n}\n\nexport default playListReducer;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/reducers/console/playlist/playlistReducer.js"],"names":["ACTIONS","produce","unset","set","get","findClosesDir","generateTemplateName","initState","list","currentPlaylist","currentSelection","root","renameMode","_open","playListReducer","state","action","type","PL_PUSH_DIR_CONTENT","dbDirs","dirContent","dirs","dbPlaylists","playlists","map","dir","name","_id","id","pl","newPlaylist","isRoot","path","draftState","_loaded","open","PUSH_TRACK","length","createNew","pathToDir","fullPath","playlist","Array","from","push","track","SET_BPM_AND_OFFSET","bpm","offset","isCurrent","undefined","index","findIndex","element","refreshFalg","Math","random","PL_TOGGLE_DIR","PL_SET_SELECTION","PL_SET_CURRENT_PLAYLIST","currentPlayList","PL_RENAME_SELECTED","content","newCurrent","pop","PL_DELETE_SELECTED","PL_MOVE_TO","pathFrom","pathTo","every","e","i","PL_DELETE_TRACK","newList","splice","PL_SWAP_TRACK_ON_CURRENT","trackFrom","to","PL_ADD_TRACK_TO_LIST","PL_CREATE_DIR","PL_CREATE_PLAYLIST","setCurrent","console","log","nextState","nextStaterenameMode","PL_OPEN_CURRENT_PLAY_LIST"],"mappings":"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","sourcesContent":["import { ACTIONS } from \"../../../actions\";\r\nimport { produce } from \"imer\";\r\nimport { unset, set, get } from \"lodash/object\";\r\nimport { findClosesDir, generateTemplateName } from \"./utils\"\r\n\r\nconst initState = {\r\n    list: [],\r\n\r\n    currentPlaylist: [],// path to play list \r\n    currentSelection: ['root'], // path to dir or playlist current selected\r\n    root: {}, // root dir for play list \r\n\r\n    renameMode : false,\r\n    \r\n    //mock\r\n    root: {\r\n        \"Techno\": {\r\n            _open: true,\r\n            \"ZetTempo\": [],\r\n            \"empty dir\": {},\r\n            \"HardCore\": [],\r\n            \"Special\": {\r\n                _open: true,\r\n                \"DubTechno\": [],\r\n                \"Clasic 90\": []\r\n            }\r\n        },\r\n        \"Mini mal\": {\r\n            \"HighTech\": [],\r\n            \"Classic\": [],\r\n            \"EmptyFolder\": {}\r\n        }\r\n    }\r\n\r\n}\r\n\r\nfunction playListReducer(state = initState, action) {\r\n    switch (action.type) {\r\n        //done\r\n        case ACTIONS.PL_PUSH_DIR_CONTENT: {\r\n            const dbDirs = action.dirContent.dirs || [];\r\n            const dbPlaylists = action.dirContent.playlists || [];\r\n            \r\n            const dirs = {};\r\n            dbDirs.map((dir) => {\r\n                dirs[dir.name] = { _id: dir.id }\r\n            })\r\n            \r\n            const playlists = {};\r\n            dbPlaylists.map((pl) => {\r\n                let newPlaylist = [];\r\n                newPlaylist._id = pl.id;\r\n                playlists[pl.name] = newPlaylist;\r\n            })\r\n           \r\n            if (action.isRoot) {\r\n                return {\r\n                    ...state,\r\n                    root: {\r\n                        _id: action.dirContent.dir.id,\r\n                        ...dirs,\r\n                        ...playlists,\r\n                    }\r\n                }\r\n            } else {\r\n                const path = action.path;\r\n                return produce(state, draftState => {\r\n                    set(draftState, path , {\r\n                        _id: action.dirContent.dir.id,\r\n                        _loaded: true,\r\n                        _open: action.open || false,\r\n                        ...dirs,\r\n                        ...playlists\r\n                    })\r\n                })\r\n            }\r\n        }\r\n\r\n\r\n\r\n        case ACTIONS.PUSH_TRACK: {\r\n            if (state.currentPlaylist.length === 0 && action.createNew) {\r\n                //if is not seelect any play list - create new\r\n                let pathToDir = [\"root\"]\r\n                if (state.currentSelection.length > 1) {\r\n                    pathToDir = findClosesDir(state, state.currentSelection);\r\n                }\r\n                const name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n                const fullPath = [...pathToDir, name];\r\n                return produce(state, draftState => {\r\n                    set(draftState, fullPath, [])\r\n                    set(draftState, [...pathToDir, \"_open\"], true);\r\n                    draftState.currentSelection = fullPath\r\n                    draftState.currentPlaylist = fullPath;\r\n                    const playlist = Array.from(get(draftState, fullPath));\r\n                    playlist.push(action.track);\r\n                    draftState.list = playlist;\r\n                    set(draftState, fullPath, playlist);\r\n                })\r\n            }\r\n            return produce(state, draftState => {\r\n                const list = Array.from(draftState.list);\r\n                list.push(action.track)\r\n                draftState.list = list;\r\n                set(draftState, state.currentPlaylist, Array.from(draftState.list));\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_BPM_AND_OFFSET: {\r\n            let { id, playlist, bpm, offset } = action;\r\n          //  console.log(\"Set bpm and offset\", id, playlist, bpm, offset);\r\n            let isCurrent = false;\r\n            if (playlist === undefined || playlist.length === 0) {\r\n                isCurrent = true;\r\n                playlist = state.currentPlaylist;\r\n            }\r\n            let list = get(state, playlist)\r\n            if(!list){\r\n                return state;\r\n            }\r\n            list = Array.from(list);\r\n            const index = list.findIndex(element => element.id === id);\r\n            if (index === -1) {\r\n                return state;\r\n            }\r\n            list[index].bpm = bpm;\r\n            if (offset) {\r\n                list[index].offset = offset;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, playlist, list);\r\n                if (isCurrent) {\r\n                    draftState.list = list;\r\n                }\r\n                draftState.refreshFalg = Math.random();\r\n            })\r\n        }\r\n        case ACTIONS.PL_TOGGLE_DIR: {\r\n            const open = get(state, [...action.path, \"_open\"])\r\n            return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open))\r\n        }\r\n\r\n        case ACTIONS.PL_SET_SELECTION: {\r\n            return produce(state, draftState => draftState.currentSelection = action.path)\r\n        }\r\n\r\n\r\n\r\n        case ACTIONS.PL_SET_CURRENT_PLAYLIST: {\r\n            return produce(state, draftState => {\r\n                draftState.currentPlayList = action.path;\r\n                draftState.list = Array.from(get(state, [action.path]));\r\n            })\r\n        }\r\n\r\n        //done\r\n        case ACTIONS.PL_RENAME_SELECTED: {\r\n            const content = get(state, state.currentSelection);\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                const newCurrent = draftState.currentSelection;\r\n                newCurrent.pop();\r\n                newCurrent.push(action.name);\r\n                draftState.currentSelection = newCurrent;\r\n                set(draftState, newCurrent, content);\r\n                draftState.renameMode = false;\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_SELECTED: {\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                draftState.currentSelection = ['root'];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_MOVE_TO: {\r\n            const { pathFrom, pathTo } = action;\r\n            const content = get(state, pathFrom);\r\n            const name = pathFrom.pop();\r\n            //if target and source are the same don't do anything\r\n            if (pathFrom.length === pathTo.length &&\r\n                pathFrom.every((e, i) => e === pathTo[i])) {\r\n                return state;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathTo, name], content);\r\n                unset(draftState, [...pathFrom, name]);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_TRACK: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                newList.splice(action.index, 1);\r\n                draftState.list = newList\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SWAP_TRACK_ON_CURRENT: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                let trackFrom = newList[action.from];\r\n                newList[action.from] = newList[action.to];\r\n                newList[action.to] = trackFrom;\r\n                draftState.list = newList;\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_ADD_TRACK_TO_LIST: {\r\n            const list = get(state, action.path);\r\n            if (!list) return state;\r\n            return produce(state, draftState => {\r\n                list.push(action.track);\r\n                set(draftState, action.fullPath, list);\r\n            })\r\n        }\r\n\r\n\r\n        //done\r\n        case ACTIONS.PL_CREATE_DIR: {\r\n            const { id, name, renameMode } = action;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], { _id: id });\r\n                set(draftState, [...pathToDir, \"_open\"], true);\r\n                draftState.currentSelection = [...pathToDir, name];\r\n                if(renameMode){\r\n                    draftState.renameMode = renameMode;\r\n                }\r\n            })\r\n        }\r\n\r\n        //done\r\n        case ACTIONS.PL_CREATE_PLAYLIST: {\r\n            const {name, id , renameMode, setCurrent} = action;\r\n            console.log(\"creating playlist reducer\", name, id, renameMode);\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            // const next = produce(state, draftState => {\r\n            //     const newPlaylist = [];\r\n            //     newPlaylist._id = id;\r\n            //     set(draftState, [...pathToDir, name], newPlaylist)\r\n            //     set(draftState, [...pathToDir, \"_open\"], true);\r\n            //     draftState.currentSelection = [...pathToDir, name];\r\n            //     if(setCurrent){\r\n            //         draftState.currentPlaylist = [...pathToDir, name];\r\n            //     }\r\n            //     if(renameMode){\r\n            //         draftState.renameMode = renameMode;\r\n            //     }\r\n            // })\r\n\r\n            let nextState =  {...state};\r\n            const newPlaylist = [];\r\n            newPlaylist._id = id;\r\n            set(nextState, [...pathToDir, name], newPlaylist)\r\n            set(nextState, [...pathToDir, \"_open\"], true);\r\n            nextState.currentSelection = [...pathToDir, name];\r\n            if(setCurrent){\r\n                nextState.currentPlaylist = [...pathToDir, name];\r\n            }\r\n            if(renameMode){\r\n                nextStaterenameMode = renameMode;\r\n            }\r\n\r\n            return nextState;\r\n        }\r\n\r\n        case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST: {\r\n            return produce(state, draftState => {\r\n                draftState.list = get(state, state.currentSelection);\r\n                draftState.currentPlaylist = state.currentSelection;\r\n            })\r\n        }\r\n\r\n\r\n        default: return state;\r\n    }\r\n}\r\n\r\nexport default playListReducer;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}