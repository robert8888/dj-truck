{"ast":null,"code":"import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect,useCallback}from\"react\";import{formater}from\"./../../../../../utils/time/timeFromater\";import{toRange}from\"./../../../../../utils/math/argRanges\";import useWindowSize from\"./../../../Hooks/useWindowSize\";import\"./progress-slider.scss\";//horizontal\nvar ProgressSlider=function ProgressSlider(_ref){var player=_ref.player,seek=_ref.seek;var _useState=useState(0),_useState2=_slicedToArray(_useState,2),progress=_useState2[0],setProgress=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),buffered=_useState4[0],setBuffred=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),currentRecord=_useState6[0],setCurrentRecord=_useState6[1];var _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),currentTime=_useState8[0],setCurrentTime=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),currentDuration=_useState10[0],setCurrentDuration=_useState10[1];var isDragged=useRef();var seekTarget=useRef();var progressRef=useRef();var durationRef=useRef();var sliderArea=useRef(null);var sliderThumb=useRef(null);var sliderProgress=useRef(null);var sliderBufferd=useRef(null);var sliderTimePreview=useRef(null);var sliderAreaRectCached=useRef();var thumbAreaRectCached=useRef();var _useWindowSize=useWindowSize(),_useWindowSize2=_slicedToArray(_useWindowSize,1),windowWidth=_useWindowSize2[0];var getSliderAreaRect=useCallback(function(){if(!sliderAreaRectCached.current){sliderAreaRectCached.current=sliderArea.current.getBoundingClientRect();}return sliderAreaRectCached.current;},[sliderArea,sliderAreaRectCached]);var getThumbAreaRect=useCallback(function(){if(!thumbAreaRectCached.current){thumbAreaRectCached.current=sliderThumb.current.getBoundingClientRect();}return thumbAreaRectCached.current;},[sliderThumb,thumbAreaRectCached]);var refrehsRects=useCallback(function(){sliderAreaRectCached.current=null;thumbAreaRectCached.current=null;},[sliderAreaRectCached,thumbAreaRectCached]);var setThumbPosition=useCallback(function(progress){var position=0;var sliderAreaRect=getSliderAreaRect();var thumbRect=getThumbAreaRect();position=sliderAreaRect.width*progress;sliderProgress.current.style.transform=\"scaleX(\".concat(position,\") translateX(50%)\");position-=thumbRect.width/2;sliderThumb.current.style.transform=\"translateX(\".concat(position,\"px)\");},[sliderArea,sliderThumb]);var setBuffredPosition=useCallback(function(buffered){var sliderAreaRect=getSliderAreaRect();if(!sliderAreaRect){return;}var position=sliderAreaRect.width*buffered;sliderBufferd.current.style.transform=\"scaleX(\".concat(position,\") translateX(50%)\");},[sliderBufferd,sliderArea]);useEffect(function(){setBuffredPosition(buffered);},[buffered,setBuffredPosition]);useEffect(function(){setCurrentTime(currentDuration*progress);setThumbPosition(progress);},[progress,currentDuration,setCurrentTime,setThumbPosition]);var refreshBuffered=useCallback(function(){return setBuffredPosition(buffered);},[buffered,setBuffredPosition]);var refreshProgress=useCallback(function(){return setThumbPosition(progress);},[progress,setThumbPosition]);useEffect(function(){refreshBuffered();refreshProgress();},[windowWidth,refreshBuffered,refreshProgress]);var setProgressHandler=useCallback(function(progress){if(!isDragged.current){setProgress(progress);progressRef.current=progress;}},[isDragged,progressRef]);var getProgress=useCallback(function(){return{progress:progressRef.current,duration:durationRef.current};},[progressRef,durationRef]);useEffect(function(){if(currentRecord){setCurrentDuration(currentRecord.duration);durationRef.current=currentRecord.duration;}},[currentRecord,setCurrentDuration,durationRef]);useEffect(function(){if(!player){return;}player.subscribeProgress('#',setProgressHandler);player.subscribeCurrent(setCurrentRecord);player.subscribeBuffred(setBuffred);player.addProgressProvider(\"#\",getProgress);setCurrentRecord(player.getCurrent());return function(){console.log(\"unmouting slider\");player.unSubscribeProgress('#',setProgressHandler);player.unSubscribeCurrent(setCurrentRecord);player.unSubscribeBuffered(setBuffred);player.removeProgressProvider(\"#\",getProgress);};},[player,setProgressHandler,getProgress]);var thumbDraging=useCallback(function(areaRect,e){var x=e.clientX-areaRect.left;var progress=x/areaRect.width;progress=toRange(progress,0,1);seekTarget.current=progress;setProgress(progress);},[]);var thumbMouseDown=useCallback(function(e){if(currentDuration===0){return;}var sliderAreaRect=getSliderAreaRect();var thumbDragingWithArgs=thumbDraging.bind(null,sliderAreaRect);isDragged.current=true;var mouseup=function mouseup(){window.removeEventListener('mouseup',mouseup);window.removeEventListener('mousemove',thumbDragingWithArgs);isDragged.current=false;seek({progress:seekTarget.current});seekTarget.current=null;};window.addEventListener('mousemove',thumbDragingWithArgs);window.addEventListener('mouseup',mouseup);},[thumbDraging,sliderArea,isDragged,seek,seekTarget,currentDuration]);var areaMouseDown=useCallback(function(e){var sliderAreaRect=getSliderAreaRect();var thumbRect=getThumbAreaRect();if(e.target===sliderThumb.current){return;}var x=e.clientX-sliderAreaRect.left+thumbRect.width/2;var progress=x/sliderAreaRect.width;progress=toRange(progress,0,1);seek({progress:progress});},[seek,sliderArea]);var areaMouseMove=useCallback(function(e){var sliderAreaRect=getSliderAreaRect();var thumbRect=getThumbAreaRect();var x=e.clientX-sliderAreaRect.left+thumbRect.width/2;var progress=x/sliderAreaRect.width;progress=toRange(progress,0,1);var time=currentDuration*progress;var str=formater.secondsToStr(time/1000);sliderTimePreview.current.dataset.value=time?str:\"\";sliderTimePreview.current.style.transform=\"translateX(\".concat(x,\"px)\");},[currentDuration,sliderTimePreview]);var areaMouseEnter=useCallback(function(e){sliderTimePreview.current.classList.add(\"preview--visible\");},[sliderTimePreview]);var areaMouseLeave=useCallback(function(e){sliderTimePreview.current.classList.remove(\"preview--visible\");},[sliderTimePreview]);return React.createElement(\"div\",{className:\"seek-slider\"},React.createElement(\"div\",{className:\"slider-time time-current\"},React.createElement(\"span\",null,formater.secondsToStr(currentTime/1000))),React.createElement(\"div\",{className:\"slider-active-area\",ref:sliderArea,onMouseDown:areaMouseDown,onMouseEnter:areaMouseEnter,onMouseLeave:areaMouseLeave,onMouseMove:areaMouseMove,draggable:\"false\"},React.createElement(\"div\",{className:\"slider-buffered\",ref:sliderBufferd,draggable:\"false\"}),React.createElement(\"div\",{className:\"slider-progress\",ref:sliderProgress,draggable:\"false\"}),React.createElement(\"div\",{className:\"slider-thumb\",ref:sliderThumb,onMouseDown:thumbMouseDown,draggable:\"false\"}),React.createElement(\"div\",{className:\"slider-time-preview\",ref:sliderTimePreview,\"data-value\":\"\"})),React.createElement(\"div\",{className:\"slider-time time-duration\"},React.createElement(\"span\",null,formater.secondsToStr(currentDuration/1000))));};export default ProgressSlider;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/PlayerControls/ProgressSlider/ProgressSlider.js"],"names":["React","useState","useRef","useEffect","useCallback","formater","toRange","useWindowSize","ProgressSlider","player","seek","progress","setProgress","buffered","setBuffred","currentRecord","setCurrentRecord","currentTime","setCurrentTime","currentDuration","setCurrentDuration","isDragged","seekTarget","progressRef","durationRef","sliderArea","sliderThumb","sliderProgress","sliderBufferd","sliderTimePreview","sliderAreaRectCached","thumbAreaRectCached","windowWidth","getSliderAreaRect","current","getBoundingClientRect","getThumbAreaRect","refrehsRects","setThumbPosition","position","sliderAreaRect","thumbRect","width","style","transform","setBuffredPosition","refreshBuffered","refreshProgress","setProgressHandler","getProgress","duration","subscribeProgress","subscribeCurrent","subscribeBuffred","addProgressProvider","getCurrent","console","log","unSubscribeProgress","unSubscribeCurrent","unSubscribeBuffered","removeProgressProvider","thumbDraging","areaRect","e","x","clientX","left","thumbMouseDown","thumbDragingWithArgs","bind","mouseup","window","removeEventListener","addEventListener","areaMouseDown","target","areaMouseMove","time","str","secondsToStr","dataset","value","areaMouseEnter","classList","add","areaMouseLeave","remove"],"mappings":"kHAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,MAA1B,CAAkCC,SAAlC,CAA6CC,WAA7C,KAAgE,OAAhE,CACA,OAAQC,QAAR,KAAuB,0CAAvB,CACA,OAAQC,OAAR,KAAsB,uCAAtB,CACA,MAAOC,CAAAA,aAAP,KAA0B,gCAA1B,CACA,MAAO,wBAAP,CAEA;AACA,GAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,MAAqB,IAAlBC,CAAAA,MAAkB,MAAlBA,MAAkB,CAAVC,IAAU,MAAVA,IAAU,eACRT,QAAQ,CAAC,CAAD,CADA,wCACjCU,QADiC,eACvBC,WADuB,8BAETX,QAAQ,CAAC,CAAD,CAFC,yCAEjCY,QAFiC,eAEvBC,UAFuB,8BAGEb,QAAQ,CAAC,IAAD,CAHV,yCAGjCc,aAHiC,eAGlBC,gBAHkB,8BAIFf,QAAQ,CAAC,CAAD,CAJN,yCAIjCgB,WAJiC,eAIpBC,cAJoB,8BAKMjB,QAAQ,CAAC,CAAD,CALd,0CAKjCkB,eALiC,gBAKhBC,kBALgB,gBAMxC,GAAMC,CAAAA,SAAS,CAAGnB,MAAM,EAAxB,CACA,GAAMoB,CAAAA,UAAU,CAAGpB,MAAM,EAAzB,CACA,GAAMqB,CAAAA,WAAW,CAAGrB,MAAM,EAA1B,CACA,GAAMsB,CAAAA,WAAW,CAAGtB,MAAM,EAA1B,CAEA,GAAMuB,CAAAA,UAAU,CAAGvB,MAAM,CAAC,IAAD,CAAzB,CACA,GAAMwB,CAAAA,WAAW,CAAGxB,MAAM,CAAC,IAAD,CAA1B,CACA,GAAMyB,CAAAA,cAAc,CAAGzB,MAAM,CAAC,IAAD,CAA7B,CACA,GAAM0B,CAAAA,aAAa,CAAG1B,MAAM,CAAC,IAAD,CAA5B,CACA,GAAM2B,CAAAA,iBAAiB,CAAG3B,MAAM,CAAC,IAAD,CAAhC,CAEA,GAAM4B,CAAAA,oBAAoB,CAAG5B,MAAM,EAAnC,CACA,GAAM6B,CAAAA,mBAAmB,CAAG7B,MAAM,EAAlC,CAlBwC,mBAoBfK,aAAa,EApBE,kDAoBhCyB,WApBgC,oBAsBxC,GAAMC,CAAAA,iBAAiB,CAAG7B,WAAW,CAAC,UAAI,CACtC,GAAG,CAAC0B,oBAAoB,CAACI,OAAzB,CAAiC,CAC7BJ,oBAAoB,CAACI,OAArB,CAA+BT,UAAU,CAACS,OAAX,CAAmBC,qBAAnB,EAA/B,CACH,CACD,MAAOL,CAAAA,oBAAoB,CAACI,OAA5B,CACH,CALoC,CAKlC,CAACT,UAAD,CAAaK,oBAAb,CALkC,CAArC,CAOA,GAAMM,CAAAA,gBAAgB,CAAGhC,WAAW,CAAC,UAAI,CACrC,GAAG,CAAC2B,mBAAmB,CAACG,OAAxB,CAAgC,CAC5BH,mBAAmB,CAACG,OAApB,CAA8BR,WAAW,CAACQ,OAAZ,CAAoBC,qBAApB,EAA9B,CACH,CACD,MAAOJ,CAAAA,mBAAmB,CAACG,OAA3B,CACH,CALmC,CAKjC,CAACR,WAAD,CAAcK,mBAAd,CALiC,CAApC,CAOA,GAAMM,CAAAA,YAAY,CAAGjC,WAAW,CAAC,UAAI,CACjC0B,oBAAoB,CAACI,OAArB,CAA+B,IAA/B,CACAH,mBAAmB,CAACG,OAApB,CAA8B,IAA9B,CACH,CAH+B,CAG9B,CAAEJ,oBAAF,CAAwBC,mBAAxB,CAH8B,CAAhC,CAKA,GAAMO,CAAAA,gBAAgB,CAAGlC,WAAW,CAAC,SAACO,QAAD,CAAY,CAC7C,GAAI4B,CAAAA,QAAQ,CAAG,CAAf,CACA,GAAMC,CAAAA,cAAc,CAAGP,iBAAiB,EAAxC,CACA,GAAMQ,CAAAA,SAAS,CAAGL,gBAAgB,EAAlC,CACAG,QAAQ,CAAGC,cAAc,CAACE,KAAf,CAAuB/B,QAAlC,CACAgB,cAAc,CAACO,OAAf,CAAuBS,KAAvB,CAA6BC,SAA7B,kBAAmDL,QAAnD,sBACAA,QAAQ,EAAKE,SAAS,CAACC,KAAV,CAAkB,CAA/B,CACAhB,WAAW,CAACQ,OAAZ,CAAoBS,KAApB,CAA0BC,SAA1B,sBAAoDL,QAApD,QACH,CARmC,CAQjC,CAACd,UAAD,CAAaC,WAAb,CARiC,CAApC,CAUA,GAAMmB,CAAAA,kBAAkB,CAAGzC,WAAW,CAAC,SAACS,QAAD,CAAc,CACjD,GAAM2B,CAAAA,cAAc,CAAGP,iBAAiB,EAAxC,CACA,GAAG,CAACO,cAAJ,CAAmB,CACf,OACH,CACD,GAAMD,CAAAA,QAAQ,CAAGC,cAAc,CAACE,KAAf,CAAuB7B,QAAxC,CACAe,aAAa,CAACM,OAAd,CAAsBS,KAAtB,CAA4BC,SAA5B,kBAAkDL,QAAlD,sBACH,CAPqC,CAOnC,CAACX,aAAD,CAAgBH,UAAhB,CAPmC,CAAtC,CASAtB,SAAS,CAAC,UAAI,CACV0C,kBAAkB,CAAChC,QAAD,CAAlB,CACH,CAFQ,CAEN,CAACA,QAAD,CAAWgC,kBAAX,CAFM,CAAT,CAIA1C,SAAS,CAAC,UAAI,CACVe,cAAc,CAACC,eAAe,CAAGR,QAAnB,CAAd,CACA2B,gBAAgB,CAAC3B,QAAD,CAAhB,CACF,CAHO,CAGL,CAACA,QAAD,CAAWQ,eAAX,CAA4BD,cAA5B,CAA4CoB,gBAA5C,CAHK,CAAT,CAKA,GAAMQ,CAAAA,eAAe,CAAG1C,WAAW,CAC3B,iBAAMyC,CAAAA,kBAAkB,CAAChC,QAAD,CAAxB,EAD2B,CAE3B,CAACA,QAAD,CAAWgC,kBAAX,CAF2B,CAAnC,CAIA,GAAME,CAAAA,eAAe,CAAG3C,WAAW,CAC3B,iBAAMkC,CAAAA,gBAAgB,CAAC3B,QAAD,CAAtB,EAD2B,CAE3B,CAACA,QAAD,CAAW2B,gBAAX,CAF2B,CAAnC,CAKAnC,SAAS,CAAC,UAAI,CACV2C,eAAe,GACfC,eAAe,GAClB,CAHQ,CAGP,CAACf,WAAD,CAAcc,eAAd,CAA+BC,eAA/B,CAHO,CAAT,CAMA,GAAMC,CAAAA,kBAAkB,CAAG5C,WAAW,CAAC,SAACO,QAAD,CAAY,CAC/C,GAAG,CAACU,SAAS,CAACa,OAAd,CAAsB,CAClBtB,WAAW,CAACD,QAAD,CAAX,CACAY,WAAW,CAACW,OAAZ,CAAsBvB,QAAtB,CACH,CACJ,CALqC,CAKnC,CAACU,SAAD,CAAYE,WAAZ,CALmC,CAAtC,CAOA,GAAM0B,CAAAA,WAAW,CAAG7C,WAAW,CAAC,UAAI,CAChC,MAAO,CACHO,QAAQ,CAAEY,WAAW,CAACW,OADnB,CAEHgB,QAAQ,CAAE1B,WAAW,CAACU,OAFnB,CAAP,CAIH,CAL8B,CAK5B,CAACX,WAAD,CAAcC,WAAd,CAL4B,CAA/B,CAOArB,SAAS,CAAC,UAAI,CACV,GAAGY,aAAH,CAAiB,CACdK,kBAAkB,CAACL,aAAa,CAACmC,QAAf,CAAlB,CACA1B,WAAW,CAACU,OAAZ,CAAsBnB,aAAa,CAACmC,QAApC,CACF,CACJ,CALQ,CAKN,CAACnC,aAAD,CAAgBK,kBAAhB,CAAoCI,WAApC,CALM,CAAT,CAOArB,SAAS,CAAC,UAAI,CACV,GAAG,CAACM,MAAJ,CAAW,CACP,OACH,CAEDA,MAAM,CAAC0C,iBAAP,CAAyB,GAAzB,CAA8BH,kBAA9B,EACAvC,MAAM,CAAC2C,gBAAP,CAAwBpC,gBAAxB,EACAP,MAAM,CAAC4C,gBAAP,CAAwBvC,UAAxB,EACAL,MAAM,CAAC6C,mBAAP,CAA2B,GAA3B,CAAgCL,WAAhC,EACAjC,gBAAgB,CAACP,MAAM,CAAC8C,UAAP,EAAD,CAAhB,CACA,MAAO,WAAM,CACTC,OAAO,CAACC,GAAR,CAAY,kBAAZ,EACAhD,MAAM,CAACiD,mBAAP,CAA2B,GAA3B,CAAgCV,kBAAhC,EACAvC,MAAM,CAACkD,kBAAP,CAA0B3C,gBAA1B,EACAP,MAAM,CAACmD,mBAAP,CAA2B9C,UAA3B,EACAL,MAAM,CAACoD,sBAAP,CAA8B,GAA9B,CAAmCZ,WAAnC,EACH,CAND,CAOH,CAjBQ,CAiBN,CAACxC,MAAD,CAASuC,kBAAT,CAA6BC,WAA7B,CAjBM,CAAT,CAmBA,GAAMa,CAAAA,YAAY,CAAG1D,WAAW,CAAE,SAAC2D,QAAD,CAAWC,CAAX,CAAiB,CAChD,GAAMC,CAAAA,CAAC,CAAGD,CAAC,CAACE,OAAF,CAAYH,QAAQ,CAACI,IAA/B,CACA,GAAIxD,CAAAA,QAAQ,CAAGsD,CAAC,CAAGF,QAAQ,CAACrB,KAA5B,CACA/B,QAAQ,CAAGL,OAAO,CAACK,QAAD,CAAW,CAAX,CAAc,CAAd,CAAlB,CACAW,UAAU,CAACY,OAAX,CAAqBvB,QAArB,CACAC,WAAW,CAACD,QAAD,CAAX,CACF,CAN+B,CAM7B,EAN6B,CAAhC,CAQA,GAAMyD,CAAAA,cAAc,CAAGhE,WAAW,CAAC,SAAC4D,CAAD,CAAK,CACpC,GAAG7C,eAAe,GAAK,CAAvB,CAAyB,CACrB,OACH,CACD,GAAMqB,CAAAA,cAAc,CAAGP,iBAAiB,EAAxC,CACA,GAAMoC,CAAAA,oBAAoB,CAAGP,YAAY,CAACQ,IAAb,CAAkB,IAAlB,CAAwB9B,cAAxB,CAA7B,CACAnB,SAAS,CAACa,OAAV,CAAoB,IAApB,CACA,GAAMqC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CAClBC,MAAM,CAACC,mBAAP,CAA2B,SAA3B,CAAsCF,OAAtC,EACAC,MAAM,CAACC,mBAAP,CAA2B,WAA3B,CAAwCJ,oBAAxC,EACAhD,SAAS,CAACa,OAAV,CAAoB,KAApB,CACAxB,IAAI,CAAC,CAACC,QAAQ,CAAGW,UAAU,CAACY,OAAvB,CAAD,CAAJ,CACAZ,UAAU,CAACY,OAAX,CAAqB,IAArB,CACH,CAND,CAOAsC,MAAM,CAACE,gBAAP,CAAwB,WAAxB,CAAqCL,oBAArC,EACAG,MAAM,CAACE,gBAAP,CAAwB,SAAxB,CAAmCH,OAAnC,EACH,CAhBiC,CAgB/B,CAACT,YAAD,CACCrC,UADD,CAECJ,SAFD,CAGCX,IAHD,CAICY,UAJD,CAKCH,eALD,CAhB+B,CAAlC,CAuBA,GAAMwD,CAAAA,aAAa,CAAGvE,WAAW,CAAC,SAAC4D,CAAD,CAAK,CACnC,GAAMxB,CAAAA,cAAc,CAAGP,iBAAiB,EAAxC,CACA,GAAMQ,CAAAA,SAAS,CAAGL,gBAAgB,EAAlC,CACA,GAAG4B,CAAC,CAACY,MAAF,GAAalD,WAAW,CAACQ,OAA5B,CAAoC,CAChC,OACH,CACD,GAAM+B,CAAAA,CAAC,CAAGD,CAAC,CAACE,OAAF,CAAY1B,cAAc,CAAC2B,IAA3B,CAAoC1B,SAAS,CAACC,KAAV,CAAkB,CAAhE,CACA,GAAI/B,CAAAA,QAAQ,CAAGsD,CAAC,CAAGzB,cAAc,CAACE,KAAlC,CACA/B,QAAQ,CAAGL,OAAO,CAACK,QAAD,CAAW,CAAX,CAAe,CAAf,CAAlB,CACAD,IAAI,CAAC,CAACC,QAAQ,CAARA,QAAD,CAAD,CAAJ,CACH,CAVgC,CAU9B,CAACD,IAAD,CAAOe,UAAP,CAV8B,CAAjC,CAYA,GAAMoD,CAAAA,aAAa,CAAGzE,WAAW,CAAE,SAAA4D,CAAC,CAAG,CACnC,GAAMxB,CAAAA,cAAc,CAAGP,iBAAiB,EAAxC,CACA,GAAMQ,CAAAA,SAAS,CAAGL,gBAAgB,EAAlC,CACA,GAAM6B,CAAAA,CAAC,CAAGD,CAAC,CAACE,OAAF,CAAY1B,cAAc,CAAC2B,IAA3B,CAAoC1B,SAAS,CAACC,KAAV,CAAkB,CAAhE,CACA,GAAI/B,CAAAA,QAAQ,CAAGsD,CAAC,CAAGzB,cAAc,CAACE,KAAlC,CACA/B,QAAQ,CAAGL,OAAO,CAACK,QAAD,CAAW,CAAX,CAAe,CAAf,CAAlB,CACA,GAAMmE,CAAAA,IAAI,CAAG3D,eAAe,CAAGR,QAA/B,CACA,GAAMoE,CAAAA,GAAG,CAAG1E,QAAQ,CAAC2E,YAAT,CAAsBF,IAAI,CAAG,IAA7B,CAAZ,CACAjD,iBAAiB,CAACK,OAAlB,CAA0B+C,OAA1B,CAAkCC,KAAlC,CAA0CJ,IAAI,CAAGC,GAAH,CAAS,EAAvD,CACAlD,iBAAiB,CAACK,OAAlB,CAA0BS,KAA1B,CAAgCC,SAAhC,sBAA0DqB,CAA1D,QACH,CAVgC,CAU9B,CAAC9C,eAAD,CAAmBU,iBAAnB,CAV8B,CAAjC,CAYA,GAAMsD,CAAAA,cAAc,CAAG/E,WAAW,CAAE,SAAA4D,CAAC,CAAI,CACrCnC,iBAAiB,CAACK,OAAlB,CAA0BkD,SAA1B,CAAoCC,GAApC,CAAwC,kBAAxC,EACH,CAFiC,CAE/B,CAACxD,iBAAD,CAF+B,CAAlC,CAIA,GAAMyD,CAAAA,cAAc,CAAGlF,WAAW,CAAE,SAAA4D,CAAC,CAAI,CACrCnC,iBAAiB,CAACK,OAAlB,CAA0BkD,SAA1B,CAAoCG,MAApC,CAA2C,kBAA3C,EACH,CAFiC,CAE/B,CAAC1D,iBAAD,CAF+B,CAAlC,CAKA,MACI,4BAAK,SAAS,CAAC,aAAf,EACI,2BAAK,SAAS,CAAC,0BAAf,EACK,gCAAOxB,QAAQ,CAAC2E,YAAT,CAAsB/D,WAAW,CAAG,IAApC,CAAP,CADL,CADJ,CAII,2BAAK,SAAS,CAAC,oBAAf,CACK,GAAG,CAAEQ,UADV,CAEK,WAAW,CAAEkD,aAFlB,CAGK,YAAY,CAAEQ,cAHnB,CAIK,YAAY,CAAEG,cAJnB,CAKK,WAAW,CAAET,aALlB,CAMK,SAAS,CAAC,OANf,EAOQ,2BAAK,SAAS,CAAC,iBAAf,CACK,GAAG,CAAEjD,aADV,CAEK,SAAS,CAAC,OAFf,EAPR,CAUQ,2BAAK,SAAS,CAAC,iBAAf,CACK,GAAG,CAAED,cADV,CAEK,SAAS,CAAC,OAFf,EAVR,CAcQ,2BAAK,SAAS,CAAC,cAAf,CACK,GAAG,CAAED,WADV,CAEK,WAAW,CAAE0C,cAFlB,CAGK,SAAS,CAAC,OAHf,EAdR,CAkBQ,2BAAK,SAAS,CAAC,qBAAf,CACK,GAAG,CAAEvC,iBADV,CAEK,aAAW,EAFhB,EAlBR,CAJJ,CA0BI,2BAAK,SAAS,CAAC,2BAAf,EACI,gCAAOxB,QAAQ,CAAC2E,YAAT,CAAsB7D,eAAe,CAAC,IAAtC,CAAP,CADJ,CA1BJ,CADJ,CAiCH,CA7ND,CA+NA,cAAeX,CAAAA,cAAf","sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport {formater} from \"./../../../../../utils/time/timeFromater\";\r\nimport {toRange} from \"./../../../../../utils/math/argRanges\";\r\nimport useWindowSize from \"./../../../Hooks/useWindowSize\"\r\nimport \"./progress-slider.scss\"\r\n\r\n//horizontal\r\nconst ProgressSlider = ({ player, seek}) => {\r\n    const [progress, setProgress] = useState(0);\r\n    const [buffered, setBuffred] = useState(0);\r\n    const [currentRecord, setCurrentRecord] = useState(null);\r\n    const [currentTime, setCurrentTime] = useState(0);\r\n    const [currentDuration, setCurrentDuration] = useState(0);\r\n    const isDragged = useRef();\r\n    const seekTarget = useRef();\r\n    const progressRef = useRef();\r\n    const durationRef = useRef();\r\n\r\n    const sliderArea = useRef(null);\r\n    const sliderThumb = useRef(null);\r\n    const sliderProgress = useRef(null);\r\n    const sliderBufferd = useRef(null);\r\n    const sliderTimePreview = useRef(null);\r\n\r\n    const sliderAreaRectCached = useRef();\r\n    const thumbAreaRectCached = useRef();\r\n\r\n    const [ windowWidth, ] = useWindowSize();\r\n\r\n    const getSliderAreaRect = useCallback(()=>{\r\n        if(!sliderAreaRectCached.current){\r\n            sliderAreaRectCached.current = sliderArea.current.getBoundingClientRect();\r\n        }\r\n        return sliderAreaRectCached.current;\r\n    }, [sliderArea, sliderAreaRectCached])\r\n\r\n    const getThumbAreaRect = useCallback(()=>{\r\n        if(!thumbAreaRectCached.current){\r\n            thumbAreaRectCached.current = sliderThumb.current.getBoundingClientRect();\r\n        }\r\n        return thumbAreaRectCached.current;\r\n    }, [sliderThumb, thumbAreaRectCached])\r\n\r\n    const refrehsRects = useCallback(()=>{\r\n        sliderAreaRectCached.current = null;\r\n        thumbAreaRectCached.current = null;\r\n    },[ sliderAreaRectCached, thumbAreaRectCached])\r\n\r\n    const setThumbPosition = useCallback((progress)=>{\r\n        let position = 0;\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        position = sliderAreaRect.width * progress ;\r\n        sliderProgress.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n        position -= (thumbRect.width / 2) ;  \r\n        sliderThumb.current.style.transform = `translateX(${position}px)`;\r\n    }, [sliderArea, sliderThumb])\r\n\r\n    const setBuffredPosition = useCallback((buffered) => {\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        if(!sliderAreaRect){\r\n            return;\r\n        }\r\n        const position = sliderAreaRect.width * buffered;\r\n        sliderBufferd.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n    }, [sliderBufferd, sliderArea])\r\n\r\n    useEffect(()=>{\r\n        setBuffredPosition(buffered)\r\n    }, [buffered, setBuffredPosition])\r\n\r\n    useEffect(()=>{\r\n        setCurrentTime(currentDuration * progress);\r\n        setThumbPosition(progress);\r\n     }, [progress, currentDuration, setCurrentTime, setThumbPosition])\r\n\r\n    const refreshBuffered = useCallback(\r\n            () => setBuffredPosition(buffered), \r\n            [buffered, setBuffredPosition]\r\n        );\r\n    const refreshProgress = useCallback(\r\n            () => setThumbPosition(progress), \r\n            [progress, setThumbPosition]\r\n        )\r\n\r\n    useEffect(()=>{\r\n        refreshBuffered();\r\n        refreshProgress();\r\n    },[windowWidth, refreshBuffered, refreshProgress])\r\n\r\n\r\n    const setProgressHandler = useCallback((progress)=>{\r\n        if(!isDragged.current){\r\n            setProgress(progress);\r\n            progressRef.current = progress\r\n        }\r\n    }, [isDragged, progressRef])\r\n\r\n    const getProgress = useCallback(()=>{\r\n        return {\r\n            progress: progressRef.current,\r\n            duration: durationRef.current,\r\n        };\r\n    }, [progressRef, durationRef])\r\n\r\n    useEffect(()=>{\r\n        if(currentRecord){\r\n           setCurrentDuration(currentRecord.duration);\r\n           durationRef.current = currentRecord.duration;\r\n        }\r\n    }, [currentRecord, setCurrentDuration, durationRef])\r\n\r\n    useEffect(()=>{\r\n        if(!player){\r\n            return;\r\n        }\r\n\r\n        player.subscribeProgress('#', setProgressHandler);\r\n        player.subscribeCurrent(setCurrentRecord);\r\n        player.subscribeBuffred(setBuffred);\r\n        player.addProgressProvider(\"#\", getProgress)\r\n        setCurrentRecord(player.getCurrent());\r\n        return () => {\r\n            console.log(\"unmouting slider\")\r\n            player.unSubscribeProgress('#', setProgressHandler);\r\n            player.unSubscribeCurrent(setCurrentRecord);\r\n            player.unSubscribeBuffered(setBuffred);\r\n            player.removeProgressProvider(\"#\", getProgress)\r\n        }\r\n    }, [player, setProgressHandler, getProgress])\r\n\r\n    const thumbDraging = useCallback( (areaRect, e) => {\r\n       const x = e.clientX - areaRect.left;\r\n       let progress = x / areaRect.width;\r\n       progress = toRange(progress, 0 ,1);\r\n       seekTarget.current = progress;\r\n       setProgress(progress)\r\n    }, [])\r\n\r\n    const thumbMouseDown = useCallback((e)=>{\r\n        if(currentDuration === 0){\r\n            return;\r\n        }\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbDragingWithArgs = thumbDraging.bind(null, sliderAreaRect)\r\n        isDragged.current = true;\r\n        const mouseup = () => {\r\n            window.removeEventListener('mouseup', mouseup);\r\n            window.removeEventListener('mousemove', thumbDragingWithArgs);\r\n            isDragged.current = false;\r\n            seek({progress : seekTarget.current});\r\n            seekTarget.current = null;\r\n        }\r\n        window.addEventListener('mousemove', thumbDragingWithArgs)\r\n        window.addEventListener('mouseup', mouseup)\r\n    }, [thumbDraging, \r\n        sliderArea, \r\n        isDragged,\r\n        seek, \r\n        seekTarget, \r\n        currentDuration])\r\n\r\n    const areaMouseDown = useCallback((e)=>{\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        if(e.target === sliderThumb.current){\r\n            return;\r\n        }\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width  ;\r\n        progress = toRange(progress, 0 , 1)\r\n        seek({progress})\r\n    }, [seek, sliderArea])\r\n\r\n    const areaMouseMove = useCallback( e =>{\r\n        const sliderAreaRect = getSliderAreaRect();\r\n        const thumbRect = getThumbAreaRect();\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width;\r\n        progress = toRange(progress, 0 , 1)\r\n        const time = currentDuration * progress;\r\n        const str = formater.secondsToStr(time / 1000);\r\n        sliderTimePreview.current.dataset.value = time ? str : \"\";\r\n        sliderTimePreview.current.style.transform = `translateX(${x}px)`\r\n    }, [currentDuration , sliderTimePreview])\r\n\r\n    const areaMouseEnter = useCallback( e => {\r\n        sliderTimePreview.current.classList.add(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n    const areaMouseLeave = useCallback( e => {\r\n        sliderTimePreview.current.classList.remove(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n\r\n    return (\r\n        <div className=\"seek-slider\">\r\n            <div className=\"slider-time time-current\">\r\n                 <span>{formater.secondsToStr(currentTime / 1000)}</span>\r\n            </div>\r\n            <div className=\"slider-active-area\" \r\n                 ref={sliderArea}\r\n                 onMouseDown={areaMouseDown}\r\n                 onMouseEnter={areaMouseEnter}\r\n                 onMouseLeave={areaMouseLeave} \r\n                 onMouseMove={areaMouseMove}\r\n                 draggable=\"false\">\r\n                    <div className=\"slider-buffered\" \r\n                         ref={sliderBufferd} \r\n                         draggable=\"false\"/>\r\n                    <div className=\"slider-progress\" \r\n                         ref={sliderProgress} \r\n                         draggable=\"false\"/>\r\n                    \r\n                    <div className=\"slider-thumb\" \r\n                         ref={sliderThumb} \r\n                         onMouseDown={thumbMouseDown} \r\n                         draggable=\"false\"/>\r\n                    <div className=\"slider-time-preview\"  \r\n                         ref={sliderTimePreview} \r\n                         data-value=\"\"/>\r\n            </div>\r\n            <div className=\"slider-time time-duration\">\r\n                <span>{formater.secondsToStr(currentDuration/1000)}</span>\r\n            </div>\r\n        </div>\r\n    \r\n    )\r\n}\r\n\r\nexport default ProgressSlider;\r\n\r\n"]},"metadata":{},"sourceType":"module"}