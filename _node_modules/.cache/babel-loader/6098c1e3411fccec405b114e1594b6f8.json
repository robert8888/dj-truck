{"ast":null,"code":"import { ACTIONS } from \"./../actions/actions.js\";\nimport { produce } from \"imer\";\nconst deck = {\n  track: {\n    title: \"\",\n    bpm: 0,\n    quality: \"\",\n    duration: \"\",\n    source: \"\",\n    id: \"\",\n    thumbnail: {}\n  },\n  // \n  playBackState: {\n    ready: false,\n    paused: true,\n    cuePoint: 0,\n    cueActive: false,\n    pitch: 0,\n    timeLeft: null\n  }\n};\nconst channel = {\n  volume: 100,\n  low: 100,\n  mid: 100,\n  high: 100,\n  gain: 100\n};\nconst initState = {\n  channel: {\n    A: { ...deck\n    },\n    B: { ...deck\n    }\n  },\n  mikser: {\n    channelA: { ...channel\n    },\n    channelB: { ...channel\n    },\n    fader: {\n      position: 50 //A: 0 <-> B:100\n\n    }\n  }\n};\n\nfunction consoleReducer(state = initState, action) {\n  switch (action.type) {\n    case ACTIONS.LOAD_TRACK:\n      {\n        const nextTrack = action.track;\n        return produce(state, draftState => {\n          draftState.channel[action.destination].track = {\n            title: nextTrack.title,\n            bpm: nextTrack.bpm || 0,\n            quality: nextTrack.quality,\n            duration: nextTrack.duration,\n            source: nextTrack.source,\n            id: nextTrack.id,\n            thumbnail: nextTrack.thumbnail\n          };\n        });\n      }\n\n    case ACTIONS.SET_READY:\n      {\n        return nextPlayBackState(state, action.destination, false, {\n          ready: action.value\n        });\n      }\n\n    case ACTIONS.SET_PITCH:\n      {\n        return nextPlayBackState(state, action.destination, false, {\n          pitch: action.pitch\n        });\n      }\n\n    case ACTIONS.TOGGLE_PLAY:\n      {\n        var _state$channel$action, _state$channel$action2;\n\n        let prevPause = (_state$channel$action = state.channel[action.destination]) === null || _state$channel$action === void 0 ? void 0 : (_state$channel$action2 = _state$channel$action.playBackState) === null || _state$channel$action2 === void 0 ? void 0 : _state$channel$action2.paused;\n        prevPause = prevPause === undefined ? true : prevPause;\n        return nextPlayBackState(state, action.destination, true, {\n          paused: !prevPause\n        });\n      }\n\n    case ACTIONS.SET_TIME_LEFT:\n      {\n        return nextPlayBackState(state, action.destination, true, {\n          timeLeft: action.timeLeft\n        });\n      }\n\n    case ACTIONS.TOGGLE_CUE:\n      {\n        var _state$channel$action3, _state$channel$action4;\n\n        let prevCue = (_state$channel$action3 = state.channel[action.destination]) === null || _state$channel$action3 === void 0 ? void 0 : (_state$channel$action4 = _state$channel$action3.playBackState) === null || _state$channel$action4 === void 0 ? void 0 : _state$channel$action4.cueActive;\n        prevCue = prevCue === undefined ? false : prevCue;\n        return nextPlayBackState(state, action.destination, true, {\n          cueActive: !prevCue\n        });\n      }\n\n    case ACTIONS.CANCEL_CUE_AND_PLAY:\n      {\n        return nextPlayBackState(state, action.destination, true, {\n          cueActive: false,\n          paused: false\n        });\n      }\n\n    case ACTIONS.SET_CUE_POINT:\n      {\n        return nextPlayBackState(state, action.destination, true, {\n          cuePoint: action.position\n        });\n      }\n\n    case ACTIONS.SET_BPM:\n      {\n        const bpm = action.bpm;\n        const source = action.source;\n        const id = action.id;\n        let channels = [];\n        console.log('reducer work');\n\n        for (let channelName of Object.keys(state.channel)) {\n          if (state.channel[channelName].track.id === id && state.channel[channelName].track.source === source) {\n            channels.push(channelName);\n          }\n        }\n\n        console.log(channels);\n        if (channels.length === 0) return state;\n        let nextState = channels.reduce((prevState, channelName) => {\n          return nextTrackState(prevState, channelName, false, {\n            bpm: bpm\n          });\n        }, state);\n        console.log(nextState);\n      }\n\n    default:\n      return state;\n  }\n}\n\nfunction nextPlayBackState(state, destination, haveToBeReady, variables) {\n  if (!state.channel[destination]) return state;\n  if (haveToBeReady && !state.channel[destination].playBackState.ready) return state;\n  const nextState = produce(state, draftState => {\n    for (let [variable, value] of Object.entries(variables)) {\n      draftState.channel[destination].playBackState[variable] = value;\n    }\n  });\n  return nextState;\n}\n\nfunction nextTrackState(state, destination, haveToBeReady, variables) {\n  if (!state.channel[destination]) return state;\n  if (haveToBeReady && !state.channel[destination].playBackState.ready) return state;\n  const nextState = produce(state, draftState => {\n    for (let [variable, value] of Object.entries(variables)) {\n      draftState.channel[destination].track[variable] = value;\n    }\n  });\n  return nextState;\n}\n\nexport default consoleReducer;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/reducers/consoleReducer.js"],"names":["ACTIONS","produce","deck","track","title","bpm","quality","duration","source","id","thumbnail","playBackState","ready","paused","cuePoint","cueActive","pitch","timeLeft","channel","volume","low","mid","high","gain","initState","A","B","mikser","channelA","channelB","fader","position","consoleReducer","state","action","type","LOAD_TRACK","nextTrack","draftState","destination","SET_READY","nextPlayBackState","value","SET_PITCH","TOGGLE_PLAY","prevPause","undefined","SET_TIME_LEFT","TOGGLE_CUE","prevCue","CANCEL_CUE_AND_PLAY","SET_CUE_POINT","SET_BPM","channels","console","log","channelName","Object","keys","push","length","nextState","reduce","prevState","nextTrackState","haveToBeReady","variables","variable","entries"],"mappings":"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","sourcesContent":["import {  ACTIONS } from \"./../actions/actions.js\";\r\nimport { produce } from \"imer\";\r\n\r\nconst deck = {\r\n    track : {\r\n        title : \"\",\r\n        bpm : 0,\r\n        quality : \"\",\r\n        duration : \"\",\r\n        source : \"\",\r\n        id: \"\",\r\n        thumbnail : {}\r\n    }, // \r\n    playBackState : {\r\n        ready: false,\r\n        paused: true,\r\n        cuePoint: 0,\r\n        cueActive: false,\r\n        pitch: 0,\r\n        timeLeft : null\r\n    }\r\n}\r\n\r\nconst channel = {\r\n    volume: 100,\r\n    low: 100,\r\n    mid : 100,\r\n    high : 100,\r\n    gain: 100\r\n}\r\n\r\nconst initState = {\r\n    channel: {\r\n        A:{\r\n            ...deck\r\n        },\r\n        B:{\r\n            ...deck\r\n        }\r\n    },\r\n   \r\n    mikser : {\r\n        channelA : {\r\n            ...channel,\r\n        },\r\n        channelB : {\r\n            ...channel,\r\n        },\r\n        fader : {\r\n            position : 50 //A: 0 <-> B:100\r\n        }\r\n    }\r\n}\r\n\r\nfunction consoleReducer(state = initState, action){\r\n    switch(action.type){\r\n        case ACTIONS.LOAD_TRACK : {\r\n            const nextTrack = action.track;\r\n            return produce(state, draftState => {\r\n                draftState.channel[action.destination].track = {\r\n                    title : nextTrack.title,\r\n                    bpm : nextTrack.bpm || 0,\r\n                    quality : nextTrack.quality,\r\n                    duration : nextTrack.duration,\r\n                    source : nextTrack.source,\r\n                    id : nextTrack.id,\r\n                    thumbnail : nextTrack.thumbnail,\r\n                }\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_READY : {\r\n            return nextPlayBackState(state, action.destination, false, { ready : action.value })\r\n        }\r\n\r\n        case ACTIONS.SET_PITCH : {\r\n            return nextPlayBackState(state, action.destination, false, { pitch : action.pitch })\r\n        }\r\n\r\n        case ACTIONS.TOGGLE_PLAY : {\r\n            let prevPause = state.channel[action.destination]?.playBackState?.paused;\r\n            prevPause = (prevPause === undefined) ? true : prevPause;\r\n            return nextPlayBackState(state, action.destination, true, { paused : !prevPause })\r\n        }\r\n\r\n        case ACTIONS.SET_TIME_LEFT : {\r\n            return nextPlayBackState(state, action.destination, true, {timeLeft: action.timeLeft})\r\n        }\r\n\r\n        case ACTIONS.TOGGLE_CUE : {\r\n            let prevCue = state.channel[action.destination]?.playBackState?.cueActive;\r\n            prevCue = (prevCue === undefined) ? false: prevCue;\r\n            return nextPlayBackState(state, action.destination, true, { cueActive : !prevCue })\r\n        }\r\n\r\n        case ACTIONS.CANCEL_CUE_AND_PLAY : {\r\n            return nextPlayBackState(state, action.destination, true, {\r\n                cueActive: false,\r\n                paused: false,\r\n            })\r\n        }\r\n\r\n        case ACTIONS.SET_CUE_POINT : {\r\n            return nextPlayBackState(state, action.destination, true, { cuePoint : action.position })\r\n        }\r\n\r\n        case ACTIONS.SET_BPM : {\r\n            const bpm = action.bpm;\r\n            const source = action.source;\r\n            const id = action.id;\r\n            let channels = [];\r\n            console.log('reducer work')\r\n            for(let channelName of Object.keys(state.channel)){\r\n                if(state.channel[channelName].track.id === id \r\n                    && state.channel[channelName].track.source === source)\r\n                    {\r\n                        channels.push(channelName);\r\n                    }\r\n\r\n            }\r\n            console.log(channels)\r\n            if(channels.length === 0) return state;\r\n\r\n            let nextState = channels.reduce((prevState, channelName) => {\r\n                return nextTrackState(prevState, channelName, false, {bpm : bpm})\r\n            }, state);\r\n\r\n            console.log(nextState);\r\n        }\r\n\r\n        default : return state;\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nfunction nextPlayBackState(state, destination, haveToBeReady, variables){\r\n    if(!state.channel[destination]) return state;\r\n    if(haveToBeReady && !state.channel[destination].playBackState.ready) return state;\r\n\r\n    const nextState = produce(state, (draftState) => {\r\n        for(let [variable, value] of Object.entries(variables)){\r\n            draftState.channel[destination].playBackState[variable] = value;\r\n        }\r\n    })\r\n    return nextState;\r\n}\r\n\r\nfunction nextTrackState(state, destination, haveToBeReady, variables){\r\n    if(!state.channel[destination]) return state;\r\n    if(haveToBeReady && !state.channel[destination].playBackState.ready) return state;\r\n\r\n    const nextState = produce(state, (draftState) => {\r\n        for(let [variable, value] of Object.entries(variables)){\r\n            draftState.channel[destination].track[variable] = value;\r\n        }\r\n    })\r\n    return nextState;\r\n}\r\n\r\nexport default consoleReducer;"]},"metadata":{},"sourceType":"module"}