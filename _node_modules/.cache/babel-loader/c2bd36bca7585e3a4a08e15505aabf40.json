{"ast":null,"code":"import { ACTIONS } from \"../actions\";\nimport { produce } from \"imer\";\nimport { unset, set, get } from \"lodash/object\";\nconst initState = {\n  list: [],\n  currentPlaylist: [],\n  // path to play list \n  currentSelection: ['root'],\n  // path to dir or playlist current selected\n  root: {},\n  // root dir for play list \n  //mock\n  root: {\n    \"Techno\": {\n      _open: true,\n      \"ZetTempo\": [],\n      \"empty dir\": {},\n      \"HardCore\": [],\n      \"Special\": {\n        _open: true,\n        \"DubTechno\": [],\n        \"Clasic 90\": []\n      }\n    },\n    \"Mini mal\": {\n      \"HighTech\": [],\n      \"Classic\": [],\n      \"EmptyFolder\": {}\n    }\n  }\n};\n\nfunction playListReducer(state = initState, action) {\n  switch (action.type) {\n    case ACTIONS.PUSH_TRACK:\n      {\n        if (state.currentPlaylist.length === 0) {\n          //if is not seelect any play list - create new\n          let pathToDir = [\"root\"];\n\n          if (state.currentSelection.length > 1) {\n            pathToDir = findClosesDir(state, state.currentSelection);\n          }\n\n          const name = generateTemplateName(state, pathToDir, \"New Playlist\");\n          const fullPath = [...pathToDir, name];\n          return produce(state, draftState => {\n            set(draftState, fullPath, []);\n            set(draftState, [...pathToDir, \"_open\"], true);\n            draftState.currentSelection = fullPath;\n            draftState.currentPlaylist = fullPath;\n            const playlist = get(draftState, fullPath);\n            draftState.list = playlist;\n            draftState.list.push(action.track);\n          });\n        }\n\n        return produce(state, draftState => {\n          draftState.list.push(action.track);\n          set(draftState, state.currentPlaylist, draftState.list);\n        });\n      }\n    ///-------------------to refactor- below two\n\n    case ACTIONS.SET_BPM_AND_OFFSET:\n      {\n        const {\n          id,\n          playlist,\n          bpm,\n          offset\n        } = action;\n        const isCurrent = playlist === undefined;\n        plyalist = playlist || state.currentPlayList;\n        list = get(state, playlist);\n        const index = state.list.findIndex(element => element._id === id);\n        list[index].bpm = bpm;\n        list[index].offset = offset;\n        return produce(state, draftState => {});\n        console.log(action);\n        return state; // const source = action.source;\n        // const id = action.id;\n        // let index = state.list.findIndex(element => (element.id === id && element.source === source));\n        // return produce(state, draftState => {\n        //     draftState.list[index].bpm = action.bpm;\n        //     draftState.list[index].offset = action.offset;\n        // })\n      }\n    ///--------------------------------------\n\n    case ACTIONS.PL_TOGGLE_DIR:\n      {\n        const open = get(state, [...action.path, \"_open\"]);\n        return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open));\n      }\n\n    case ACTIONS.PL_SET_SELECTION:\n      {\n        return produce(state, draftState => draftState.currentSelection = action.path);\n      }\n\n    case ACTIONS.PL_SET_CURRENT_PLAYLIST:\n      {\n        return produce(state, draftState => {\n          draftState.currentPlayList = action.path;\n          draftState.list = get(state, [action.path]);\n        });\n      }\n\n    case ACTIONS.PL_RENAME_SELECTED:\n      {\n        const content = get(state, state.currentSelection);\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          const newCurrent = draftState.currentSelection;\n          newCurrent.pop();\n          newCurrent.push(action.name);\n          draftState.currentSelection = newCurrent;\n          set(draftState, newCurrent, content);\n        });\n      }\n\n    case ACTIONS.PL_DELETE_SELECTED:\n      {\n        return produce(state, draftState => {\n          unset(draftState, state.currentSelection);\n          draftState.currentSelection = [];\n        });\n      }\n\n    case ACTIONS.PL_MOVE_TO:\n      {\n        const {\n          pathFrom,\n          pathTo\n        } = action;\n        const content = get(state, pathFrom);\n        const name = pathFrom.pop(); //if target and source are the same don't do anything\n\n        if (pathFrom.length === pathTo.length && pathFrom.every((e, i) => e === pathTo[i])) {\n          return state;\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathTo, name], content);\n          unset(draftState, [...pathFrom, name]);\n        });\n      }\n\n    case ACTIONS.PL_DELETE_TRACK:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          newList.splice(action.index, 1);\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_SWAP_TRACK_ON_CURRENT:\n      {\n        return produce(state, draftState => {\n          const newList = [...state.list];\n          let trackFrom = newList[action.from];\n          newList[action.from] = newList[action.to];\n          newList[action.to] = trackFrom;\n          draftState.list = newList;\n          set(draftState, draftState.currentPlaylist, newList);\n        });\n      }\n\n    case ACTIONS.PL_ADD_TRACK_TO_LIST:\n      {\n        const list = get(state, action.path);\n        if (!list) return state;\n        return produce(state, draftState => {\n          list.push(action.track);\n          set(draftState, action.fullPath, list);\n        });\n      }\n\n    case ACTIONS.PL_CREATE_DIR:\n      {\n        console.log(action.name);\n        let name = action.name;\n        const pathToDir = findClosesDir(state, state.currentSelection);\n\n        if (!name) {\n          name = generateTemplateName(state, pathToDir, \"New Folder\");\n          console.log(\"new name\", name);\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathToDir, name], {});\n          set(draftState, [...pathToDir, \"_open\"], true);\n          draftState.currentSelection = [...pathToDir, name];\n        });\n      }\n\n    case ACTIONS.PL_CREATE_PLAYLIST:\n      {\n        let name = action.name;\n        const pathToDir = findClosesDir(state, state.currentSelection);\n\n        if (!name) {\n          name = generateTemplateName(state, pathToDir, \"New Playlist\");\n        }\n\n        return produce(state, draftState => {\n          set(draftState, [...pathToDir, name], []);\n          set(draftState, [...pathToDir, \"_open\"], true);\n          draftState.currentSelection = [...pathToDir, name];\n        });\n      }\n\n    case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST:\n      {\n        return produce(state, draftState => {\n          draftState.list = get(state, state.currentSelection);\n          draftState.currentPlaylist = state.currentSelection;\n        });\n      }\n\n    default:\n      return state;\n  }\n}\n\nexport default playListReducer;\n\nfunction findClosesDir(state, path) {\n  if (get(state, path) instanceof Array) {\n    path.pop();\n    return findClosesDir(state, path);\n  } else return path;\n}\n\nfunction generateTemplateName(state, path, base) {\n  let i = 0;\n\n  while (true) {\n    const number = i || \"\";\n    let name = base + \" \" + number;\n    const notExist = !get(state, [...path, name]);\n\n    if (notExist) {\n      return name;\n    } else {\n      i++;\n    }\n  }\n}","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/reducers/playListReducer.js"],"names":["ACTIONS","produce","unset","set","get","initState","list","currentPlaylist","currentSelection","root","_open","playListReducer","state","action","type","PUSH_TRACK","length","pathToDir","findClosesDir","name","generateTemplateName","fullPath","draftState","playlist","push","track","SET_BPM_AND_OFFSET","id","bpm","offset","isCurrent","undefined","plyalist","currentPlayList","index","findIndex","element","_id","console","log","PL_TOGGLE_DIR","open","path","PL_SET_SELECTION","PL_SET_CURRENT_PLAYLIST","PL_RENAME_SELECTED","content","newCurrent","pop","PL_DELETE_SELECTED","PL_MOVE_TO","pathFrom","pathTo","every","e","i","PL_DELETE_TRACK","newList","splice","PL_SWAP_TRACK_ON_CURRENT","trackFrom","from","to","PL_ADD_TRACK_TO_LIST","PL_CREATE_DIR","PL_CREATE_PLAYLIST","PL_OPEN_CURRENT_PLAY_LIST","Array","base","number","notExist"],"mappings":"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","sourcesContent":["import { ACTIONS } from \"../actions\";\r\nimport { produce } from \"imer\";\r\nimport { unset, set, get } from \"lodash/object\"\r\n\r\nconst initState = {\r\n    list: [],\r\n\r\n    currentPlaylist: [],// path to play list \r\n    currentSelection: ['root'], // path to dir or playlist current selected\r\n    root: {}, // root dir for play list \r\n\r\n    //mock\r\n    root: {\r\n        \"Techno\": {\r\n            _open: true,\r\n            \"ZetTempo\": [],\r\n            \"empty dir\": {},\r\n            \"HardCore\": [],\r\n            \"Special\": {\r\n                _open: true,\r\n                \"DubTechno\": [],\r\n                \"Clasic 90\": []\r\n            }\r\n        },\r\n        \"Mini mal\": {\r\n            \"HighTech\": [],\r\n            \"Classic\": [],\r\n            \"EmptyFolder\": {}\r\n        }\r\n    }\r\n}\r\n\r\nfunction playListReducer(state = initState, action) {\r\n    switch (action.type) {\r\n        case ACTIONS.PUSH_TRACK: {\r\n            if (state.currentPlaylist.length === 0) {\r\n                //if is not seelect any play list - create new\r\n                let pathToDir = [\"root\"]\r\n                if (state.currentSelection.length > 1) {\r\n                    pathToDir = findClosesDir(state, state.currentSelection);\r\n                }\r\n                const name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n                const fullPath = [...pathToDir, name];\r\n                return produce(state, draftState => {\r\n                    set(draftState, fullPath, [])\r\n                    set(draftState, [...pathToDir, \"_open\"], true);\r\n                    draftState.currentSelection = fullPath\r\n                    draftState.currentPlaylist = fullPath;\r\n                    const playlist = get(draftState, fullPath);\r\n                    draftState.list = playlist;\r\n                    draftState.list.push(action.track);\r\n                })\r\n            }\r\n            return produce(state, draftState => {\r\n                draftState.list.push(action.track);\r\n                set(draftState, state.currentPlaylist, draftState.list);\r\n            })\r\n        }\r\n        ///-------------------to refactor- below two\r\n\r\n        case ACTIONS.SET_BPM_AND_OFFSET: {\r\n            const { id, playlist, bpm, offset } = action;\r\n            const isCurrent = (playlist === undefined);\r\n            plyalist = playlist || state.currentPlayList;\r\n            list = get(state, playlist);\r\n            const index = state.list.findIndex(element => element._id === id);\r\n            list[index].bpm = bpm;\r\n            list[index].offset = offset;\r\n            return produce(state, draftState => {\r\n\r\n            })\r\n            console.log(action)\r\n            return state;\r\n            // const source = action.source;\r\n            // const id = action.id;\r\n            // let index = state.list.findIndex(element => (element.id === id && element.source === source));\r\n            // return produce(state, draftState => {\r\n            //     draftState.list[index].bpm = action.bpm;\r\n            //     draftState.list[index].offset = action.offset;\r\n            // })\r\n        }\r\n        ///--------------------------------------\r\n        case ACTIONS.PL_TOGGLE_DIR: {\r\n            const open = get(state, [...action.path, \"_open\"])\r\n            return produce(state, draftState => set(draftState, [...action.path, \"_open\"], !open))\r\n        }\r\n        case ACTIONS.PL_SET_SELECTION: {\r\n            return produce(state, draftState => draftState.currentSelection = action.path)\r\n        }\r\n\r\n        case ACTIONS.PL_SET_CURRENT_PLAYLIST: {\r\n            return produce(state, draftState => {\r\n                draftState.currentPlayList = action.path;\r\n                draftState.list = get(state, [action.path]);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_RENAME_SELECTED: {\r\n            const content = get(state, state.currentSelection);\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                const newCurrent = draftState.currentSelection;\r\n                newCurrent.pop();\r\n                newCurrent.push(action.name);\r\n                draftState.currentSelection = newCurrent;\r\n                set(draftState, newCurrent, content)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_SELECTED: {\r\n            return produce(state, draftState => {\r\n                unset(draftState, state.currentSelection);\r\n                draftState.currentSelection = [];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_MOVE_TO: {\r\n            const { pathFrom, pathTo } = action;\r\n            const content = get(state, pathFrom);\r\n            const name = pathFrom.pop();\r\n            //if target and source are the same don't do anything\r\n            if (pathFrom.length === pathTo.length &&\r\n                pathFrom.every((e, i) => e === pathTo[i])) {\r\n                return state;\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathTo, name], content);\r\n                unset(draftState, [...pathFrom, name]);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_DELETE_TRACK: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                newList.splice(action.index, 1);\r\n                draftState.list = newList\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_SWAP_TRACK_ON_CURRENT: {\r\n            return produce(state, draftState => {\r\n                const newList = [...state.list];\r\n                let trackFrom = newList[action.from];\r\n                newList[action.from] = newList[action.to];\r\n                newList[action.to] = trackFrom;\r\n                draftState.list = newList;\r\n                set(draftState, draftState.currentPlaylist, newList)\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_ADD_TRACK_TO_LIST: {\r\n            const list = get(state, action.path);\r\n            if (!list) return state;\r\n            return produce(state, draftState => {\r\n                list.push(action.track);\r\n                set(draftState, action.fullPath, list);\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_CREATE_DIR: {\r\n            console.log(action.name)\r\n            let name = action.name;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            if (!name) {\r\n                name = generateTemplateName(state, pathToDir, \"New Folder\");\r\n                console.log(\"new name\", name)\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], {})\r\n                set(draftState, [...pathToDir, \"_open\"], true);\r\n                draftState.currentSelection = [...pathToDir, name];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_CREATE_PLAYLIST: {\r\n            let name = action.name;\r\n            const pathToDir = findClosesDir(state, state.currentSelection);\r\n            if (!name) {\r\n                name = generateTemplateName(state, pathToDir, \"New Playlist\");\r\n            }\r\n            return produce(state, draftState => {\r\n                set(draftState, [...pathToDir, name], [])\r\n                set(draftState, [...pathToDir, \"_open\"], true);\r\n                draftState.currentSelection = [...pathToDir, name];\r\n            })\r\n        }\r\n\r\n        case ACTIONS.PL_OPEN_CURRENT_PLAY_LIST: {\r\n            return produce(state, draftState => {\r\n                draftState.list = get(state, state.currentSelection)\r\n                draftState.currentPlaylist = state.currentSelection;\r\n            })\r\n        }\r\n\r\n\r\n        default: return state;\r\n    }\r\n}\r\n\r\nexport default playListReducer;\r\n\r\n\r\nfunction findClosesDir(state, path) {\r\n    if (get(state, path) instanceof Array) {\r\n        path.pop();\r\n        return findClosesDir(state, path)\r\n    } else return path;\r\n}\r\n\r\nfunction generateTemplateName(state, path, base) {\r\n    let i = 0;\r\n    while (true) {\r\n        const number = i || \"\";\r\n        let name = base + \" \" + number;\r\n        const notExist = !(get(state, [...path, name]));\r\n        if (notExist) {\r\n            return name;\r\n        } else {\r\n            i++;\r\n        }\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}