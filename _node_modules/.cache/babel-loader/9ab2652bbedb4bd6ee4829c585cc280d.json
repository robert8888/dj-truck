{"ast":null,"code":"import _objectSpread from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"D:\\\\PROJEKTY\\\\APKI\\\\DjTruck\\\\djtruck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from\"react\";import{connect}from\"react-redux\";import WaveSurfer from\"wavesurfer\";import Console from\"./../../../core/console/console\";import config from\"./configuration\";import{setChannelReady,setTimeLeft}from\"./../../../actions\";import\"./player.scss\";var Player=/*#__PURE__*/function(_React$Component){_inherits(Player,_React$Component);function Player(){var _this;_classCallCheck(this,Player);_this=_possibleConstructorReturn(this,_getPrototypeOf(Player).call(this));_this.masterContainer=React.createRef();_this.slaveContainer=React.createRef();_this.state={loadingProgress:0};return _this;}_createClass(Player,[{key:\"setLoading\",value:function setLoading(progress){this.setState(function(state){var _state=_objectSpread({},state);_state.loadingProgress=progress;return _state;});}},{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this.master=WaveSurfer.create(config.master(this.masterContainer.current,this.props.name));this.slave=WaveSurfer.create(config.slave(this.slaveContainer.current,this.props.name));var mixConsole=Console.Get();mixConsole.setPlayer(this.props.name,this.master);this.master.on('ready',function(){_this2.currentDuration=_this2.master.getDuration();_this2.slave.load(null,_this2.master.backend.getPeaks(430,0,430));_this2.setLoading(100);_this2.props.setReadyHandler(true);startSync();});this.slave.on('seek',function(progress){var wasPlaying=_this2.master.isPlaying();_this2.master.backend.seekTo(progress*_this2.currentDuration);_this2.master.drawer.progress(progress);_this2.master.fireEvent('seek',progress);if(wasPlaying){_this2.master.play();}_this2.slave.drawer.progress(progress);if(wasPlaying){_this2.props.setTimeLeftHandler(parseInt(_this2.master.getDuration()-_this2.master.getCurrentTime()));}else{_this2.props.setTimeLeftHandler(parseInt(_this2.master.getDuration()-_this2.master.getDuration()*progress));}});this.master.on('loading',function(progress){_this2.setLoading(progress);});var startSync=function startSync(){_this2.syncHandle=setInterval(function(){_this2.slave.drawer.progress(_this2.master.getCurrentTime()/_this2.currentDuration);},100);};}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){if(this.props.url!==nextProps.url){this.setLoading(0);this.slave.load(null,[]);this.master.load(nextProps.url);this.props.setReadyHandler(false);return false;}return true;}},{key:\"render\",value:function render(){return React.createElement(\"div\",{className:\"player player-\"+this.props.name},this.state.loadingProgress<100&&this.state.loadingProgress>0&&React.createElement(\"div\",{className:\"player-loading\"},React.createElement(\"span\",null,\"Loading \",this.state.loadingProgress,\" % \")),React.createElement(\"div\",{className:\"master\",ref:this.masterContainer}),React.createElement(\"div\",{className:\"slave\",ref:this.slaveContainer}));}}]);return Player;}(React.Component);var mapDispachToProps=function mapDispachToProps(dispatch,ownProps){return{setReadyHandler:function setReadyHandler(status){return dispatch(setChannelReady(status,ownProps.name));},setTimeLeftHandler:function setTimeLeftHandler(timeLeft){return dispatch(setTimeLeft(ownProps.name,timeLeft));}};};export default connect(null,mapDispachToProps)(Player);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/DjTruck/djtruck/src/components/Deck/Player/Player.js"],"names":["React","connect","WaveSurfer","Console","config","setChannelReady","setTimeLeft","Player","masterContainer","createRef","slaveContainer","state","loadingProgress","progress","setState","_state","master","create","current","props","name","slave","mixConsole","Get","setPlayer","on","currentDuration","getDuration","load","backend","getPeaks","setLoading","setReadyHandler","startSync","wasPlaying","isPlaying","seekTo","drawer","fireEvent","play","setTimeLeftHandler","parseInt","getCurrentTime","syncHandle","setInterval","nextProps","nextState","url","Component","mapDispachToProps","dispatch","ownProps","status","timeLeft"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport {connect} from \"react-redux\";\r\nimport WaveSurfer from \"wavesurfer\";\r\nimport Console from \"./../../../core/console/console\";\r\nimport config from \"./configuration\";\r\nimport {setChannelReady , setTimeLeft } from \"./../../../actions\";\r\nimport \"./player.scss\"\r\n\r\nclass Player extends React.Component {\r\n    constructor(){\r\n        super();\r\n        this.masterContainer = React.createRef();\r\n        this.slaveContainer = React.createRef();\r\n\r\n        this.state = {\r\n            loadingProgress : 0,\r\n        }\r\n    }\r\n\r\n    setLoading(progress){\r\n        this.setState( state => {\r\n            let _state = {...state};\r\n            _state.loadingProgress = progress;\r\n            return _state\r\n        })\r\n    }\r\n\r\n    componentDidMount(){\r\n        this.master = WaveSurfer.create(config.master(this.masterContainer.current, this.props.name));\r\n        this.slave = WaveSurfer.create(config.slave(this.slaveContainer.current, this.props.name));\r\n\r\n        const mixConsole = Console.Get();\r\n        mixConsole.setPlayer(this.props.name, this.master);\r\n\r\n        this.master.on('ready', ()=>{\r\n            this.currentDuration = this.master.getDuration();\r\n            this.slave.load(null, this.master.backend.getPeaks(430, 0, 430));\r\n            this.setLoading(100);\r\n            this.props.setReadyHandler(true);\r\n            startSync();\r\n        })\r\n\r\n        this.slave.on('seek', (progress)=>{\r\n            let wasPlaying = this.master.isPlaying();\r\n            this.master.backend.seekTo(progress * this.currentDuration);\r\n            this.master.drawer.progress(progress);\r\n            this.master.fireEvent('seek', progress);\r\n\r\n            if(wasPlaying){\r\n                this.master.play();\r\n            }\r\n            this.slave.drawer.progress(progress);\r\n\r\n            if(wasPlaying){\r\n                this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - this.master.getCurrentTime()))\r\n            } else {\r\n                this.props.setTimeLeftHandler(parseInt(this.master.getDuration() - (this.master.getDuration() * progress)))\r\n            }\r\n\r\n\r\n        })\r\n\r\n        this.master.on('loading', (progress)=>{\r\n            this.setLoading(progress);\r\n        })\r\n\r\n        const startSync = () => {\r\n            this.syncHandle = setInterval(() => {\r\n                this.slave.drawer.progress(this.master.getCurrentTime() / this.currentDuration);\r\n            }, 100)\r\n        }\r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState){\r\n    \r\n        if(this.props.url !== nextProps.url){\r\n            this.setLoading(0);\r\n            this.slave.load(null, []);\r\n            this.master.load(nextProps.url);\r\n            this.props.setReadyHandler(false);\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    render(){\r\n        return (\r\n            <div className={\"player player-\"+this.props.name}>\r\n                {\r\n                (this.state.loadingProgress < 100 && this.state.loadingProgress > 0) &&\r\n                    <div className=\"player-loading\"><span>Loading { this.state.loadingProgress } % </span></div>\r\n                }\r\n                <div className=\"master\" ref={ this.masterContainer } />\r\n                <div className=\"slave\" ref={ this.slaveContainer } /> \r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapDispachToProps = (dispatch, ownProps) =>({\r\n    setReadyHandler : (status) => dispatch(setChannelReady(status, ownProps.name)),\r\n    setTimeLeftHandler : (timeLeft) => dispatch(setTimeLeft(ownProps.name, timeLeft))\r\n})\r\n\r\n\r\nexport default connect(null, mapDispachToProps)(Player);"]},"metadata":{},"sourceType":"module"}