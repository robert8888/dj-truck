{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\src\\\\pages\\\\common\\\\components\\\\PlayerControls\\\\ProgressSlider\\\\ProgressSlider.js\";\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\nimport { formater } from \"./../../../../../utils/time/timeFromater\";\nimport { toRange } from \"./../../../../../utils/math/argRanges\";\nimport \"./progress-slider.scss\"; //horizontal\n\nconst ProgressSlider = ({\n  player,\n  seek\n}) => {\n  const [progress, setProgress] = useState(0);\n  const [buffered, setBuffred] = useState(0);\n  const [currentRecord, setCurrentRecord] = useState(null);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [currentDuration, setCurrentDuration] = useState(0);\n  const isDragged = useRef();\n  const sliderArea = useRef(null);\n  const sliderThumb = useRef(null);\n  const sliderProgress = useRef(null);\n  const sliderBufferd = useRef(null);\n  const sliderTimePreview = useRef(null); //dementions \n\n  const [sliderAreaRect, setSliderAreaRect] = useState(0);\n  const [thumbRect, setThumbRect] = useState(0);\n  const setThumbPosition = useCallback(progress => {\n    let position = 0;\n    position = sliderAreaRect.width * progress;\n    sliderProgress.current.style.transform = `scaleX(${position}) translateX(50%)`;\n    position -= thumbRect.width / 2;\n    sliderThumb.current.style.transform = `translateX(${position}px)`;\n  }, [thumbRect, sliderAreaRect]);\n\n  const setProgressHandler = progress => {\n    console.log(isDragged);\n\n    if (!isDragged.value) {\n      setProgress(progress);\n    }\n  };\n\n  useEffect(() => {\n    if (!sliderAreaRect) {\n      return;\n    }\n\n    const position = sliderAreaRect.width * buffered;\n    sliderBufferd.current.style.transform = `scaleX(${position}) translateX(50%)`;\n  }, [buffered, sliderBufferd, sliderAreaRect]);\n  useEffect(() => {\n    setCurrentTime(currentDuration * progress);\n    setThumbPosition(progress);\n  }, [progress, setCurrentTime, isDragged]);\n  useEffect(() => {\n    if (currentRecord) {\n      setCurrentDuration(currentRecord.duration);\n    }\n  }, [currentRecord, setCurrentDuration]);\n  useEffect(() => {\n    if (!player) {\n      return;\n    }\n\n    player.addProgressWatcher('#', setProgressHandler);\n    player.addCurrentWatcher(setCurrentRecord);\n    player.addBuffredWatcher(setBuffred);\n  }, [player]);\n  const thumbDraging = useCallback((shiftX, areaRect, thumbRect, e) => {\n    const x = e.clientX - areaRect.left + thumbRect.width / 2;\n    let progress = x / areaRect.width;\n    progress = toRange(progress, 0, 1); //  console.log(progress)\n\n    setProgress(progress);\n  }, []);\n  const thumbMouseDown = useCallback(e => {\n    if (!currentDuration) {//  return;\n    }\n\n    const shiftX = e.clientX - sliderThumb.current.getBoundingClientRect().left;\n    const areaRect = sliderArea.current.getBoundingClientRect();\n    const thumbRect = sliderThumb.current.getBoundingClientRect();\n    console.log(\"shiftX\", shiftX);\n    const thumbDragingWithArgs = thumbDraging.bind(null, shiftX, areaRect, thumbRect);\n    isDragged.value = true;\n    window.addEventListener('mousemove', thumbDragingWithArgs);\n\n    const mouseup = () => {\n      window.removeEventListener('mouseup', mouseup);\n      window.removeEventListener('mousemove', thumbDragingWithArgs);\n      isDragged.value = false;\n    };\n\n    window.addEventListener('mouseup', mouseup);\n  }, [sliderThumb, sliderArea, isDragged]);\n  const areaMouseDown = useCallback(e => {\n    if (e.target !== sliderThumb.current) {\n      //  return;\n      console.log(e.target, sliderArea.current);\n    }\n\n    const x = e.clientX - sliderAreaRect.left + thumbRect.width / 2;\n    let progress = x / sliderAreaRect.width;\n    progress = toRange(progress, 0, 1);\n    seek({\n      progress\n    });\n  }, [sliderAreaRect, seek, sliderArea]);\n  const areaMouseMove = useCallback(e => {\n    const x = e.clientX - sliderAreaRect.left + thumbRect.width / 2;\n    let progress = x / sliderAreaRect.width;\n    progress = toRange(progress, 0, 1);\n    const time = currentDuration * progress;\n    let str = formater.secondsToStr(time / 1000);\n    sliderTimePreview.current.dataset.value = time ? str : \"\";\n    sliderTimePreview.current.style.transform = `translateX(${x}px)`;\n  }, [sliderAreaRect, currentDuration, sliderTimePreview]);\n  const areaMouseEnter = useCallback(e => {\n    sliderTimePreview.current.classList.add(\"preview--visible\");\n  }, [sliderTimePreview]);\n  const areaMouseLeave = useCallback(e => {\n    sliderTimePreview.current.classList.remove(\"preview--visible\");\n  }, [sliderTimePreview]);\n  useEffect(() => {\n    if (sliderAreaRect) {\n      sliderArea.current.addEventListener('mousedown', areaMouseDown);\n      sliderArea.current.addEventListener('mouseenter', areaMouseEnter);\n      sliderArea.current.addEventListener('mouseleave', areaMouseLeave);\n    }\n  }, [sliderAreaRect]);\n  useEffect(() => {\n    if (sliderAreaRect && currentDuration) {\n      sliderArea.current.addEventListener('mousemove', areaMouseMove);\n    }\n  }, [sliderAreaRect, currentDuration]);\n  useEffect(() => {\n    if (thumbRect) {\n      sliderThumb.current.addEventListener('mousedown', thumbMouseDown);\n\n      sliderThumb.current.ondragstart = () => false;\n    }\n  }, [thumbRect]);\n  const setThumb = useCallback(ref => {\n    sliderThumb.current = ref;\n    setThumbRect(ref.getBoundingClientRect());\n  }, [sliderThumb, setThumbRect]);\n  const setSliderArea = useCallback(ref => {\n    sliderArea.current = ref;\n    setSliderAreaRect(ref.getBoundingClientRect());\n  }, [sliderArea, setSliderAreaRect]);\n  return React.createElement(\"div\", {\n    className: \"seek-slider\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"slider-time time-current\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159\n    },\n    __self: this\n  }, formater.secondsToStr(currentTime / 1000))), React.createElement(\"div\", {\n    className: \"slider-active-area\",\n    ref: setSliderArea,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"slider-buffered\",\n    ref: sliderBufferd,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-progress\",\n    ref: sliderProgress,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-thumb\",\n    ref: setThumb,\n    draggable: \"false\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"slider-time-preview\",\n    ref: sliderTimePreview,\n    \"data-value\": \"1\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  })), React.createElement(\"div\", {\n    className: \"slider-time time-duration\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168\n    },\n    __self: this\n  }, React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169\n    },\n    __self: this\n  }, formater.secondsToStr(currentDuration / 1000))));\n};\n\nexport default ProgressSlider;","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/common/components/PlayerControls/ProgressSlider/ProgressSlider.js"],"names":["React","useState","useRef","useEffect","useCallback","formater","toRange","ProgressSlider","player","seek","progress","setProgress","buffered","setBuffred","currentRecord","setCurrentRecord","currentTime","setCurrentTime","currentDuration","setCurrentDuration","isDragged","sliderArea","sliderThumb","sliderProgress","sliderBufferd","sliderTimePreview","sliderAreaRect","setSliderAreaRect","thumbRect","setThumbRect","setThumbPosition","position","width","current","style","transform","setProgressHandler","console","log","value","duration","addProgressWatcher","addCurrentWatcher","addBuffredWatcher","thumbDraging","shiftX","areaRect","e","x","clientX","left","thumbMouseDown","getBoundingClientRect","thumbDragingWithArgs","bind","window","addEventListener","mouseup","removeEventListener","areaMouseDown","target","areaMouseMove","time","str","secondsToStr","dataset","areaMouseEnter","classList","add","areaMouseLeave","remove","ondragstart","setThumb","ref","setSliderArea"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport {formater} from \"./../../../../../utils/time/timeFromater\";\r\nimport {toRange} from \"./../../../../../utils/math/argRanges\";\r\nimport \"./progress-slider.scss\"\r\n\r\n//horizontal\r\nconst ProgressSlider = ({player, seek}) => {\r\n    const [progress, setProgress] = useState(0);\r\n    const [buffered, setBuffred] = useState(0);\r\n    const [currentRecord, setCurrentRecord] = useState(null);\r\n    const [currentTime, setCurrentTime] = useState(0);\r\n    const [currentDuration, setCurrentDuration] = useState(0);\r\n    const isDragged = useRef();\r\n    \r\n    const sliderArea = useRef(null);\r\n    const sliderThumb = useRef(null);\r\n    const sliderProgress = useRef(null);\r\n    const sliderBufferd = useRef(null);\r\n    const sliderTimePreview = useRef(null);\r\n    //dementions \r\n    const [sliderAreaRect, setSliderAreaRect] = useState(0)\r\n    const [thumbRect, setThumbRect] = useState(0)\r\n\r\n    const setThumbPosition = useCallback((progress)=>{\r\n        let position = 0;\r\n        position = sliderAreaRect.width * progress ;\r\n        sliderProgress.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n        position -= (thumbRect.width / 2) ;  \r\n        sliderThumb.current.style.transform = `translateX(${position}px)`;\r\n    }, [thumbRect, sliderAreaRect])\r\n\r\n    const setProgressHandler =(progress)=>{\r\n        console.log(isDragged)\r\n        if(!isDragged.value){\r\n            setProgress(progress);\r\n        }\r\n    }\r\n\r\n    useEffect(()=>{\r\n        if(!sliderAreaRect){\r\n            return;\r\n        }\r\n        const position = sliderAreaRect.width * buffered;\r\n        sliderBufferd.current.style.transform = `scaleX(${position}) translateX(50%)`;\r\n    }, [buffered, sliderBufferd, sliderAreaRect])\r\n\r\n    useEffect(()=>{\r\n       setCurrentTime(currentDuration * progress);\r\n       setThumbPosition(progress);\r\n    }, [progress , setCurrentTime, isDragged])\r\n\r\n    useEffect(()=>{\r\n        if(currentRecord){\r\n           setCurrentDuration(currentRecord.duration);\r\n        }\r\n    }, [currentRecord, setCurrentDuration])\r\n\r\n    useEffect(()=>{\r\n        if(!player){\r\n            return;\r\n        }\r\n        player.addProgressWatcher('#', setProgressHandler);\r\n        player.addCurrentWatcher(setCurrentRecord);\r\n        player.addBuffredWatcher(setBuffred);\r\n    }, [player])\r\n\r\n    const thumbDraging = useCallback( (shiftX, areaRect, thumbRect, e) => {\r\n       const x = e.clientX - areaRect.left  + (thumbRect.width / 2);\r\n       let progress = x / areaRect.width;\r\n       progress = toRange(progress, 0 ,1);\r\n     //  console.log(progress)\r\n       setProgress(progress)\r\n    }, [])\r\n\r\n    const thumbMouseDown = useCallback((e)=>{\r\n        if(!currentDuration){\r\n          //  return;\r\n        }\r\n        const shiftX = e.clientX - sliderThumb.current.getBoundingClientRect().left;\r\n        const areaRect = sliderArea.current.getBoundingClientRect();\r\n        const thumbRect = sliderThumb.current.getBoundingClientRect();\r\n        console.log(\"shiftX\", shiftX)\r\n        const thumbDragingWithArgs = thumbDraging.bind(null, shiftX, areaRect, thumbRect)\r\n        isDragged.value = true;\r\n        window.addEventListener('mousemove', thumbDragingWithArgs)\r\n        const mouseup = () => {\r\n            window.removeEventListener('mouseup', mouseup);\r\n            window.removeEventListener('mousemove', thumbDragingWithArgs);\r\n            isDragged.value = false;\r\n        }\r\n        window.addEventListener('mouseup', mouseup)\r\n    }, [sliderThumb, sliderArea, isDragged])\r\n\r\n    const areaMouseDown = useCallback((e)=>{\r\n        if(e.target !== sliderThumb.current){\r\n          //  return;\r\n            console.log(e.target, sliderArea.current)\r\n        }\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width  ;\r\n        progress = toRange(progress, 0 , 1)\r\n        seek({progress})\r\n    }, [sliderAreaRect, seek, sliderArea])\r\n\r\n    const areaMouseMove = useCallback( e =>{\r\n        const x = e.clientX - sliderAreaRect.left  + (thumbRect.width / 2);\r\n        let progress = x / sliderAreaRect.width;\r\n        progress = toRange(progress, 0 , 1)\r\n        const time = currentDuration * progress;\r\n        let str = formater.secondsToStr(time / 1000);\r\n        sliderTimePreview.current.dataset.value = time ? str : \"\";\r\n        sliderTimePreview.current.style.transform = `translateX(${x}px)`\r\n    }, [sliderAreaRect, currentDuration , sliderTimePreview])\r\n\r\n    const areaMouseEnter = useCallback( e => {\r\n        sliderTimePreview.current.classList.add(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n    const areaMouseLeave = useCallback( e => {\r\n        sliderTimePreview.current.classList.remove(\"preview--visible\")\r\n    }, [sliderTimePreview])\r\n\r\n    useEffect(()=>{\r\n        if(sliderAreaRect){\r\n            sliderArea.current.addEventListener('mousedown', areaMouseDown);\r\n            sliderArea.current.addEventListener('mouseenter', areaMouseEnter);\r\n            sliderArea.current.addEventListener('mouseleave', areaMouseLeave);\r\n        }\r\n    }, [sliderAreaRect])\r\n\r\n    useEffect(()=>{\r\n        if(sliderAreaRect && currentDuration){\r\n            sliderArea.current.addEventListener('mousemove', areaMouseMove);\r\n        }\r\n    }, [sliderAreaRect, currentDuration])\r\n\r\n    useEffect(()=>{\r\n        if(thumbRect){\r\n            sliderThumb.current.addEventListener('mousedown',  thumbMouseDown);\r\n            sliderThumb.current.ondragstart = () => false;\r\n        }\r\n    }, [thumbRect])\r\n\r\n    const setThumb = useCallback((ref)=>{\r\n        sliderThumb.current = ref;\r\n        setThumbRect(ref.getBoundingClientRect())\r\n    }, [sliderThumb, setThumbRect])\r\n\r\n\r\n    const setSliderArea = useCallback((ref) => {\r\n        sliderArea.current = ref;\r\n        setSliderAreaRect(ref.getBoundingClientRect())\r\n    }, [sliderArea, setSliderAreaRect])\r\n\r\n\r\n    return (\r\n        <div className=\"seek-slider\">\r\n            <div className=\"slider-time time-current\">\r\n                 <span>{formater.secondsToStr(currentTime / 1000)}</span>\r\n            </div>\r\n            <div className=\"slider-active-area\" ref={setSliderArea} draggable=\"false\">\r\n                <div className=\"slider-buffered\" ref={sliderBufferd} draggable=\"false\"/>\r\n                <div className=\"slider-progress\" ref={sliderProgress} draggable=\"false\"/>\r\n                \r\n                <div className=\"slider-thumb\" ref={setThumb} draggable=\"false\"/>\r\n                <div className=\"slider-time-preview\"  ref={sliderTimePreview} data-value=\"1\"/>\r\n            </div>\r\n            <div className=\"slider-time time-duration\">\r\n                <span>{formater.secondsToStr(currentDuration/1000)}</span>\r\n            </div>\r\n        </div>\r\n    \r\n    )\r\n}\r\n\r\nexport default ProgressSlider;"]},"metadata":{},"sourceType":"module"}