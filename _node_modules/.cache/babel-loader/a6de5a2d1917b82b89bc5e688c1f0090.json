{"ast":null,"code":"import _slicedToArray from\"D:\\\\PROJEKTY\\\\APKI\\\\dj-truck\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useCallback,useEffect,useRef,useState}from\"react\";import{Col,Row}from\"react-bootstrap\";import{connect}from\"react-redux\";import{useHistory,useParams}from\"react-router-dom\";import PlayerControls from\"../common/components/PlayerControls/PlayerControls\";import Record from\"../common/components/Record/Record\";import{loadRecords,reqRecData,reqRecs,setFooterType}from\"./../../actions\";import RecordComments from\"./../common/components/RecordComments/RecordComments\";import RecordDetails from\"./../common/components/RecordDetails/RecordDetails\";import RecordTracklist from\"./../common/components/RecordTracklist/RecordTracklist\";import{usePlayer}from\"./../common/Hooks/usePlayer\";import\"./user-record.scss\";import SocialButton from\"../common/components/SocialButton/SocialButton\";var sharePoint=process.env.REACT_APP_SHARE_POINT;var UserRecord=function UserRecord(_ref){var setFooter=_ref.setFooter,requestRecordList=_ref.requestRecordList,recordsList=_ref.recordsList,requestRecordData=_ref.requestRecordData,userId=_ref.userId,setRecordsList=_ref.setRecordsList,countAll=_ref.countAll;var _usePlayer=usePlayer(),_usePlayer2=_slicedToArray(_usePlayer,2),controls=_usePlayer2[0],player=_usePlayer2[1];var _useParams=useParams(),user=_useParams.user,title=_useParams.title,id=_useParams.id;var history=useHistory();var _useState=useState(),_useState2=_slicedToArray(_useState,2),record=_useState2[0],setRecord=_useState2[1];var reqFlag=useRef();var escapeUnderdash=useCallback(function(str){return str.split(\"_\").join(\" \");},[]);useEffect(function(){setFooter(\"player\");},[setFooter]);useEffect(function(){if(!title&&!user){history.replace('/records');return;}if(!title&&user){history.replace('/records/'+user);return;}var _title=escapeUnderdash(title);var recs=recordsList===null||recordsList===void 0?void 0:recordsList.filter(function(r){return r.title===_title;});if(id){var _id=parseInt(id);recs=recs.filter(function(r){return r.id===_id;});}//if is exact this record \nif(recs&&recs.length===1){setRecord(recs[0]);return;}//if there is none record request it\nif((recs&&recs.length===0||!recs)&&!reqFlag.current){var where={title:_title};if(id){where.id=+id;}if(user){where.nickname=user;}else if(userId){where.userId=userId;}requestRecordList(100,0,where);//to prevent reqesting again if result is empty\nreqFlag.current=true;return;}// if is more than one record with this title \nif(recs.length>1){setRecordsList(recs);history.replace('/records?preloaded=true');}if(countAll===0){history.replace('/404');}},[id,title,user,userId,recordsList,setRecord,setRecordsList,escapeUnderdash,reqFlag,history,countAll,requestRecordList]);useEffect(function(){if(!record)return;requestRecordData(record.id);},[record,requestRecordData]);var seekToTrack=useCallback(function(time){if(!controls||!player||!record||time===undefined)return;controls.seek({id:record.id,progress:time/(record.duration/1000),duration:record.duration});},[controls,player,record]);if(!record){return null;}return React.createElement(\"div\",{className:\"user-record\"},React.createElement(SocialButton,{type:\"facebook\",resorce:sharePoint+\"/share/fb/record/\"+record.id,text:record.title}),React.createElement(Record,{record:record,controls:controls,player:player,simple:true}),React.createElement(Row,null,React.createElement(Col,{xs:{span:12,order:2},md:{span:6,order:1}},React.createElement(RecordComments,null)),React.createElement(Col,{xs:12,md:{span:6,order:2}},React.createElement(RecordDetails,{record:record}),React.createElement(RecordTracklist,{onSeek:seekToTrack}))),React.createElement(PlayerControls,{controls:controls,player:player,list:record}));};var mapStateToProps=function mapStateToProps(state){return{recordsList:state.records.list,countAll:state.records.countAll,userId:state.user.dbId};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{requestRecordList:function requestRecordList(pageSize,page,where){return dispatch(reqRecs(pageSize,page,where));},requestRecordData:function requestRecordData(id){return dispatch(reqRecData(id));},setRecordsList:function setRecordsList(list){return dispatch(loadRecords(list));},setFooter:function setFooter(type){return dispatch(setFooterType(type));}};};export default connect(mapStateToProps,mapDispatchToProps)(UserRecord);","map":{"version":3,"sources":["D:/PROJEKTY/APKI/dj-truck/src/pages/userRecord/UserRecord.js"],"names":["React","useCallback","useEffect","useRef","useState","Col","Row","connect","useHistory","useParams","PlayerControls","Record","loadRecords","reqRecData","reqRecs","setFooterType","RecordComments","RecordDetails","RecordTracklist","usePlayer","SocialButton","sharePoint","process","env","REACT_APP_SHARE_POINT","UserRecord","setFooter","requestRecordList","recordsList","requestRecordData","userId","setRecordsList","countAll","controls","player","user","title","id","history","record","setRecord","reqFlag","escapeUnderdash","str","split","join","replace","_title","recs","filter","r","_id","parseInt","length","current","where","nickname","seekToTrack","time","undefined","seek","progress","duration","span","order","mapStateToProps","state","records","list","dbId","mapDispatchToProps","dispatch","pageSize","page","type"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { Col, Row } from \"react-bootstrap\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport PlayerControls from \"../common/components/PlayerControls/PlayerControls\";\r\nimport Record from \"../common/components/Record/Record\";\r\nimport { loadRecords, reqRecData, reqRecs, setFooterType } from \"./../../actions\";\r\nimport RecordComments from \"./../common/components/RecordComments/RecordComments\";\r\nimport RecordDetails from \"./../common/components/RecordDetails/RecordDetails\";\r\nimport RecordTracklist from \"./../common/components/RecordTracklist/RecordTracklist\";\r\nimport { usePlayer } from \"./../common/Hooks/usePlayer\";\r\nimport \"./user-record.scss\";\r\nimport SocialButton from \"../common/components/SocialButton/SocialButton\";\r\n\r\nconst sharePoint = process.env.REACT_APP_SHARE_POINT; \r\n\r\nconst UserRecord = ({ \r\n        setFooter,\r\n        requestRecordList, \r\n        recordsList,\r\n        requestRecordData, \r\n        userId, \r\n        setRecordsList, \r\n        countAll }) => {\r\n    const [controls, player] = usePlayer();\r\n    const { user, title, id } = useParams();\r\n    const history = useHistory()\r\n    const [record, setRecord] = useState();\r\n\r\n    const reqFlag = useRef();\r\n\r\n    const escapeUnderdash = useCallback(str => str.split(\"_\").join(\" \"), []);\r\n\r\n    useEffect(()=>{\r\n        setFooter(\"player\")\r\n    },[setFooter])\r\n\r\n    useEffect(() => {\r\n        if (!title && !user) { \r\n            history.replace('/records') \r\n            return;\r\n        }\r\n        if (!title && user) {\r\n            history.replace('/records/' + user)\r\n            return;\r\n        }\r\n\r\n        const _title = escapeUnderdash(title);\r\n\r\n        let recs = recordsList?.filter(r => r.title === _title)\r\n        if (id) {\r\n            let _id = parseInt(id)\r\n            recs = recs.filter(r => r.id === _id);\r\n        }\r\n        //if is exact this record \r\n        if (recs && recs.length === 1) {\r\n            setRecord(recs[0]);\r\n            return;\r\n        }\r\n        //if there is none record request it\r\n        if (((recs && recs.length === 0 ) || !recs) && !reqFlag.current) {\r\n\r\n            const where = { title: _title}\r\n            if (id) {\r\n                where.id = +id;\r\n            }\r\n\r\n            if (user) {\r\n                where.nickname = user;\r\n            } else if (userId) {\r\n                where.userId = userId;\r\n            }\r\n        \r\n            requestRecordList(100, 0, where);\r\n            //to prevent reqesting again if result is empty\r\n            reqFlag.current = true;\r\n            return;\r\n        }\r\n        // if is more than one record with this title \r\n\r\n        if(recs.length > 1){\r\n            setRecordsList(recs);\r\n            history.replace('/records?preloaded=true')\r\n        }\r\n\r\n        if(countAll === 0){\r\n            history.replace('/404')\r\n        }\r\n\r\n    }, [\r\n        id, \r\n        title, \r\n        user,\r\n        userId,\r\n        recordsList, \r\n        setRecord, \r\n        setRecordsList, \r\n        escapeUnderdash, \r\n        reqFlag,\r\n        history,\r\n        countAll,\r\n        requestRecordList, \r\n    ])\r\n\r\n    useEffect(() => {\r\n        if(!record) return;\r\n        requestRecordData(record.id);\r\n    }, [record, requestRecordData])\r\n\r\n    const seekToTrack = useCallback((time)=>{\r\n        if(!controls || !player || !record || time === undefined) return;\r\n        \r\n        controls.seek({\r\n            id: record.id,\r\n            progress: time / (record.duration / 1000),\r\n            duration: record.duration,\r\n        })\r\n    },[controls, player, record])\r\n\r\n    if(!record){\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <div className=\"user-record\">\r\n            <SocialButton type=\"facebook\" resorce={sharePoint + \"/share/fb/record/\" + record.id} text={record.title}/>\r\n            <Record record={record} controls={controls} player={player} simple />\r\n            <Row>\r\n                <Col xs={{span: 12, order: 2}} md={{span: 6, order:1}}>\r\n                    <RecordComments/>\r\n                </Col>\r\n                <Col xs={12}  md={{span: 6, order:2}}>\r\n                    <RecordDetails record={record} />\r\n                    <RecordTracklist onSeek={seekToTrack}/>\r\n                </Col> \r\n            </Row>\r\n            <PlayerControls controls={controls} player={player} list={record} />\r\n        </div>\r\n    )\r\n}\r\n\r\nconst mapStateToProps = state => ({\r\n    recordsList: state.records.list,\r\n    countAll: state.records.countAll,\r\n    userId: state.user.dbId,\r\n})\r\n\r\nconst mapDispatchToProps = dispatch => ({\r\n    requestRecordList: (pageSize, page, where) => dispatch(reqRecs(pageSize, page, where)),\r\n    requestRecordData: (id) => dispatch(reqRecData(id)),\r\n    setRecordsList: (list) => dispatch(loadRecords(list)),\r\n    setFooter: (type) => dispatch(setFooterType(type))\r\n})\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(UserRecord)\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}